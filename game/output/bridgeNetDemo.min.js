(function(){"use strict";Bridge.define("BridgeNetDemo.GameMode",{statics:{teamBattle:null,deathMatch:null,gameModes:null,config:{init:function(){Bridge.ready(this.init)}},getGameModesOfType:function(type){return new Bridge.List$1(BridgeNetDemo.GameMode)(Bridge.Linq.Enumerable.from(BridgeNetDemo.GameMode.gameModes).where(function(G){return G.getModeType()===type}))},getGameModeByName:function(name){var ret=new Bridge.List$1(BridgeNetDemo.GameMode)(Bridge.Linq.Enumerable.from(BridgeNetDemo.GameMode.gameModes).where(function(G){return Bridge.referenceEquals(G.getName(),name)}));return ret.getCount()>0?ret.getItem(0):null},init:function(){BridgeNetDemo.GameMode.teamBattle==null&&(BridgeNetDemo.GameMode.gameModes=new Bridge.List$1(BridgeNetDemo.GameMode)(),BridgeNetDemo.GameMode.teamBattle=new BridgeNetDemo.GameMode("Team Battle"),BridgeNetDemo.GameMode.teamBattle.setDescription("2 teams battle with limited lives\nuntil only 1 team remains."),BridgeNetDemo.GameMode.deathMatch=new BridgeNetDemo.GameMode("Death Match"),BridgeNetDemo.GameMode.deathMatch.setDescription("A free for all match with\nlimited lives."),BridgeNetDemo.GameMode.deathMatch.setTeams(!1))}},config:{properties:{Teams:!1,StartingLives:0,Survival:!1,AllowOnlinePlay:!1,AllowCharacterSelect:!1,NumberOfPlayers:0,RespawnTime:0,Name:null,ModeType:0,unlocked:!1,Description:null}},constructor:function(name){this.setTeams(!0);this.setStartingLives(3);this.setSurvival(!0);this.setAllowOnlinePlay(!0);this.setAllowCharacterSelect(!0);this.setNumberOfPlayers(6);this.setRespawnTime(390);this.setName(name);this.setModeType(BridgeNetDemo.GameMode.ModeTypes.Skirmish);this.setDescription("Missing description for "+name);this.setunlocked(!0);BridgeNetDemo.GameMode.gameModes.add(this)}});Bridge.define("BridgeNetDemo.AnimationData",{name:null,imageSpeed:0,expirationTime:0,afterExpire:null,manual:!1,expireOnLoop:!1,expireOnPredicateFailure:!1,constructor:function(name,imageSpeed,expirationTime,afterExpire,manual,expireOnLoop,expireOnPredicateFailure){imageSpeed===void 0&&(imageSpeed=1);expirationTime===void 0&&(expirationTime=0);afterExpire===void 0&&(afterExpire=null);manual===void 0&&(manual=!1);expireOnLoop===void 0&&(expireOnLoop=!1);expireOnPredicateFailure===void 0&&(expireOnPredicateFailure=!1);this.name=name;this.imageSpeed=imageSpeed;this.expirationTime=expirationTime;this.afterExpire=afterExpire;this.manual=manual;this.expireOnLoop=expireOnLoop;this.expireOnPredicateFailure=expireOnPredicateFailure}});Bridge.define("BridgeNetDemo.AnimationLoader",{statics:{directory:"",__this:null,get_this:function(){return BridgeNetDemo.AnimationLoader.__this==null&&(BridgeNetDemo.AnimationLoader.__this=new BridgeNetDemo.AnimationLoader),BridgeNetDemo.AnimationLoader.__this},init:function(){BridgeNetDemo.AnimationLoader.__this==null&&(BridgeNetDemo.AnimationLoader.__this=new BridgeNetDemo.AnimationLoader)},flipImage:function(I){var outer=document.createElement("canvas"),C=document.createElement("canvas"),g=C.getContext("2d"),ID,ret;return g.scale(-1,1),g.drawImage(I,I.width,0),g=outer.getContext("2d"),g.drawImage(C,0,0),ID=g.getImageData(0,0,I.width,I.height),ret=new Image,ret.src=g.canvas.toDataURL(),ret},preLoad:function(paths){BridgeNetDemo.HelperExtensions.forEach(String,paths,$_.BridgeNetDemo.AnimationLoader.f1)},get:function(path){return BridgeNetDemo.AnimationLoader.__this.getAnimation(path)}},_data:null,_loading:null,constructor:function(){this._data=new Bridge.Dictionary$2(String,Bridge.List$1(HTMLImageElement))();this._loading=new Bridge.List$1(String)()},downloadFile:function(path,responseType){responseType===void 0&&(responseType=2);var X=new XMLHttpRequest;return(X.responseType=responseType,X.open("GET",path,!1),X.status===200||X.status===304)?X:null},_LoadAnimation:function(list,path,index,_recursion,_error,img){if(img===void 0&&(img=null),img!=null)if(img.width>0)list.add(img);else return;var I=new Image;I.onload=function(){_recursion(list,path,index+1,_recursion,_error,I)};I.onerror=function(){_error(path)};I.src=path+index+".png"},isLoading:function(path){return path=BridgeNetDemo.AnimationLoader.directory+path,this._loading.contains(path)},_Finish:function(path){var L=BridgeNetDemo.AnimationLoader.get_this()._loading;L.contains(path)&&(console.log("finish:"+path),L.remove(path))},_GetAnimation:function(path){var L=new Bridge.List$1(HTMLImageElement)(),flip=!1,loc=path;return path.lastIndexOf(String.fromCharCode(70))===(path.length-1|0)&&(flip=!0,loc=Bridge.String.remove(loc,path.length-1|0)),this._LoadAnimation(L,loc,0,this._LoadAnimation,this._Finish),L},getAnimation:function(path){if(path=BridgeNetDemo.AnimationLoader.directory+path,this._data.containsKey(path))return this._data.get(path);this._loading.add(path);var L=this._GetAnimation(path);return this._data.set(path,L),L}});var $_={};Bridge.ns("BridgeNetDemo.AnimationLoader",$_);Bridge.apply($_.BridgeNetDemo.AnimationLoader,{f1:function(path){BridgeNetDemo.AnimationLoader.__this.getAnimation(path)}});Bridge.define("BridgeNetDemo.EntityBehavior",{enabled:!0,framesPerTick:0,entity:null,config:{properties:{BehaviorName:null}},constructor:function(entity){if(this.entity=entity,Bridge.referenceEquals(this.getBehaviorName(),"")||this.getBehaviorName()==null){var test=Bridge.getType(this),s=Bridge.getTypeName(Bridge.getType(this)).split(".");this.setBehaviorName(s[s.length-1|0])}},update:function(){},draw:function(){},sendCustomEvent:function(evt,triggerflush){triggerflush===void 0&&(triggerflush=!1);var D={};D.I=this.entity.iD;D.D=evt;D.T=this.getBehaviorName();this.entity.game.sendEvent("CBE",D,triggerflush)},customEvent:function(){}});Bridge.define("BridgeNetDemo.Animation",{images:null,_currentImage:null,currentFrame:0,imageSpeed:0,position:null,animationTimeElapsed:0,stretchWidth:0,stretchHeight:0,rotation:0,alpha:1,looping:!0,looped:!1,frameChanged:!1,flipped:!1,_transformed:!1,_shadow:0,_shadowColor:null,bufferNeedsRedraw:!0,_hueColor:null,_hueRecolorStrength:0,_buffer:null,_bg:null,constructor:function(data){this.images=data;this.images==null&&(this.images=new Bridge.List$1(HTMLImageElement)());this.imageSpeed=1;this.position=new BridgeNetDemo.Vector2;this.animationTimeElapsed=0;this.setShadow(0);this.setShadowcolor("#FFFFFF");this.setHueColor("");this.setHueRecolorStrength(.6);this._buffer=document.createElement("canvas");this._bg=this._buffer.getContext("2d")},getCurrentImage:function(){return this._currentImage},setCurrentImage:function(value){Bridge.referenceEquals(this._currentImage,value)||(this.bufferNeedsRedraw=!0);this._currentImage=value},getX:function(){return this.position.x},setX:function(value){this.position.x=value},getY:function(){return this.position.y},setY:function(value){this.position.y=value},getShadow:function(){return this._shadow},setShadow:function(value){this._shadow!==value&&(this._shadow=value,this.bufferNeedsRedraw=!0)},getShadowcolor:function(){return this._shadowColor},setShadowcolor:function(value){Bridge.referenceEquals(this._shadowColor,value)||(this._shadowColor=value,this.bufferNeedsRedraw=!0)},getHueColor:function(){return this._hueColor},setHueColor:function(value){Bridge.referenceEquals(this._hueColor,value)||(this.bufferNeedsRedraw=!0);this._hueColor=value},getHueRecolorStrength:function(){return this._hueRecolorStrength},setHueRecolorStrength:function(value){this._hueRecolorStrength!==value&&(this.bufferNeedsRedraw=!0);this._hueRecolorStrength=value},update:function(){var LI=this.getCurrentImage(),last=Bridge.Int.clip32(this.currentFrame),current;if(this.currentFrame+=this.imageSpeed,current=Bridge.Int.clip32(this.currentFrame),current!==last){if(this.images.getCount()>0){while(current>=this.images.getCount()&&current>0)this.looping?(current=current-this.images.getCount()|0,this.currentFrame-=this.images.getCount()):this.currentFrame-=this.imageSpeed;while(current<0)current=current+this.images.getCount()|0,this.currentFrame+=this.images.getCount()}this.setImage()}this.looped=!1;Bridge.referenceEquals(LI,this.getCurrentImage())?this.frameChanged=!1:(this.frameChanged=!0,(this.imageSpeed>0&&current===0||this.imageSpeed<0&&current===(this.images.getCount()-1|0))&&(this.looped=!0));this.animationTimeElapsed=this.animationTimeElapsed+1|0},changeAnimation:function(ani,reset){reset===void 0&&(reset=!0);reset&&(this.currentFrame=0,this.animationTimeElapsed=0);this.images=ani;this.setImage()},setImage:function(){var current=Bridge.Int.clip32(this.currentFrame);current>=0&&current<this.images.getCount()&&this.setCurrentImage(this.images.getItem(current))},draw:function(g){this.draw$1(g,this.position)},draw$1:function(g,position){var x=position.x,y=position.y,current,adv,x2,y2,C,CG,I,I1;if(this.getCurrentImage()!=null||(current=Bridge.Int.clip32(this.currentFrame),current>=0&&current<this.images.getCount()&&this.setCurrentImage(this.images.getItem(current)),this.getCurrentImage()!=null)){var X=x,Y=y,lastalpha=g.globalAlpha,centered=!1,useBuffer=!1;if(Bridge.referenceEquals(this.getHueColor(),"")||(this.bufferNeedsRedraw&&(adv=!0,this._bg.globalCompositeOperation="source-over",this._buffer.width=this.getCurrentImage().width,this._buffer.height=this.getCurrentImage().height,this._bg.drawImage(this.getCurrentImage(),0,0),this._bg.globalAlpha=this.getHueRecolorStrength(),this._bg.globalCompositeOperation="hue",this._bg.fillStyle=this.getHueColor(),this._bg.fillRect(0,0,this._buffer.width,this._buffer.height),adv&&(this._bg.globalAlpha=(1+this.getHueRecolorStrength())/2,this._bg.globalCompositeOperation="source-over",this._bg.fillRect(0,0,this._buffer.width,this._buffer.height)),this._bg.globalAlpha=1,adv&&(this._bg.globalCompositeOperation="luminosity",this._bg.drawImage(this.getCurrentImage(),0,0)),this._bg.globalCompositeOperation="destination-in",this._bg.drawImage(this.getCurrentImage(),0,0),adv&&(this._bg.globalCompositeOperation="hue",this._bg.globalAlpha=this.getHueRecolorStrength()*.4,this._bg.drawImage(this.getCurrentImage(),0,0))),useBuffer=!0),this.alpha<1){if(this.alpha<=0)return;g.globalAlpha=g.globalAlpha*this.alpha}x2=this.getCurrentImage().width/2;y2=this.getCurrentImage().height/2;X=-x2;Y=-y2;this._transformed||(g.save(),this._transformed=!0);g.translate(x+x2,y+y2);centered=!0;g.rotate(this.rotation);this.flipped&&(this._transformed||(g.save(),this._transformed=!0),g.scale(-1,1),centered||g.translate(this.getCurrentImage().width,0));this.getShadow()>0&&(g.shadowBlur=this.getShadow(),g.shadowColor=this.getShadowcolor(),!useBuffer&&this.bufferNeedsRedraw&&(this._bg.shadowBlur=0,this._buffer.width=this.getCurrentImage().width,this._buffer.height=this.getCurrentImage().height,this._bg.drawImage(this.getCurrentImage(),0,0),useBuffer=!0),useBuffer=!0,this.bufferNeedsRedraw&&(C=BridgeNetDemo.Helper.cloneCanvas(this._buffer),CG=BridgeNetDemo.Helper.getContext(C),this._buffer.width=this._buffer.width+Bridge.Int.clip32(this.getShadow()*2)|0,this._buffer.height=this._buffer.height+Bridge.Int.clip32(this.getShadow()*2)|0,this._bg.shadowBlur=this.getShadow(),this._bg.shadowColor=this.getShadowcolor(),this.drawWithShadows(this._bg,C,this.getShadow(),this.getShadow(),0,0,this.getShadow()/3),useBuffer=!0),X-=this.getShadow(),Y-=this.getShadow(),g.shadowBlur=0);this.stretchWidth===0&&this.stretchHeight===0?this.getShadow()>0&&!1?(I=this.getCurrentImage(),useBuffer&&(I=this._buffer),this.drawWithShadows(g,I,X,Y,0,0,this.getShadow()/3)):useBuffer?g.drawImage(this._buffer,X,Y):g.drawImage(this.getCurrentImage(),X,Y):this.getShadow()>0&&!1?(I1=this.getCurrentImage(),useBuffer&&(I1=this._buffer),this.drawWithShadows(g,I1,X,Y,this.stretchWidth,this.stretchHeight,this.getShadow()/3)):useBuffer?g.drawImage(this._buffer,X,Y,this.stretchWidth,this.stretchHeight):g.drawImage(this.getCurrentImage(),X,Y,this.stretchWidth,this.stretchHeight);this._transformed&&(g.restore(),this._transformed=!1);this.getShadow()>0&&(g.shadowBlur=0);this.alpha<1&&(g.globalAlpha=lastalpha);this.bufferNeedsRedraw=!1}},drawWithShadows:function(g,I,X,Y,W,H,size){W===0&&(W=I.width,H=I.height);g.shadowOffsetX=-size;g.drawImage(I,X,Y,W,H);g.shadowOffsetX=size;g.drawImage(I,X,Y,W,H);g.shadowOffsetX=0;g.shadowOffsetY=-size;g.drawImage(I,X,Y,W,H);g.shadowOffsetY=size;g.drawImage(I,X,Y,W,H);g.shadowOffsetY=0}});Bridge.define("BridgeNetDemo.App.TimerConfiguration",{statics:{Timer:0,RAF:1,TimerAndRAF:2},$enum:!0});Bridge.define("BridgeNetDemo.Entity",{ani:null,alive:!0,visible:!0,speed:null,game:null,_behaviors:null,_behaviorTicks:null,zOrder:0,iD:null,hideHitbox:!1,config:{init:function(){this.speed=new BridgeNetDemo.Vector2}},constructor:function(game){this.iD=BridgeNetDemo.Helper.getRandomString();this.game=game},getHspeed:function(){return this.speed.x},setHspeed:function(value){this.speed.x=value},getVspeed:function(){return this.speed.y},setVspeed:function(value){this.speed.y=value},getPosition:function(){return this.ani.position},setPosition:function(value){this.ani.position=value},getx:function(){return this.ani.position.x},setx:function(value){this.ani.position.x=value},gety:function(){return this.ani.position.y},sety:function(value){this.ani.position.y=value},getWidth:function(){return this.ani.getCurrentImage()!=null?this.ani.getCurrentImage().width:0},getHeight:function(){return this.ani.getCurrentImage()!=null?this.ani.getCurrentImage().height:0},getHandledLocally:function(){return this.game.getHoster()},addBehavior:function(behavior){this._behaviors==null&&(this._behaviors=new Bridge.List$1(BridgeNetDemo.EntityBehavior)(),this._behaviorTicks=new Bridge.List$1(Bridge.Int32)());this._behaviors.add(behavior);this._behaviorTicks.add(0)},removeBehavior:function(behavior){this._behaviors==null&&(this._behaviors=new Bridge.List$1(BridgeNetDemo.EntityBehavior)(),this._behaviorTicks=new Bridge.List$1(Bridge.Int32)());this._behaviors.contains(behavior)&&(this._behaviorTicks.removeAt(this._behaviors.indexOf(behavior)),this._behaviors.remove(behavior))},removeBehavior$1:function(T){var $t,L,behavior;if(this._behaviors!=null){for(L=new Bridge.List$1(BridgeNetDemo.EntityBehavior)(Bridge.Linq.Enumerable.from(this._behaviors).where(function(behavior){return Bridge.is(behavior,T)})),$t=Bridge.getEnumerator(L);$t.moveNext();)behavior=$t.getCurrent(),this.removeBehavior(behavior);return}},getBehavior:function(T){return this._behaviors==null?Bridge.getDefaultValue(T):Bridge.cast(Bridge.Linq.Enumerable.from(this._behaviors).first(function(behavior){return Bridge.is(behavior,T)}),T)},getBehavior$1:function(T,func){var L=new Bridge.List$1(BridgeNetDemo.EntityBehavior)(Bridge.Linq.Enumerable.from(this._behaviors).where(function(behavior){return Bridge.is(behavior,T)})),F=func;return Bridge.cast(Bridge.Linq.Enumerable.from(L).first(F),T)},getTeamColor:function(){return Bridge.is(this,BridgeNetDemo.ICombatant)?this.game.gamePlaySettings.gameMode.getTeams()?BridgeNetDemo.Game.getTeamColor(Bridge.cast(this,BridgeNetDemo.ICombatant).getTeam()):Bridge.referenceEquals(this,this.game.localplayer.character)?BridgeNetDemo.Game.getTeamColor(1):BridgeNetDemo.Game.getTeamColor(2):""},sameTeam:function(combatant){return Bridge.referenceEquals(this,combatant)?!0:Bridge.is(this,BridgeNetDemo.ICombatant)&&Bridge.is(combatant,BridgeNetDemo.ICombatant)&&Bridge.cast(this,BridgeNetDemo.ICombatant).getTeam()===Bridge.cast(combatant,BridgeNetDemo.ICombatant).getTeam()?this.game.gamePlaySettings.gameMode.getTeams()?!0:Bridge.cast(this,BridgeNetDemo.ICombatant).getTeam()===0:!1},getBehaviorFromName:function(Name){if(this._behaviors==null)return null;try{return Bridge.Linq.Enumerable.from(this._behaviors).first(function(behavior){return Bridge.referenceEquals(behavior.getBehaviorName(),Name)})}catch($e1){$e1=Bridge.Exception.create($e1);console.log("Behavior "+Name+" was not found.")}return null},customEvent:function(){},sendCustomEvent:function(evt,triggerflush){triggerflush===void 0&&(triggerflush=!1);var D={};D.I=this.iD;D.D=evt;this.game.sendEvent("CE",D,triggerflush)},playSound:function(sound){this.game.playSoundEffect(this.getCenter(),sound)},getCenter:function(){return BridgeNetDemo.Vector2.op_Addition(this.getPosition(),new BridgeNetDemo.Vector2(this.getWidth()/2,this.getHeight()/2))},getLight:function(){return Bridge.is(this,BridgeNetDemo.ILightSource)?Bridge.Linq.Enumerable.from(this.game.lights).first(Bridge.fn.bind(this,$_.BridgeNetDemo.Entity.f1)):null},getHitbox:function(){return this.ani!=null&&this.ani.getCurrentImage()!=null?new BridgeNetDemo.Rectangle(this.ani.getX(),this.ani.getY(),this.ani.getCurrentImage().width,this.ani.getCurrentImage().height):null},update:function(){var i,behavior;if(this.ani.position=BridgeNetDemo.Vector2.op_Addition(this.ani.position,this.speed),this.ani.update(),this._behaviors!=null)for(i=0;i<this._behaviors.getCount();)behavior=this._behaviors.getItem(i),behavior.enabled&&Bridge.identity(this._behaviorTicks.getItem(i),(this._behaviorTicks.setItem(i,this._behaviorTicks.getItem(i)+1|0),this._behaviorTicks.getItem(i)))>=behavior.framesPerTick&&(this._behaviorTicks.setItem(i,0),behavior.update()),i=i+1|0},refreshBehaviorTick:function(T){var B=this.getBehavior(T);B!=null&&this._behaviorTicks.setItem(this._behaviors.indexOf(B),B.framesPerTick)},draw:function(g){var $t,behavior;if(this.ani.draw(g),!this.hideHitbox&&this.game.showHitbox&&this.drawHitbox(g),this._behaviors!=null)for($t=Bridge.getEnumerator(this._behaviors);$t.moveNext();)behavior=$t.getCurrent(),behavior.draw(g)},drawHitbox:function(g){var R=this.getHitbox();R!=null&&(g.strokeStyle="#FFFF00",g.strokeRect(R.x,R.y,R.width,R.height))},onRemove:function(){}});Bridge.ns("BridgeNetDemo.Entity",$_);Bridge.apply($_.BridgeNetDemo.Entity,{f1:function(l){return Bridge.referenceEquals(l.source,this)}});Bridge.define("BridgeNetDemo.Audio",{_AM:null,_audio:null,_hasPlayed:!1,_blast:null,_loop:!1,onPlay:null,onStop:null,lasttime:0,config:{properties:{ID:null}},constructor:function(audio,ID,AudioManager){var self,maxvoices,voices;for(this._audio=audio,this.setID(ID),self=this,this._AM=AudioManager,this._audio.onplay=function(){self._OnPlay()},this._audio.onpause=function(){self._OnStop()},this._audio.onended=function(){self._OnEnd()},this._audio.ontimeupdate=function(){self._OnUpdate()},this._blast=new Bridge.List$1(HTMLAudioElement)(),maxvoices=6,voices=1;voices<maxvoices;)this._blast.add(Bridge.cast(this._audio.cloneNode(),HTMLAudioElement)),voices=voices+1|0},getIsPlaying:function(){return!(!this._hasPlayed||this._audio.paused||this._audio.currentTime===0)},setIsPlaying:function(value){value?this.play():this.pause()},getLoop:function(){return this._loop},setLoop:function(value){this._loop=value},getCurrentTime:function(){return this._audio.currentTime},setCurrentTime:function(value){this._audio.currentTime=value},getVolume:function(){return this._audio.volume},setVolume:function(value){this._audio.volume=value},play:function(){return this.getIsPlaying()?!1:(this.lasttime=this.getCurrentTime(),this._audio.play(),this._hasPlayed=!0,!0)},pause:function(){return this.getIsPlaying()?(this._audio.pause(),!0):!1},stop:function(){return this.getIsPlaying()?(this._audio.pause(),this._audio.currentTime=0,!0):!1},blast:function(volume){var i,A;if(volume===void 0&&(volume=1),this.getIsPlaying())for(i=0;i<this._blast.getCount();)A=this._blast.getItem(i),(A.paused||A.currentTime<.1||A.played.length===0)&&(A.paused||A.currentTime===0||A.played.length===0)&&(A.volume=volume,A.play(),i=this._blast.getCount()),i=i+1|0;else this.setVolume(volume),this.play()},_OnPlay:function(){this._AM.onPlay(this);if(this.onPlay)this.onPlay(this)},_OnStop:function(){this._AM.onStop(this);if(this.onStop)this.onStop(this)},_OnEnd:function(){this._OnStop()},_OnUpdate:function(){this._loop&&(this.getCurrentTime()+(this.getCurrentTime()-this.lasttime)*.8>=this._audio.duration&&(this.setCurrentTime(0),this.play()),this.lasttime=this.getCurrentTime())}});Bridge.define("BridgeNetDemo.AudioManager",{statics:{directory:"",__this:null,get_this:function(){return BridgeNetDemo.AudioManager.__this==null&&(BridgeNetDemo.AudioManager.__this=new BridgeNetDemo.AudioManager),BridgeNetDemo.AudioManager.__this},init:function(){BridgeNetDemo.AudioManager.__this==null&&(BridgeNetDemo.AudioManager.__this=new BridgeNetDemo.AudioManager)}},data:null,playing:null,constructor:function(){this.data=new Bridge.Dictionary$2(String,BridgeNetDemo.Audio)();this.playing=new Bridge.List$1(BridgeNetDemo.Audio)()},get:function(path){if(path=BridgeNetDemo.AudioManager.directory+path,this.data.containsKey(path))return this.data.get(path);var AE=new Audio(path),A=new BridgeNetDemo.Audio(AE,path,this);return this.data.add(path,A),A},play:function(path,loop){loop===void 0&&(loop=!1);var A=this.get(path);return A.setLoop(loop),A.play(),A},blast:function(path,volume){volume===void 0&&(volume=1);var A=this.get(path);A.blast(volume)},stop:function(path){var A=this.get(path);A.stop()},pause:function(path){var A=this.get(path);A.pause()},onPlay:function(audio){this.playing.contains(audio)||this.playing.add(audio)},onStop:function(audio){this.playing.contains(audio)&&this.playing.remove(audio)},stopAllFromDirectory:function(directory){directory=BridgeNetDemo.AudioManager.directory+directory;BridgeNetDemo.HelperExtensions.forEach(BridgeNetDemo.Audio,this.data.getValues(),function(A){Bridge.String.startsWith(A.getID(),directory)&&A.stop()})}});Bridge.define("BridgeNetDemo.ButtonMenu",{rows:null,menuWidth:0,menuHeight:0,fontSize:0,selectionMenu:!1,selected:null,self:null,onChoose:null,position:null,config:{init:function(){this.position=new BridgeNetDemo.Vector2}},constructor:function(menuWidth,menuHeight,FontSize,selectionMenu){selectionMenu===void 0&&(selectionMenu=!1);this.rows=new Bridge.List$1(Bridge.List$1(BridgeNetDemo.ButtonSprite))();this.menuWidth=menuWidth;this.menuHeight=menuHeight;this.fontSize=FontSize;this.selectionMenu=selectionMenu;this.self=this},getSelectedData:function(){return this.self.selected!=null?this.self.selected.data:null},getSelectedText:function(){return this.self.selected!=null&&Bridge.is(this.self.selected.getContents(),BridgeNetDemo.TextSprite)?Bridge.cast(this.self.selected.getContents(),BridgeNetDemo.TextSprite).getText():null},getAllButtons:function(){var all=new Bridge.List$1(BridgeNetDemo.ButtonSprite)();return BridgeNetDemo.HelperExtensions.forEach(Bridge.List$1(BridgeNetDemo.ButtonSprite),this.rows,function(R){all.addRange(R)}),all},getSpriteByData:function(data){var all=new Bridge.List$1(BridgeNetDemo.ButtonSprite)(Bridge.Linq.Enumerable.from(this.getAllButtons()).where(function(B){return Bridge.referenceEquals(B.data,data)}));return all.getCount()>0?all.getItem(0):null},addButtons:function(buttonText){BridgeNetDemo.HelperExtensions.forEach(String,buttonText,Bridge.fn.bind(this,$_.BridgeNetDemo.ButtonMenu.f1))},addButton:function(buttonText,row,data){var T,B;return row===void 0&&(row=-1),data===void 0&&(data=null),T=new BridgeNetDemo.TextSprite,T.setText(buttonText),T.setFontSize(this.fontSize),B=new BridgeNetDemo.ButtonSprite(T,Bridge.Int.clip32(this.fontSize*.1)),data!=null&&(B.data=data),this.addButton$1(B,row),B},addButton$1:function(button,row){row===void 0&&(row=-1);this.rows.getCount()===0&&this.rows.add(new Bridge.List$1(BridgeNetDemo.ButtonSprite)());row===-1&&(row=this.rows.getCount()-1|0);button!=null&&(button.onClick=Bridge.fn.bind(this,function(){this.self.select(button)}));this.rows.getItem(row).add(button)},select:function(button){if(!Bridge.referenceEquals(this.selected,button)||!this.selectionMenu){this.selected!=null&&this.selectionMenu&&this.selected.setColorScheme$1(0);this.selected=button;var OSC=this.onChoose,self=this;this.selectionMenu&&this.selected!=null&&this.selected.setColorScheme$1(1);this.selected!=null&&OSC&&self.onChoose()}},combineRows:function(){var all=new Bridge.List$1(BridgeNetDemo.ButtonSprite)();BridgeNetDemo.HelperExtensions.forEach(Bridge.List$1(BridgeNetDemo.ButtonSprite),this.rows,function(R){all.addRange(R)});this.rows=new Bridge.List$1(Bridge.List$1(BridgeNetDemo.ButtonSprite))();this.rows.add(all)},addRow:function(){var ret=new Bridge.List$1(BridgeNetDemo.ButtonSprite)();return this.rows.add(ret),ret},breakUp:function(totalRows){var all;this.combineRows();all=this.rows.getItem(0);this.rows=new Bridge.List$1(Bridge.List$1(BridgeNetDemo.ButtonSprite))();for(var C=Math.ceil(all.getCount()/totalRows),row=this.addRow(),i=0;i<all.getCount();)row.getCount()>=C&&(row=this.addRow()),this.addButton$1(all.getItem(i)),i=i+1|0},centerOn:function(sprite,Center){sprite.draw(null);var S=sprite.getSize(),S2=BridgeNetDemo.Vector2.op_Division(S,2);sprite.position=BridgeNetDemo.Vector2.op_Subtraction(Center,S2)},updateRow:function(index,y){var row=this.rows.getItem(index),X=this.menuWidth/(row.getCount()+1),i=0,CX=X,B;for(CX+=this.position.x;i<row.getCount();)B=row.getItem(i),B!=null&&this.centerOn(B,new BridgeNetDemo.Vector2(CX,y)),CX+=X,i=i+1|0},finish:function(totalRows){var y,CY,i;for(totalRows===void 0&&(totalRows=-1),totalRows>0&&this.breakUp(totalRows),y=0,CY=0,totalRows>0&&this.rows.getCount()<totalRows?(y=this.menuHeight/(this.rows.getCount()+1|0),CY=y):(y=this.menuHeight/this.rows.getCount(),CY=0),CY+=this.position.y,i=0;i<this.rows.getCount();)this.updateRow(i,CY),CY+=y,i=i+1|0},update:function(mousePosition,clicked){mousePosition===void 0&&(mousePosition=null);clicked===void 0&&(clicked=!0);mousePosition==null&&(mousePosition=BridgeNetDemo.KeyboardManager.get_this().cMouse,clicked=BridgeNetDemo.KeyboardManager.get_this().tappedMouseButtons.contains(0));clicked&&BridgeNetDemo.HelperExtensions.forEach(Bridge.List$1(BridgeNetDemo.ButtonSprite),this.rows,function(R){BridgeNetDemo.HelperExtensions.forEach(BridgeNetDemo.ButtonSprite,R,function(B){B!=null&&B.checkClick(mousePosition)})})},draw:function(g){BridgeNetDemo.HelperExtensions.forEach(Bridge.List$1(BridgeNetDemo.ButtonSprite),this.rows,function(R){BridgeNetDemo.HelperExtensions.forEach(BridgeNetDemo.ButtonSprite,R,function(B){B!=null&&B.draw(g)})})}});Bridge.ns("BridgeNetDemo.ButtonMenu",$_);Bridge.apply($_.BridgeNetDemo.ButtonMenu,{f1:function(T){this.addButton(T)}});Bridge.define("BridgeNetDemo.Sprite",{position:null,spriteBuffer:null,visible:!0,spriteGraphics:null,constructor:function(){this.spriteBuffer=document.createElement("canvas");this.spriteGraphics=this.spriteBuffer.getContext("2d");this.position=new BridgeNetDemo.Vector2},getSize:function(){return new BridgeNetDemo.Vector2(this.spriteBuffer.width,this.spriteBuffer.height)},setSize:function(value){value==null&&(value=new BridgeNetDemo.Vector2);this.spriteBuffer.width=Bridge.Int.clip32(value.x);this.spriteBuffer.height=Bridge.Int.clip32(value.y)},getGraphics:function(){return this.spriteGraphics},onFrame:function(){},draw:function(g){this.visible&&g.drawImage(this.spriteBuffer,this.position.x,this.position.y)},getBounds:function(){return new BridgeNetDemo.Rectangle(this.position.x,this.position.y,this.spriteBuffer.width,this.spriteBuffer.height)}});Bridge.define("BridgeNetDemo.ButtonSprite.ColorScheme",{borderColor:null,buttonColor:null,constructor:function(borderColor,buttonColor){borderColor===void 0&&(borderColor="#00AA33");buttonColor===void 0&&(buttonColor="#11CC55");this.borderColor=borderColor;this.buttonColor=buttonColor}});Bridge.define("BridgeNetDemo.Camera",{position:null,targetPosition:null,linearPanSpeed:3.5,lerpPanSpeed:.05,_scale:.8,_invscale:1.25,cameraBounds:null,constructor:function(){this.position=new BridgeNetDemo.Vector2;this.targetPosition=new BridgeNetDemo.Vector2;this.cameraBounds=new BridgeNetDemo.Rectangle(0,0,1,1);this.updateCameraBounds()},getScale:function(){return this._scale},setScale:function(value){this._scale=value;this._invscale=1/this._scale;this.updateCameraBounds()},getInvScale:function(){return this._invscale},setInvScale:function(value){this._invscale=value;this._scale=1/this._invscale;this.updateCameraBounds()},getCenter:function(){var R=this.cameraBounds;return R.getCenter()},scaleToSize:function(sizeInPixels){this.setScale(sizeInPixels/BridgeNetDemo.App.canvas.width)},updateCameraBounds:function(){this.cameraBounds.width=BridgeNetDemo.App.canvas.width*this._invscale;this.cameraBounds.height=BridgeNetDemo.App.canvas.height*this._invscale},update:function(){var dist,spd,V;if(this.position.x!==this.targetPosition.x||this.position.y!==this.targetPosition.y){if(dist=BridgeNetDemo.Vector2.op_Subtraction(this.position,this.targetPosition).getLength(),spd=this.linearPanSpeed+dist*this.lerpPanSpeed,dist<spd){this.position.x=this.targetPosition.x;this.position.y=this.targetPosition.y;return}V=BridgeNetDemo.Vector2.op_Subtraction(this.position,this.targetPosition).normalize(spd);this.position=BridgeNetDemo.Vector2.op_Subtraction(this.position,V);this.cameraBounds.x=this.position.x;this.cameraBounds.y=this.position.y}},apply:function(g){g.scale(this.getScale(),this.getScale());g.translate(-this.position.x,-this.position.y)}});Bridge.define("BridgeNetDemo.App",{statics:{frame:0,div:null,canvas:null,g:null,iC:null,targetAspect:0,screenBounds:null,currentView:null,windowActive:!0,lagtime:0,lagging:!1,gamePlaySettings:null,_useTimer:!1,_useRAF:!0,_doubleDraw:!1,_timerRender:!1,_frameRendered:!1,_gameRendered:!1,realTime:!1,_lSize:-1,_missingTime:0,_lTime:-1,_fireFox:!1,elementsLoadedByView:null,_timer:2,config:{init:function(){Bridge.ready(this.main)}},getTimer:function(){return BridgeNetDemo.App._timer},setTimer:function(value){BridgeNetDemo.App._timer=value;(BridgeNetDemo.App._timer===BridgeNetDemo.App.TimerConfiguration.Timer||BridgeNetDemo.App.getTimer()===BridgeNetDemo.App.TimerConfiguration.TimerAndRAF)&&(BridgeNetDemo.App._useTimer=!0);(BridgeNetDemo.App._timer===BridgeNetDemo.App.TimerConfiguration.RAF||BridgeNetDemo.App.getTimer()===BridgeNetDemo.App.TimerConfiguration.TimerAndRAF)&&(BridgeNetDemo.App._useRAF=!0);BridgeNetDemo.App._useTimer&&BridgeNetDemo.App.onUpdate();BridgeNetDemo.App._useRAF&&BridgeNetDemo.App.onFrame()},main:function(){if(BridgeNetDemo.App.init(),typeof InstallTrigger!="undefined"){var nAgt=navigator.userAgent,ver=Bridge.Double.parse(nAgt.split("Firefox/")[1]);if(ver<49&&!Bridge.global.confirm("You are using version "+ver+' of Firefox, versions before 49.0 have a large memory leak issue that affects this game.\nPress OK if you wish to continue anyway.\n\nNote:You can use Chrome and Opera without an issue, or use the new beta versions of Firefox "Firefox Nightly" (https://nightly.mozilla.org/).'))return;BridgeNetDemo.App._fireFox=!0}BridgeNetDemo.App.setTimer(BridgeNetDemo.App.TimerConfiguration.TimerAndRAF)},addElementAtPosition:function(element,CanvasPosition){return element.style.position="absolute",element.style.left=CanvasPosition.x/BridgeNetDemo.App.canvas.width*100+"%",element.style.top=CanvasPosition.y/BridgeNetDemo.App.canvas.height*100+"%",BridgeNetDemo.App.addElement(element)},addElement:function(element){return BridgeNetDemo.App.elementsLoadedByView.contains(element)||(BridgeNetDemo.App.elementsLoadedByView.add(element),BridgeNetDemo.App.div.appendChild(element)),!1},clearView:function(){for(var i=0;i<BridgeNetDemo.App.elementsLoadedByView.getCount();)BridgeNetDemo.App.div.removeChild(BridgeNetDemo.App.elementsLoadedByView.getItem(i)),i=i+1|0},setView$1:function(T,data){data===void 0&&(data=null);BridgeNetDemo.App.clearView();BridgeNetDemo.App.currentView=Bridge.createInstance(T);data!=null&&BridgeNetDemo.Helper.copyFields(data,BridgeNetDemo.App.currentView)},setView:function(View){BridgeNetDemo.App.clearView();BridgeNetDemo.App.elementsLoadedByView=new Bridge.List$1(HTMLElement)();BridgeNetDemo.App.currentView=View},init:function(){BridgeNetDemo.App.gamePlaySettings=new BridgeNetDemo.GamePlaySettings;BridgeNetDemo.App.elementsLoadedByView=new Bridge.List$1(HTMLElement)();document.body.style.cssText="overflow: hidden;margin: 0;padding: 0;";BridgeNetDemo.KeyboardManager.init();BridgeNetDemo.AnimationLoader.init();BridgeNetDemo.AudioManager.init();BridgeNetDemo.AnimationLoader.directory="Assets/Sprites/";BridgeNetDemo.AudioManager.directory="Assets/Audio/";BridgeNetDemo.App.div=document.createElement("div");var Canv=document.createElement("canvas");BridgeNetDemo.App.canvas=Canv;BridgeNetDemo.App.targetAspect=.75;Canv.width=1024;Canv.height=Bridge.Int.clip32(Canv.width*BridgeNetDemo.App.targetAspect);BridgeNetDemo.App.screenBounds=new BridgeNetDemo.Rectangle(0,0,Canv.width,Canv.height);BridgeNetDemo.App.div.appendChild(Canv);document.body.appendChild(BridgeNetDemo.App.div);BridgeNetDemo.App.g=BridgeNetDemo.App.canvas.getContext("2d");BridgeNetDemo.GamePadManager._this=new BridgeNetDemo.GamePadManager;BridgeNetDemo.GamePadManager._this.update();Bridge.global.setTimeout($_.BridgeNetDemo.App.f1,5);window.onblur=BridgeNetDemo.App.onBlur;window.onfocus=BridgeNetDemo.App.onFocus},onBlur:function(){BridgeNetDemo.App.windowActive&&(BridgeNetDemo.App.windowActive=!1)},onFocus:function(){BridgeNetDemo.App.windowActive||(BridgeNetDemo.App.windowActive=!0)},updateWindow:function(){var size=Math.ceil(window.innerHeight*(1/BridgeNetDemo.App.targetAspect));size!==BridgeNetDemo.App._lSize&&(BridgeNetDemo.App.canvas.style.width="100%",BridgeNetDemo.App.div.style.width=size+"px",BridgeNetDemo.App.div.style.position="relative",BridgeNetDemo.App.div.style.left=(Bridge.Int.div(window.innerWidth,2)|0)-size/2+"px",size=BridgeNetDemo.App._lSize)},gameRender:function(){BridgeNetDemo.App._gameRendered||BridgeNetDemo.App.currentView==null||(BridgeNetDemo.App.currentView.render(),BridgeNetDemo.App._gameRendered=!0)},onUpdate:function(){var time=Bridge.global.performance.now();BridgeNetDemo.App.update(time);!BridgeNetDemo.App._useRAF||BridgeNetDemo.App._doubleDraw?BridgeNetDemo.App.onFrame():BridgeNetDemo.App._timerRender&&BridgeNetDemo.App.currentView!=null&&BridgeNetDemo.App.currentView.render();BridgeNetDemo.App._useTimer&&Bridge.global.setTimeout($_.BridgeNetDemo.App.f2,12)},updateInputs:function(){if(BridgeNetDemo.App.iC!=null){var L=BridgeNetDemo.InputControllerManager.get_this().controllers;L.getCount()>1}BridgeNetDemo.KeyboardManager.update()},onFrame:function(){var time,OnF;BridgeNetDemo.App._useTimer||(time=Bridge.global.performance.now(),BridgeNetDemo.App.update(time));BridgeNetDemo.App._frameRendered||BridgeNetDemo.App.currentView==null||(BridgeNetDemo.App.gameRender(),BridgeNetDemo.App.g.drawImage(BridgeNetDemo.App.currentView.spriteBuffer,0,0),BridgeNetDemo.App._frameRendered=!0);BridgeNetDemo.App._useRAF&&(BridgeNetDemo.App.windowActive=!0,OnF=BridgeNetDemo.App.onFrame,requestAnimationFrame(OnF))},update:function(time){var delta=0,T;if(time>=0&&(BridgeNetDemo.App._lTime<0&&(BridgeNetDemo.App._lTime=time),delta=time-BridgeNetDemo.App._lTime,BridgeNetDemo.App._missingTime+=delta),BridgeNetDemo.App.updateWindow(),BridgeNetDemo.GamePadManager._this.update(),BridgeNetDemo.App.lagging=BridgeNetDemo.App._missingTime>=16.666666666666668&&(BridgeNetDemo.App._missingTime<3e3||BridgeNetDemo.App.realTime),delta>22&&(BridgeNetDemo.App.lagging=!0),BridgeNetDemo.App._missingTime>12||BridgeNetDemo.App._useRAF&&BridgeNetDemo.App._frameRendered&&BridgeNetDemo.App._missingTime>0)BridgeNetDemo.App.currentView!=null&&BridgeNetDemo.App.currentView.update(),BridgeNetDemo.App._missingTime-=16.666666666666668,BridgeNetDemo.App._frameRendered=!1,BridgeNetDemo.App._gameRendered=!1,BridgeNetDemo.App.updateInputs();else{BridgeNetDemo.App._lTime=time;return}if(time>=0)for(BridgeNetDemo.App._missingTime>=3e3&&!BridgeNetDemo.App.realTime&&(BridgeNetDemo.App._missingTime=0),BridgeNetDemo.App._missingTime>=1e4&&BridgeNetDemo.App.realTime,T=16.666666666666668,BridgeNetDemo.App._useRAF&&(T+=8);BridgeNetDemo.App._missingTime>=T;)BridgeNetDemo.App.currentView!=null&&BridgeNetDemo.App.currentView.update(),BridgeNetDemo.App._missingTime-=16.666666666666668;BridgeNetDemo.App._lTime=time;BridgeNetDemo.App.frame=BridgeNetDemo.App.frame+1|0;BridgeNetDemo.App._fireFox},doUpdateFromTimer:function(){!BridgeNetDemo.App.windowActive&&BridgeNetDemo.App.realTime&&(BridgeNetDemo.App.doUpdate(),Bridge.global.setTimeout(BridgeNetDemo.App.doUpdateFromTimer,100))},doUpdate:function(){BridgeNetDemo.App.update(Bridge.global.performance.now())},limitStringSize:function(text,maxlength){return text.length>maxlength?text.substring(0,maxlength):text}}});Bridge.ns("BridgeNetDemo.App",$_);Bridge.apply($_.BridgeNetDemo.App,{f1:function(){BridgeNetDemo.GamePadManager._this.update();BridgeNetDemo.App.iC=BridgeNetDemo.InputControllerManager.get_this().controllers.getItem(0);var IM=BridgeNetDemo.InputControllerManager.get_this().controllers.getItem(0).inputMapping.getItem(2);IM.map=0;IM.controllerID="Mouse";IM=BridgeNetDemo.InputControllerManager.get_this().controllers.getItem(0).inputMapping.getItem(3);IM.map=2;IM.controllerID="Mouse";IM=BridgeNetDemo.InputControllerManager.get_this().controllers.getItem(0).inputMapping.getItem(4);IM.map=1;IM.controllerID="Mouse";IM=BridgeNetDemo.InputControllerManager.get_this().controllers.getItem(0).inputMapping.getItem(5);IM.map=1;IM.controllerID="Mouse";BridgeNetDemo.App.currentView=new BridgeNetDemo.TitleScreen},f2:function(){BridgeNetDemo.App.onUpdate()}});Bridge.define("BridgeNetDemo.GameMode.ModeTypes",{statics:{Skirmish:0,Challenge:1,CallengeCoop:2},$enum:!0});Bridge.define("BridgeNetDemo.GamePad",{connected:!1,axes:null,buttons:null,id:null,index:Bridge.Long(0),constructor:function(pad){var length,i;for(this.id=pad.id,this.index=Bridge.Long(pad.index),this.connected=pad.connected,this.axes=pad.axes,length=pad.buttons.length,this.buttons=Bridge.Array.init(length,null),i=0;i<length;)this.buttons[i]=pad.buttons[i],i=i+1|0},update:function(){for(var i=0;i<this.buttons.length;)this.buttons[i].tapped=!1,i=i+1|0},combineData:function(pad){Bridge.referenceEquals(this.id,pad.id)&&(this.connected=pad.connected,this.axes=pad.axes,this.combineButtonData(pad.buttons))},combineButtonData:function(buttons){var Lb=buttons,i;for(this.buttons=buttons,i=0;i<buttons.length;)buttons[i].pressed&&!Lb[i].pressed&&(buttons[i].tapped=!0),i=i+1|0}});Bridge.define("BridgeNetDemo.GamePadButton",{tapped:!1,pressed:!1,value:0,constructor:function(button){this.pressed=button.pressed;this.value=button.value;this.tapped=!1}});Bridge.define("BridgeNetDemo.GamePadManager",{statics:{_this:null},keyboard:null,gamepads:null,tempgamepads:null,constructor:function(){this.gamepads=new Bridge.List$1(BridgeNetDemo.GamePad)();this.update()},getactiveGamepads:function(){return new Bridge.List$1(BridgeNetDemo.GamePad)(Bridge.Linq.Enumerable.from(this.gamepads).where($_.BridgeNetDemo.GamePadManager.f1))},callBackTest:function(){Bridge.global.alert("Callback!")},getPad:function(id){var L=new Bridge.List$1(BridgeNetDemo.GamePad)(Bridge.Linq.Enumerable.from(this.gamepads).where(function(gamepad){return Bridge.referenceEquals(gamepad.id,id)}));return L.getCount()>0?L.getItem(0):null},update:function(){for(var i=0,pads,pad;i<this.gamepads.getCount();)this.gamepads.getItem(i).update(),i=i+1|0;for(i=0,this.tempgamepads=navigator.getGamepads()||navigator.webkitGetGamepads()||[],pads=new Bridge.List$1(BridgeNetDemo.GamePad)();i<this.tempgamepads.length;)this.tempgamepads[i]!=null&&(pad=new BridgeNetDemo.GamePad(this.tempgamepads[i]),this._Update(pad),pads.add(pad)),i=i+1|0;for(i=0;i<pads.getCount();){for(var id=pads.getItem(i).id,j=0,ok=!0;j<this.gamepads.getCount();)Bridge.referenceEquals(this.gamepads.getItem(j).id,id)&&(ok=!1),j=j+1|0;ok&&this.gamepads.add(pads.getItem(i));i=i+1|0}},_Update:function(pad){for(var i=0,P;i<this.gamepads.getCount();)P=this.gamepads.getItem(i),Bridge.referenceEquals(P.id,pad.id)&&P.combineData(pad),i=i+1|0}});Bridge.ns("BridgeNetDemo.GamePadManager",$_);Bridge.apply($_.BridgeNetDemo.GamePadManager,{f1:function(gamepad){return gamepad.connected}});Bridge.define("BridgeNetDemo.GamePlaySettings",{online:!1,myCharacter:"Reisen",gameMode:null,myTeam:1,blueNPCs:3,redNPCs:2,roomID:"",hostNPOut:null,computerAIModifier:1,constructor:function(){this.gameMode=BridgeNetDemo.GameMode.deathMatch}});Bridge.define("BridgeNetDemo.Helper",{statics:{_namespaces:null,config:{init:function(){this._namespaces=new Bridge.Dictionary$2(String,Object)()}},getRandomString:function(){return(Math.random()*(new Date).getTime()).toString(36)},getType:function(FullName){var name=FullName,s,i,obj;if(Bridge.referenceEquals(name,"")||name==null||!Bridge.String.contains(name,"."))return null;for(s=name.split("."),i=1,BridgeNetDemo.Helper._namespaces.containsKey(s[0])?obj=BridgeNetDemo.Helper._namespaces.get(s[0]):(obj=eval(s[0]),BridgeNetDemo.Helper._namespaces.set(s[0],obj));i<s.length;){if(!obj)return null;obj=obj[s[i]];i=i+1|0}return obj},cloneCanvas:function(C){var ret=document.createElement("canvas"),g;return ret.width=C.width,ret.height=C.height,g=ret.getContext("2d"),g.drawImage(C,0,0),ret},getContext:function(C){return C.getContext("2d")},getField:function(target,fieldName){var O=target,s;if(BridgeNetDemo.Helper.has(O,fieldName))return O[fieldName];if(O["get"+fieldName])return O["get"+fieldName]();s="";try{s='Helper get field: Field "'+fieldName+'" was not in '+target.GetType().FullName+"."}catch($e1){$e1=Bridge.Exception.create($e1);s='Helper get field: Field "'+fieldName+'" was not in '+target+"."}return console.log(s),null},has:function(target,fieldName){return typeof target[fieldName]!="undefined"},reloadPage:function(){window.location.href=window.location.href},setField:function(target,fieldName,data){var O=target,s;if(BridgeNetDemo.Helper.has(O,fieldName)){O[fieldName]=data;return}if(O["set"+fieldName]){O["set"+fieldName](data);return}s="";try{s='Helper set field: Field "'+fieldName+'" was not in '+target.GetType().FullName+"."}catch($e1){$e1=Bridge.Exception.create($e1);s='Helper set field: Field "'+fieldName+'" was not in '+target+"."}console.log(s)},copyFields:function(source,target,Fields){var i,f;for(Fields===void 0&&(Fields=null),Fields==null&&(Fields=Object.keys(source)),i=0;i<Fields.length;)f=Fields[i],BridgeNetDemo.Helper.setField(target,f,BridgeNetDemo.Helper.getField(source,f)),i=i+1|0},keyCodeToString:function(keycode){var codenames=["","","","CANCEL","","","HELP","","BACK_SPACE","TAB","","","CLEAR","ENTER","ENTER_SPECIAL","","SHIFT","CONTROL","ALT","PAUSE","CAPS_LOCK","KANA","EISU","JUNJA","FINAL","HANJA","","ESCAPE","CONVERT","NONCONVERT","ACCEPT","MODECHANGE","SPACE","PAGE_UP","PAGE_DOWN","END","HOME","LEFT","UP","RIGHT","DOWN","SELECT","PRINT","EXECUTE","PRINTSCREEN","INSERT","DELETE","","0","1","2","3","4","5","6","7","8","9","COLON","SEMICOLON","LESS_THAN","EQUALS","GREATER_THAN","QUESTION_MARK","AT","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","OS_KEY","","CONTEXT_MENU","","SLEEP","NUMPAD0","NUMPAD1","NUMPAD2","NUMPAD3","NUMPAD4","NUMPAD5","NUMPAD6","NUMPAD7","NUMPAD8","NUMPAD9","MULTIPLY","ADD","SEPARATOR","SUBTRACT","DECIMAL","DIVIDE","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","F13","F14","F15","F16","F17","F18","F19","F20","F21","F22","F23","F24","","","","","","","","","NUM_LOCK","SCROLL_LOCK","WIN_OEM_FJ_JISHO","WIN_OEM_FJ_MASSHOU","WIN_OEM_FJ_TOUROKU","WIN_OEM_FJ_LOYA","WIN_OEM_FJ_ROYA","","","","","","","","","","CIRCUMFLEX","EXCLAMATION","DOUBLE_QUOTE","HASH","DOLLAR","PERCENT","AMPERSAND","UNDERSCORE","OPEN_PAREN","CLOSE_PAREN","ASTERISK","PLUS","PIPE","HYPHEN_MINUS","OPEN_CURLY_BRACKET","CLOSE_CURLY_BRACKET","TILDE","","","","","VOLUME_MUTE","VOLUME_DOWN","VOLUME_UP","","","SEMICOLON","EQUALS","COMMA","MINUS","PERIOD","SLASH","BACK_QUOTE","","","","","","","","","","","","","","","","","","","","","","","","","","","OPEN_BRACKET","BACK_SLASH","CLOSE_BRACKET","QUOTE","","META","ALTGR","","WIN_ICO_HELP","WIN_ICO_00","","WIN_ICO_CLEAR","","","WIN_OEM_RESET","WIN_OEM_JUMP","WIN_OEM_PA1","WIN_OEM_PA2","WIN_OEM_PA3","WIN_OEM_WSCTRL","WIN_OEM_CUSEL","WIN_OEM_ATTN","WIN_OEM_FINISH","WIN_OEM_COPY","WIN_OEM_AUTO","WIN_OEM_ENLW","WIN_OEM_BACKTAB","ATTN","CRSEL","EXSEL","EREOF","PLAY","ZOOM","","PA1","WIN_OEM_CLEAR",""];return keycode>=0&&keycode<codenames.length?codenames[keycode]:String.fromCharCode(keycode)},makeShallowCopy:function(source,fieldNames){var target,Fields,i,f;for(fieldNames===void 0&&(fieldNames=null),target={},Fields=fieldNames,Fields==null&&(Fields=Object.keys(source)),i=0;i<Fields.length;)f=Fields[i],target[f]=BridgeNetDemo.Helper.getField(source,f),i=i+1|0;return target}}});Bridge.define("BridgeNetDemo.HelperExtensions",{statics:{pick:function(T,list,RND){var $t,L,item;for(RND===void 0&&(RND=null),RND==null&&(RND=new Bridge.Random("constructor")),L=new Bridge.List$1(T)(),$t=Bridge.getEnumerator(list);$t.moveNext();)item=$t.getCurrent(),L.add(item);return L.getItem(RND.next$1(L.getCount()))},forEach:function(T,list,action){for(var item,$t=Bridge.getEnumerator(list);$t.moveNext();)item=$t.getCurrent(),action(item)},removeAll:function(T,list,predicate){for(var i=0,item;i<list.getCount();)item=list.getItem(i),predicate(item)&&(list.remove(item),i=i-1|0),i=i+1|0}}});Bridge.define("BridgeNetDemo.ICombatant");Bridge.define("BridgeNetDemo.IHarmfulEntity");Bridge.define("BridgeNetDemo.ILightProducer");Bridge.define("BridgeNetDemo.ILightSource");Bridge.define("BridgeNetDemo.InputController",{statics:{numberOfActions:8,gM:null},inputMapping:null,config:{properties:{id:null}},constructor:function(id){id===void 0&&(id="Keyboard");this.setid(id);this.inputMapping=new Bridge.List$1(BridgeNetDemo.InputMap)();Bridge.referenceEquals(id,"Keyboard")?this.initkeyboard():this.initgamepad();BridgeNetDemo.InputController.gM==null&&(BridgeNetDemo.GamePadManager._this==null&&(BridgeNetDemo.GamePadManager._this=new BridgeNetDemo.GamePadManager),BridgeNetDemo.InputController.gM=BridgeNetDemo.GamePadManager._this)},copyMap:function(){for(var fields=["map","antimap","name","axis","controllerID"],ret=Bridge.Array.init(this.inputMapping.getCount(),null),i=0;i<ret.length;)ret[i]=BridgeNetDemo.Helper.makeShallowCopy(this.inputMapping.getItem(i),fields),i=i+1|0;return ret},copyFromMap:function(Map){for(var fields=["map","antimap","name","axis","controllerID"],i=0,IM;i<Map.length;)i>=this.inputMapping.getCount()&&this.inputMapping.add(new BridgeNetDemo.InputMap("constructor")),IM=this.inputMapping.getItem(i),BridgeNetDemo.Helper.copyFields(Map[i],IM,fields),i=i+1|0},initkeyboard:function(){for(var i=0,map;i<BridgeNetDemo.InputController.numberOfActions;)map=new BridgeNetDemo.InputMap("constructor$1",-1),i===0&&(map.map=68,map.antimap=65),i===1&&(map.map=83,map.antimap=87),i===2&&(map.map=32),i===3&&(map.map=90),i===4&&(map.map=88),i===5&&(map.map=13),this.inputMapping.add(map),i=i+1|0},initgamepad:function(){for(var i=0,map;i<BridgeNetDemo.InputController.numberOfActions;)map=new BridgeNetDemo.InputMap("constructor$1",-1),i===0&&(map.map=0,map.axis=!0),i===1&&(map.map=1,map.axis=!0),i>1&&(map.map=i-2|0),this.inputMapping.add(map),i=i+1|0},getState:function(action,map){map===void 0&&(map=null);map==null&&(map=this.inputMapping.getItem(action));var TID=this.getid();return Bridge.referenceEquals(map.controllerID,"")||(TID=map.controllerID),Bridge.referenceEquals(TID,"Keyboard")?this.getKeyboardMapState(map):Bridge.referenceEquals(TID,"Mouse")?this.getMouseMapState(map):this.getGamepadMapState(map)},getPressed:function(action,map){return map===void 0&&(map=null),this.getState(action,map)>=.7},findAnyPressedGamePadInput:function(){var ret=new BridgeNetDemo.InputMap("constructor"),L=BridgeNetDemo.GamePadManager._this.getactiveGamepads();return(BridgeNetDemo.HelperExtensions.forEach(BridgeNetDemo.GamePad,L,function(G){var GB,tmp,i;if(ret.map===-1)if(ret.controllerID=G.id,GB=Bridge.Linq.Enumerable.from(G.buttons).where($_.BridgeNetDemo.InputController.f1).toArray(),GB.length>0)ret.axis=!1,tmp=GB[0],ret.map=new Bridge.List$1(BridgeNetDemo.GamePadButton)(G.buttons).indexOf(tmp);else for(i=0;i<G.axes.length&&ret.map===-1;)Math.abs(G.axes[i])>.7&&Math.abs(G.axes[i])<2&&(ret.axis=!0,ret.map=i,G.axes[i]<0&&(ret.name="anti",ret.antimap=i)),i=i+1|0}),ret.map!==-1)?ret:null},getMapControllerID:function(map){return Bridge.referenceEquals(map.controllerID,"")?this.getid():map.controllerID},getMapControllerID$1:function(action){return this.getMapControllerID(this.inputMapping.getItem(action))},getGamepadMapState:function(map){var TID=this.getid(),P;return(Bridge.referenceEquals(map.controllerID,"")||(TID=map.controllerID),P=BridgeNetDemo.GamePadManager._this.getPad(TID),P==null||!P.connected)?0:map.axis?P.axes[map.map]:P.buttons[map.map].pressed?1:map.antimap>=0&&P.buttons[map.antimap].pressed?-1:0},getKeyboardMapState:function(map){var L=BridgeNetDemo.KeyboardManager.get_this().pressedButtons;return L.contains(map.map)?1:L.contains(map.antimap)?-1:0},getMouseMapState:function(map){var L=BridgeNetDemo.KeyboardManager.get_this().pressedMouseButtons;return L.contains(map.map)?1:L.contains(map.antimap)?-1:0}});Bridge.ns("BridgeNetDemo.InputController",$_);Bridge.apply($_.BridgeNetDemo.InputController,{f1:function(B){return B.pressed}});Bridge.define("BridgeNetDemo.InputControllerManager",{statics:{__this:null,get_this:function(){return BridgeNetDemo.InputControllerManager.__this==null&&(BridgeNetDemo.InputControllerManager.__this=new BridgeNetDemo.InputControllerManager),BridgeNetDemo.InputControllerManager.__this},init:function(){BridgeNetDemo.InputControllerManager.__this==null&&(BridgeNetDemo.InputControllerManager.__this=new BridgeNetDemo.InputControllerManager)}},controllers:null,constructor:function(){this.controllers=new Bridge.List$1(BridgeNetDemo.InputController)();this.controllers.add(new BridgeNetDemo.InputController);for(var gamepads=BridgeNetDemo.GamePadManager._this.getactiveGamepads(),i=0;i<gamepads.getCount();)this.controllers.add(new BridgeNetDemo.InputController(gamepads.getItem(i).id)),i=i+1|0}});Bridge.define("BridgeNetDemo.InputMap",{map:-1,antimap:-1,name:"",axis:!1,controllerID:"",constructor:function(){this.axis=!1},constructor$1:function(map,antimap,axis){antimap===void 0&&(antimap=-1);axis===void 0&&(axis=!1);this.map=map;this.antimap=antimap;this.axis=axis}});Bridge.define("BridgeNetDemo.IWeaponBehavior");Bridge.define("BridgeNetDemo.KeyboardManager",{statics:{__this:null,get_this:function(){return BridgeNetDemo.KeyboardManager.__this==null&&(BridgeNetDemo.KeyboardManager.__this=new BridgeNetDemo.KeyboardManager),BridgeNetDemo.KeyboardManager.__this},init:function(){BridgeNetDemo.KeyboardManager.__this==null&&(BridgeNetDemo.KeyboardManager.__this=new BridgeNetDemo.KeyboardManager)},update:function(){BridgeNetDemo.KeyboardManager.__this.tappedButtons.clear();BridgeNetDemo.KeyboardManager.__this.tappedMouseButtons.clear()},neverinBounds:function(){return!BridgeNetDemo.App.screenBounds.containsPoint$1(BridgeNetDemo.KeyboardManager.get_this().cMouse.x,BridgeNetDemo.KeyboardManager.get_this().cMouse.y)},onKeyDown:function(evt){var keyCode=evt.keyCode;return(BridgeNetDemo.KeyboardManager.__this.pressedButtons.contains(keyCode)||(BridgeNetDemo.KeyboardManager.__this.pressedButtons.add(keyCode),BridgeNetDemo.KeyboardManager.__this.tappedButtons.add(keyCode)),keyCode>=37&&keyCode<=40||keyCode===32||keyCode===112)?!1:!0},onKeyUp:function(evt){var keyCode=evt.keyCode;BridgeNetDemo.KeyboardManager.__this.pressedButtons.contains(keyCode)&&BridgeNetDemo.KeyboardManager.__this.pressedButtons.remove(keyCode)},onMouseDown:function(evt){var btn=evt.button;return BridgeNetDemo.KeyboardManager.__this.pressedMouseButtons.contains(btn)||(BridgeNetDemo.KeyboardManager.__this.pressedMouseButtons.add(btn),BridgeNetDemo.KeyboardManager.__this.tappedMouseButtons.add(btn)),btn<1},onMouseUp:function(evt){var btn=evt.button;return BridgeNetDemo.KeyboardManager.__this.pressedMouseButtons.contains(btn)&&BridgeNetDemo.KeyboardManager.__this.pressedMouseButtons.remove(btn),btn<1},onMouseMove:function(evt){BridgeNetDemo.KeyboardManager.get_this().mousePosition=new BridgeNetDemo.Vector2(evt.clientX,evt.clientY);var left=Bridge.Single.parse(Bridge.String.replaceAll(BridgeNetDemo.App.div.style.left,"px","")),x=evt.clientX-left,y=evt.clientY,scale=BridgeNetDemo.App.canvas.width/Bridge.Single.parse(Bridge.String.replaceAll(BridgeNetDemo.App.div.style.width,"px",""));BridgeNetDemo.KeyboardManager.get_this().cMouse=new BridgeNetDemo.Vector2(x*scale,y*scale)}},pressedButtons:null,tappedButtons:null,pressedMouseButtons:null,tappedMouseButtons:null,mousePosition:null,cMouse:null,config:{init:function(){this.mousePosition=new BridgeNetDemo.Vector2;this.cMouse=new BridgeNetDemo.Vector2}},constructor:function(){var KD,KU,MM,MD,MU,NB;this.pressedButtons=new Bridge.List$1(Bridge.Int32)();this.tappedButtons=new Bridge.List$1(Bridge.Int32)();this.pressedMouseButtons=new Bridge.List$1(Bridge.Int32)();this.tappedMouseButtons=new Bridge.List$1(Bridge.Int32)();KD=BridgeNetDemo.KeyboardManager.onKeyDown;document.onkeydown=KD;KU=BridgeNetDemo.KeyboardManager.onKeyUp;document.onkeyup=KU;MM=BridgeNetDemo.KeyboardManager.onMouseMove;document.onmousemove=MM;MD=BridgeNetDemo.KeyboardManager.onMouseDown;document.onmousedown=MD;MU=BridgeNetDemo.KeyboardManager.onMouseUp;document.onmouseup=MU;NB=BridgeNetDemo.KeyboardManager.neverinBounds;document.oncontextmenu=NB}});Bridge.define("BridgeNetDemo.Light",{statics:{img:null},source:null,radius:0,game:null,constructor:function(game,source){this.game=game;this.source=source;var s=Bridge.cast(source,BridgeNetDemo.ILightSource),mx=s.getmaxLightRadius()*.15;this.radius=mx},update:function(){var s=Bridge.cast(this.source,BridgeNetDemo.ILightSource),mx=s.getmaxLightRadius()*this.game.visionModifier,spd=.08,mn;s.getlightFlicker()&&(mx*=.9+Math.random()*.2);this.radius!==mx&&(mn=mx*.1,this.radius<mn&&(this.radius=mn),this.radius>mx&&(spd*=1.5),Math.abs(this.radius-mx)<=spd?this.radius=mx:this.radius<mx?this.radius+=spd:this.radius-=spd)},draw:function(g){if(BridgeNetDemo.Light.img!=null){var s=Bridge.cast(this.source,BridgeNetDemo.ILightSource),position=s.getlightPosition();g.save();g.translate(position.x+0,position.y+0);g.scale(this.radius,this.radius);g.drawImage(BridgeNetDemo.Light.img,-50,-50);g.restore()}}});Bridge.define("BridgeNetDemo.MathHelper",{statics:{PI:3.14159274,PI2:6.28318548,PIOver2:1.57079637,distanceBetweenPoints:function(A,B){return BridgeNetDemo.MathHelper.distanceBetweenPoints$1(A.x,A.y,B.x,B.y)},distanceBetweenPoints$1:function(x1,y1,x2,y2){return Math.sqrt(Math.pow(x1-x2,2)+Math.pow(y1-y2,2))},clamp:function(value,min,max){return Math.min(max,Math.max(min,value))},lerp:function(value1,value2,amount){return value1+(value2-value1)*amount},degreesToRadians:function(degrees){return degrees*.0174532924},radiansToDegrees:function(radians){return radians*57.29578},getAngle:function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)},roughDistanceBetweenPoints:function(a,b){return BridgeNetDemo.Vector2.op_Subtraction(a,b).getRoughLength()},magnitudeOfRectangle:function(R){return R.width+R.height},wrapRadians:function(radian){while(radian<-3.14159274)radian+=BridgeNetDemo.MathHelper.PI2;while(radian>=BridgeNetDemo.MathHelper.PI)radian-=BridgeNetDemo.MathHelper.PI2;return radian},radianToVector:function(radian){return new BridgeNetDemo.Vector2(Math.cos(radian),Math.sin(radian))}}});Bridge.define("BridgeNetDemo.NetPlay",{statics:{room_prefix:null,_this:null,config:{init:function(){this.room_prefix="RSG_NetPlay_TouhouArena"+Bridge.String.replaceAll(BridgeNetDemo.TitleScreen.gameVersion,".","_")+"_"}}},channel:null,onOpen:null,onClose:null,onError:null,onMessage:null,onLeave:null,data:null,me:null,config:{properties:{users:null,roomID:null}},constructor:function(roomID,userName){userName===void 0&&(userName=null);this.setroomID(BridgeNetDemo.NetPlay.room_prefix+roomID);this.data=new Bridge.List$1(Object)();this.setusers(new Bridge.List$1(BridgeNetDemo.NetPlayUser)());BridgeNetDemo.NetPlay._this=this;userName!=null&&(userName=Bridge.String.replaceAll(Bridge.String.replaceAll(Bridge.String.replaceAll(Bridge.String.replaceAll(userName,".","")," ",""),"/",""),"-",""),userName="User-"+userName+"-"+(Bridge.Int.clip32(Math.random())*1e5|0));this.init(userName)},getHoster:function(){return this.channel.isNewSessionOpened},init:function(userName){var self,extras,ch;userName===void 0&&(userName=null);self=this;extras={};extras.firebase="intense-torch-6778";userName!=null&&(extras.userid=userName);console.log("NetPlay room:"+this.getroomID());this.channel=new DataChannel(self.roomID,extras);ch=this.channel;ch.onopen=function(userId){self._onOpen(userId)};ch.onleave=function(userId){self._onLeave(userId)};ch.onclose=function(evt){self._onClose(evt)};ch.onerror=function(evt){self._onError(evt)};ch.onmessage=function(message,userId,latency){self._onMessage(message,userId,latency)};ch.connect();this.me=new BridgeNetDemo.NetPlayUser(this.channel.userid,!0);this.getusers().add(this.me)},close:function(){this.channel.leave()},_onOpen:function(userID){var user=this.getUserByName(userID,!0);if(user.connected=!0,this.onOpen)this.onOpen(user)},_onClose:function(evt){if(this.onClose)this.onClose(evt)},_onError:function(evt){if(console.log("DataChannel error:"+evt),this.onError)this.onError(evt)},_onMessage:function(message,userID,latency){var user=this.getUserByName(userID,!0),L,i;if(user.messagePosted(),this.onMessage)for(L=message,i=0;i<L.length;){this.onMessage(L[i],user,latency);i=i+1|0}},_onLeave:function(userID){var user=this.getUserByName(userID,!0);if(user!=null&&(user.connected=!1,this.getusers().remove(user)),this.onLeave)this.onLeave(user)},send:function(message){this.data.add(message)},flush:function(){this.data.getCount()>0&&(this.channel.send(this.data.toArray()),this.data.clear())},addUser:function(userID){this.getUserByName(userID,!0)},getUserByName:function(userID,autoCreate){var L,ret;return(autoCreate===void 0&&(autoCreate=!1),L=new Bridge.List$1(BridgeNetDemo.NetPlayUser)(Bridge.Linq.Enumerable.from(this.getusers()).where(function(user){return Bridge.referenceEquals(user.userID,userID)})),L.getCount()>0)?L.getItem(0):autoCreate?(ret=new BridgeNetDemo.NetPlayUser(userID),this.getusers().add(ret),ret):null}});Bridge.define("BridgeNetDemo.NetPlayUser",{userID:null,connected:!1,_isMe:!1,config:{init:function(){this.lastMessagePost=new Date(-864e13)}},constructor:function(userID,isMe){isMe===void 0&&(isMe=!1);this.userID=userID;this.connected=!0;this.lastMessagePost=new Date;this._isMe=isMe},getIsMe:function(){return this._isMe},gettimeSinceLastMessage:function(){return Bridge.Date.subdd(new Date,this.lastMessagePost)},messagePosted:function(){this.lastMessagePost=new Date},getName:function(){var parts=this.userID.split("-");return parts.length>2&&Bridge.referenceEquals(parts[0],"User")?parts[1]:""}});Bridge.define("BridgeNetDemo.Player",{iD:0,character:null,networkID:null,score:0,cPU:!1,lives:3,config:{properties:{local:!1}},constructor:function(local,CPU){this.setlocal(local);this.cPU=CPU}});Bridge.define("BridgeNetDemo.Rectangle",{x:0,y:0,width:0,height:0,constructor:function(x,y,width,height){x===void 0&&(x=0);y===void 0&&(y=0);width===void 0&&(width=0);height===void 0&&(height=0);this.x=x;this.y=y;this.width=width;this.height=height},getleft:function(){return this.x},setleft:function(value){this.x=value},gettop:function(){return this.y},settop:function(value){this.y=value},getright:function(){return this.x+this.width},setright:function(value){this.width=value-this.x},getbottom:function(){return this.y+this.height},setbottom:function(value){this.height=value-this.y},getpoints:function(){var ret=Bridge.Array.init(8,0),i=0;return ret[Bridge.identity(i,i=i+1|0)]=this.x,ret[Bridge.identity(i,i=i+1|0)]=this.y,ret[Bridge.identity(i,i=i+1|0)]=this.getright(),ret[Bridge.identity(i,i=i+1|0)]=this.y,ret[Bridge.identity(i,i=i+1|0)]=this.getright(),ret[Bridge.identity(i,i=i+1|0)]=this.getbottom(),ret[Bridge.identity(i,i=i+1|0)]=this.x,ret[Bridge.identity(i,i=i+1|0)]=this.getbottom(),ret},getCenter:function(){return new BridgeNetDemo.Vector2(this.getleft()+this.width/2,this.gettop()+this.height/2)},getMin:function(){return new BridgeNetDemo.Vector2(this.x,this.y)},setMin:function(value){value!=null&&(this.x=value.x,this.y=value.y)},getMax:function(){return new BridgeNetDemo.Vector2(this.getright(),this.getbottom())},setMax:function(value){value!=null&&(this.setright(value.x),this.setbottom(value.y))},containsPoint$1:function(x,y){return x>=this.x&&y>=this.y&&x<=this.getright()&&y<=this.getbottom()?!0:!1},containsPoint:function(point){return point.x>=this.x&&point.y>=this.y&&point.x<=this.getright()&&point.y<=this.getbottom()?!0:!1},intersects:function(R){for(var p=R.getpoints(),contain=!1,outside=!1,i=0;i<p.length;)this.containsPoint$1(p[Bridge.identity(i,i=i+1|0)],p[Bridge.identity(i,i=i+1|0)])?contain=!0:outside=!0;return contain&&outside?!0:R.getleft()<this.getleft()&&R.getright()>this.getright()&&(this.gettop()<=R.gettop()&&this.getbottom()>=R.gettop()||this.gettop()<=R.getbottom()&&this.getbottom()>=R.getbottom())?!0:R.gettop()<this.gettop()&&R.getbottom()>this.getbottom()&&(this.getleft()<=R.getleft()&&this.getright()>=R.getleft()||this.getleft()<=R.getright()&&this.getright()>=R.getright())?!0:!1},isTouching:function(R){if(R==null)return!1;for(var p=R.getpoints(),i=0;i<p.length;)if(this.containsPoint$1(p[Bridge.identity(i,i=i+1|0)],p[Bridge.identity(i,i=i+1|0)]))return!0;return this.intersects(R)?!0:!1}});Bridge.define("BridgeNetDemo.Test",{button:null,constructor:function(text){this.button=Bridge.merge(document.createElement("button"),{innerHTML:text,onclick:$_.BridgeNetDemo.Test.f1})}});Bridge.ns("BridgeNetDemo.Test",$_);Bridge.apply($_.BridgeNetDemo.Test,{f1:function(){Bridge.global.alert("Success!")}});Bridge.define("BridgeNetDemo.TileData",{texture:0,row:0,column:0,enabled:!1,map:null,visible:!1,topSolid:!1,rightSolid:!1,leftSolid:!1,bottomSolid:!1,canSlope:!1,getsolid:function(){return this.topSolid&&this.rightSolid&&this.leftSolid&&this.bottomSolid},setsolid:function(value){this.topSolid=value;this.leftSolid=value;this.rightSolid=value;this.bottomSolid=value},getplatform:function(){return this.topSolid&&!this.rightSolid&&!this.leftSolid&&!this.bottomSolid},getIsSlope:function(){return this.getSlopeDirection()!==0},getSlopeDirection:function(){var Top,Tsolid;if(!this.canSlope)return 0;var Left=this.getTileData(-1,0),Right=this.getTileData(1,0),Lsolid=Left!=null&&Left.enabled&&Left.getsolid(),Rsolid=Right!=null&&Right.enabled&&Right.getsolid();return!this.canSlope||!this.getsolid()||Lsolid&&Rsolid||!Rsolid&&!Lsolid?0:(Top=this.getTileData(0,-1),Tsolid=Top!=null&&Top.enabled&&Top.getsolid(),Tsolid)?0:Rsolid?1:-1},getHitbox:function(){return new BridgeNetDemo.Rectangle(this.map.position.x+this.column*this.map.tilesize,this.map.position.y+this.row*this.map.tilesize,this.map.tilesize,this.map.tilesize)},getTileData:function(relativeX,relativeY){return this.map.getTile(this.column+relativeX|0,this.row+relativeY|0)},solidToSpeed:function(angle){return this.enabled?angle.getRoughLength()===0?this.getsolid():angle.x>0&&this.leftSolid||angle.x<0&&this.rightSolid||angle.y>0&&this.topSolid||angle.y>0&&this.bottomSolid?!0:!1:!1},getTop:function(position){var R=this.getHitbox(),direction=this.getSlopeDirection(),Y;return direction===0?R.gettop():(Y=(R.getright()-position.x)/R.width*R.height,direction>0&&(Y=R.height-Y),Y*=1,Y=Math.min(R.height,Math.max(0,Y)),R.getbottom()-Y)}});Bridge.define("BridgeNetDemo.TileMap",{position:null,tilesize:0,rows:0,columns:0,data:null,tiles:null,game:null,buffer:null,bg:null,rND:null,seed:0,needRedraw:!1,allowSkyBridge:!1,constructor:function(game,Seed){Seed===void 0&&(Seed=-1);this.rND=new Bridge.Random("constructor");this.position=new BridgeNetDemo.Vector2(-576);this.tilesize=48;this.rows=Bridge.Int.clip32(Math.ceil((-this.position.y*2+game.stageBounds.getbottom())/this.tilesize));this.columns=Bridge.Int.clip32(Math.ceil((-this.position.x*2+game.stageBounds.getright())/this.tilesize));this.data=Bridge.Array.create(null,null,this.columns,this.rows);this.tiles=BridgeNetDemo.AnimationLoader.get("Tile");this.game=game;this.buffer=document.createElement("canvas");this.bg=this.buffer.getContext("2d");this.seed=Seed<0?this.rND.next():Seed;this.generate()},randomize:function(){for(var row=0,column=0,T;row<this.rows;){while(column<this.columns)T=new BridgeNetDemo.TileData,T.row=row,T.column=column,T.texture=1,T.enabled=this.rND.nextDouble()<.15||row>=(this.rows-1|0),T.topSolid=T.enabled,T.enabled&&row>=(this.rows-1|0)?(T.texture=2,T.setsolid(!0)):T.enabled&&this.rND.nextDouble()<.3&&(T.setsolid(!0),T.texture=0,this.rND.nextDouble()<.5&&(T.texture=3)),T.visible=T.enabled,T.map=this,this.data.set([column,row],T),column=column+1|0;column=0;row=row+1|0}},generate:function(){this.rND=new Bridge.Random("constructor$1",this.seed);this._Gen();this.needRedraw=!0},_Gen:function(){for(var heightmap=Bridge.Array.init(this.columns,0),max=Bridge.Int.clip32(this.rows*.6),X=0,s,oheightmap;X<this.columns;)heightmap[X]=Bridge.Int.clip32(this.rND.nextDouble()*max),X=X+1|0;for(s=0;s<2;){for(oheightmap=heightmap,heightmap=Bridge.Array.init(this.columns,0),X=0;X<this.columns;)heightmap[X]=this.blur(oheightmap,X,8),X=X+1|0;X=1;s=s+1|0}while(X<(this.columns-1|0)){var A=heightmap[X-1|0],B=heightmap[X+1|0],H=heightmap[X];A>H==B>H&&H!==A&&(heightmap[X]=Bridge.Int.div(A+B|0,2)|0);X=X+1|0}for(var row=0,column=0,LT=null,bridgeChance=.9;row<this.rows;){while(column<this.columns){var H1=this.rows-heightmap[column]|0,fill=row>=H1,T=new BridgeNetDemo.TileData;T.row=row;T.column=column;T.texture=1;T.enabled=fill||row>=(this.rows-1|0);T.topSolid=T.enabled;T.enabled&&row>=(this.rows-1|0)?(T.texture=2,T.setsolid(!0)):T.enabled&&(T.setsolid(!0),T.texture=4,T.canSlope=!0,this.rND.nextDouble()<.5&&(T.texture=5),row>H1&&this.rND.nextDouble()<.02&&(T.texture=6));T.enabled||(this.allowSkyBridge&&row===20&&this.rND.nextDouble()<.93||(row+4|0)>=H1&&(row+2|0)<H1&&this.rND.nextDouble()<.025||LT!=null&&LT.enabled&&LT.texture===1&&this.rND.nextDouble()<bridgeChance)&&(T.enabled=!0,T.topSolid=T.enabled,bridgeChance-=.075);T.enabled&&T.texture===1||(bridgeChance=.9);T.visible=T.enabled;T.map=this;this.data.set([column,row],T);LT=T;column=column+1|0}column=0;row=row+1|0}},blur:function(array,index,blur){blur===void 0&&(blur=1);var total=0,ret=0,i=0,ind=index;for(ind>=0&&ind<array.length&&(total=total+1|0,ret=ret+array[ind]|0);i<blur;)ind=ind-1|0,ind>=0&&ind<array.length&&(total=total+1|0,ret=ret+array[ind]|0),i=i+1|0;for(i=0;i<blur;)ind=ind+1|0,ind>=0&&ind<array.length&&(total=total+1|0,ret=ret+array[ind]|0),i=i+1|0;return Bridge.Int.div(ret,total)|0},checkForTile:function(position){return(position=BridgeNetDemo.Vector2.op_Subtraction(position,this.position),position=BridgeNetDemo.Vector2.op_Division(position,this.tilesize),position.x>=0&&position.x<this.columns&&position.y>=0&&position.y<this.rows)?this.data.get([Bridge.Int.clip32(position.x),Bridge.Int.clip32(position.y)]):null},getTile:function(column,row){return column>=0&&row>=0&&column<this.columns&&row<this.rows?this.data.get([column,row]):null},_Draw:function(){if(this.needRedraw&&!BridgeNetDemo.AnimationLoader.get_this().isLoading("Tile")){var W=Bridge.Int.clip32(Math.ceil(this.columns*this.tilesize)),H=Bridge.Int.clip32(Math.ceil(this.rows*this.tilesize));this.buffer.width!==W||this.buffer.height!==H?(this.buffer.width=W,this.buffer.height=H):this.bg.clearRect(0,0,this.buffer.width,this.buffer.height);this.redraw(this.bg);this.needRedraw=!1}},draw:function(g){this._Draw();g.drawImage(this.buffer,this.position.x,this.position.y)},redraw:function(g){var PX=this.position.x,PY=this.position.y,T,sd,sg,R,P;PX=0;PY=0;for(var X=PX,Y=PY,row=0,column=0;row<this.rows;){while(column<this.columns)T=this.data.get([column,row]),T.enabled&&T.texture>=0&&T.texture<this.tiles.getCount()&&(g.drawImage(this.tiles.getItem(T.texture),X,Y),sd=T.getSlopeDirection(),sd!==0&&(sg=g,sg.globalCompositeOperation="destination-out",R=T.getHitbox(),R.x-=this.position.x,R.y-=this.position.y,g.beginPath(),g.moveTo(R.getleft(),R.gettop()),P=new BridgeNetDemo.Vector2(R.getleft()+R.width/2,R.gettop()+R.height/2),sd>0?g.lineTo(R.getleft(),R.getbottom()):g.lineTo(R.getright(),R.getbottom()),g.lineTo(R.getright(),R.gettop()),g.lineTo(R.getleft(),R.gettop()),g.fill(),g.globalCompositeOperation="source-over")),column=column+1|0,X+=this.tilesize;X=PX;Y+=this.tilesize;column=0;row=row+1|0}}});Bridge.define("BridgeNetDemo.Vector2",{statics:{getEmpty:function(){return new BridgeNetDemo.Vector2},fromRadian:function(radian){return BridgeNetDemo.MathHelper.radianToVector(radian)},op_Equality:function(A,B){return!Bridge.referenceEquals(A,B)&&(A==null||B==null)?!1:!Bridge.referenceEquals(A,B)||A.x===B.x&&A.y===B.y},op_Inequality:function(A,B){return!Bridge.referenceEquals(A,B)&&(A==null||B==null)?!0:!(!Bridge.referenceEquals(A,B)||A.x===B.x&&A.y===B.y)},op_Multiply:function(A,scale){return new BridgeNetDemo.Vector2(A.x*scale,A.y*scale)},op_Division:function(A,scale){return new BridgeNetDemo.Vector2(A.x/scale,A.y/scale)},op_Addition:function(A,B){return new BridgeNetDemo.Vector2(A.x+B.x,A.y+B.y)},op_Subtraction:function(A,B){return new BridgeNetDemo.Vector2(A.x-B.x,A.y-B.y)}},x:0,y:0,constructor:function(x,y){x===void 0&&(x=0);y===void 0&&(y=0);this.x=x;this.y=y},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getEstimatedLength:function(){var A=Math.abs(this.x),B=Math.abs(this.y),tmp;return B>A&&(tmp=A,A=B,B=tmp),B*=.34,A+B},getRoughLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(length){length===void 0&&(length=1);var D=this.getLength()/length;return new BridgeNetDemo.Vector2(this.x/D,this.y/D)},toCardinal:function(){var x=this.x,y=this.y,A=Math.abs(this.x),B=Math.abs(this.y);return B>A?x=0:A>B&&(y=0),new BridgeNetDemo.Vector2(x,y)},equals:function(o){if(Bridge.is(o,BridgeNetDemo.Vector2)){var B=Bridge.cast(o,BridgeNetDemo.Vector2);return BridgeNetDemo.Vector2.op_Inequality(this,B)&&B==null?!1:B.x===this.x&&B.y===this.y}return Bridge.equals(this,o)},toAngle:function(){return BridgeNetDemo.MathHelper.wrapRadians(BridgeNetDemo.MathHelper.getAngle(new BridgeNetDemo.Vector2,this))},clone:function(){return new BridgeNetDemo.Vector2(this.x,this.y)},rotate:function(radian){var angle=this.toAngle()+radian;return BridgeNetDemo.Vector2.fromRadian(angle).normalize(this.getLength())}});Bridge.define("BridgeNetDemo.Animator$1",function(){return{inherits:[BridgeNetDemo.EntityBehavior],animationTarget:null,spriteName:null,_animations:null,_currentAnimation:"",constructor:function(entity,spriteName){BridgeNetDemo.EntityBehavior.prototype.$constructor.call(this,entity);this.spriteName=spriteName;this._animations=new Bridge.List$1(Bridge.KeyValuePair$2(BridgeNetDemo.AnimationData,Function))();this.animationTarget=entity},getCurrentAnimation:function(){return this._currentAnimation},setAnimation$1:function(animation){var L=new Bridge.List$1(Bridge.KeyValuePair$2(BridgeNetDemo.AnimationData,Function))(Bridge.Linq.Enumerable.from(this._animations).where(function(tmp){return Bridge.referenceEquals(tmp.key.name,animation)}));L.getCount()>0?this.setAnimation(L.getItem(0).key):this.setAnimation(new BridgeNetDemo.AnimationData(animation))},setAnimation:function(animation){if(!Bridge.referenceEquals(this._currentAnimation,animation.name)){this._currentAnimation=animation.name;var I=BridgeNetDemo.AnimationLoader.get(this.spriteName+"_"+this._currentAnimation);this.entity.ani.changeAnimation(I);this.entity.ani.imageSpeed=animation.imageSpeed}},addAnimation:function(animation,F){this._animations.add(new Bridge.KeyValuePair$2(BridgeNetDemo.AnimationData,Function)(animation,F))},addAnimation$1:function(name,F){this._animations.add(new Bridge.KeyValuePair$2(BridgeNetDemo.AnimationData,Function)(new BridgeNetDemo.AnimationData(name),F))},runAnimation$2:function(animationName,manual){manual===void 0&&(manual=!0);var L=new Bridge.List$1(Bridge.KeyValuePair$2(BridgeNetDemo.AnimationData,Function))(Bridge.Linq.Enumerable.from(this._animations).where(function(tmp){return Bridge.referenceEquals(tmp.key.name,animationName)}));L.getCount()>0&&this.runAnimation$1(L.getItem(0),manual)},runAnimation:function(animation,manual){manual===void 0&&(manual=!0);var L=new Bridge.List$1(Bridge.KeyValuePair$2(BridgeNetDemo.AnimationData,Function))(Bridge.Linq.Enumerable.from(this._animations).where(function(tmp){return Bridge.referenceEquals(tmp.key,animation)}));L.getCount()>0&&this.runAnimation$1(L.getItem(0),manual)},runAnimation$1:function(animation,manual){manual===void 0&&(manual=!0);var A=animation,data=A.key;(!data.manual||manual)&&!Bridge.referenceEquals(this._currentAnimation,data.name)&&(A.value==null||A.value(this))?this.setAnimation(data):Bridge.referenceEquals(this._currentAnimation,data.name)&&data.afterExpire!=null&&(data.expirationTime>0&&data.expirationTime<=this.entity.ani.animationTimeElapsed?this.setAnimation(data.afterExpire):data.expireOnLoop&&this.entity.ani.looped?this.setAnimation(data.afterExpire):!data.expireOnPredicateFailure||A.value==null||A.value(this)||this.setAnimation(data.afterExpire))},update:function(){for(var i=0;i<this._animations.getCount();)this.runAnimation$1(this._animations.getItem(i),!1),i=i+1|0;BridgeNetDemo.EntityBehavior.prototype.update.call(this)}}});Bridge.define("BridgeNetDemo.Attachment",{inherits:[BridgeNetDemo.Entity],parent:null,offset:null,flipOffset:0,constructor:function(game){BridgeNetDemo.Entity.prototype.$constructor.call(this,game);this.hideHitbox=!0},constructor$1:function(game,Parent){BridgeNetDemo.Entity.prototype.$constructor.call(this,game);this.parent=Parent;this.offset=new BridgeNetDemo.Vector2},getPosition$1:function(){var X=this.flipOffset;return this.ani.flipped&&(X=-X),BridgeNetDemo.Vector2.op_Addition(BridgeNetDemo.Vector2.op_Addition(this.parent.getPosition(),this.offset),new BridgeNetDemo.Vector2(X,0))},update:function(){this.setPosition(this.getPosition$1());BridgeNetDemo.Entity.prototype.update.call(this)},draw:function(g){this.setPosition(this.getPosition$1());BridgeNetDemo.Entity.prototype.draw.call(this,g)}});Bridge.define("BridgeNetDemo.ButtonSprite",{inherits:[BridgeNetDemo.Sprite],_buttonNeedsRerender:!1,_buttonBuffer:null,_buttonGraphic:null,data:null,_contents:null,_borderSize:0,_borderColor:null,lockedClickSound:"hit",clickSound:"select",_buttonColor:null,colorSchemes:null,locked:!1,onClick:null,lContentSize:null,config:{init:function(){this.lContentSize=new BridgeNetDemo.Vector2}},constructor:function(contents,borderSize,borderColor,buttonColor,data){borderSize===void 0&&(borderSize=2);borderColor===void 0&&(borderColor="#00AA33");buttonColor===void 0&&(buttonColor="#11CC55");data===void 0&&(data=null);BridgeNetDemo.Sprite.prototype.$constructor.call(this);this.setContents(contents);this.setBorderSize(borderSize);this.setBorderColor(borderColor);this.setButtonColor(buttonColor);this._buttonBuffer=new BridgeNetDemo.Sprite;this._buttonBuffer.setSize(contents.getSize());this._buttonGraphic=this._buttonBuffer.getGraphics();this._buttonNeedsRerender=!0;this.colorSchemes=new Bridge.List$1(BridgeNetDemo.ButtonSprite.ColorScheme)();this.colorSchemes.add(new BridgeNetDemo.ButtonSprite.ColorScheme(borderColor,buttonColor));this.colorSchemes.add(new BridgeNetDemo.ButtonSprite.ColorScheme("#FFFFFF","#FF0000"));this.colorSchemes.add(new BridgeNetDemo.ButtonSprite.ColorScheme("#777777","#CCCCCC"));this.data=data;data==null&&Bridge.is(contents,BridgeNetDemo.TextSprite)&&(this.data=Bridge.cast(contents,BridgeNetDemo.TextSprite).getText());this.draw(null)},getContents:function(){return this._contents},setContents:function(value){Bridge.referenceEquals(this._contents,value)||(this._contents=value,this._buttonNeedsRerender=!0)},getBorderSize:function(){return this._borderSize},setBorderSize:function(value){this._borderSize!==value&&(this._borderSize=value,this._buttonNeedsRerender=!0)},getBorderColor:function(){return this._borderColor},setBorderColor:function(value){Bridge.referenceEquals(this._borderColor,value)||(this._borderColor=value,this._buttonNeedsRerender=!0)},getButtonColor:function(){return this._buttonColor},setButtonColor:function(value){Bridge.referenceEquals(this._buttonColor,value)||(this._buttonColor=value,this._buttonNeedsRerender=!0)},setColorScheme:function(scheme){this.setBorderColor(scheme.borderColor);this.setButtonColor(scheme.buttonColor)},setColorScheme$1:function(index){var C=this.colorSchemes.getItem(index);this.setColorScheme(C)},drawButton:function(){var g=this._buttonGraphic,sz=this._borderSize+this._borderSize|0,size;this._buttonBuffer.setSize(BridgeNetDemo.Vector2.op_Addition(this.getContents().getSize(),new BridgeNetDemo.Vector2(sz,sz)));size=this._buttonBuffer.getSize();g.fillStyle=this._borderColor;g.fillRect(0,0,size.x,size.y);g.fillStyle=this.getButtonColor();g.fillRect(this._borderSize,this._borderSize,Bridge.Int.clip32(size.x)-sz|0,Bridge.Int.clip32(size.y)-sz|0);var color="rgba(255,255,255,0)",grd=g.createLinearGradient(0,0,0,size.y);grd.addColorStop(0,color);grd.addColorStop(.4,"rgba(255,255,255,0.7)");grd.addColorStop(1,color);g.fillStyle=grd;g.fillRect(0,0,this._buttonBuffer.getSize().x,this._buttonBuffer.getSize().y)},lock:function(setcolorscheme){(setcolorscheme===void 0&&(setcolorscheme=!0),this.locked)||(this.locked=!0,setcolorscheme&&this.setColorScheme$1(2))},unlock:function(setcolorscheme){(setcolorscheme===void 0&&(setcolorscheme=!0),this.locked)&&(this.locked=!1,setcolorscheme&&this.setColorScheme$1(0))},checkClick:function(mousePosition){if(this.visible&&this.getBounds().containsPoint(mousePosition)){if(this.locked)return Bridge.referenceEquals(this.lockedClickSound,"")||this.lockedClickSound==null||BridgeNetDemo.AudioManager.get_this().blast("SFX/"+this.lockedClickSound+".ogg"),!1;Bridge.referenceEquals(this.clickSound,"")||this.clickSound==null||BridgeNetDemo.AudioManager.get_this().blast("SFX/"+this.clickSound+".ogg");var tmp=this.onClick;return tmp&&this.onClick(),!0}return!1},draw:function(g){(this._contents.getSize().x!==this.lContentSize.x||this._contents.getSize().y!==this.lContentSize.y)&&(this._buttonNeedsRerender=!0,this.lContentSize=this._contents.getSize().clone());this._buttonNeedsRerender&&(this.drawButton(),this._buttonNeedsRerender=!1);this.setSize(this._buttonBuffer.getSize().clone());this._buttonBuffer.draw(this.spriteGraphics);this.getContents().position=new BridgeNetDemo.Vector2(this._borderSize,this._borderSize);this.getContents().draw(this.spriteGraphics);g!=null&&BridgeNetDemo.Sprite.prototype.draw.call(this,g)}});Bridge.define("BridgeNetDemo.GameSprite",{inherits:[BridgeNetDemo.Sprite],constructor:function(){BridgeNetDemo.Sprite.prototype.$constructor.call(this)},update:function(){},render:function(){}});Bridge.define("BridgeNetDemo.ControllableEntity",{inherits:[BridgeNetDemo.Entity],controller:null,lController:null,constructor:function(game){BridgeNetDemo.Entity.prototype.$constructor.call(this,game);this.controller=Bridge.Array.init(7,!1);this.lController=Bridge.Array.init(this.controller.length,!1)}});Bridge.define("BridgeNetDemo.Illusion",{inherits:[BridgeNetDemo.Entity,BridgeNetDemo.ILightSource,BridgeNetDemo.ICombatant],_hp:.001,_lightPosition:null,_maxLightRadius:0,_targetPriority:0,_team:0,constructor:function(game){BridgeNetDemo.Entity.prototype.$constructor.call(this,game)},constructor$1:function(game,origin){if(BridgeNetDemo.Entity.prototype.$constructor.call(this,game),this.setPosition(origin.getPosition().clone()),this._team=Bridge.cast(origin,BridgeNetDemo.ICombatant).getTeam(),Bridge.is(origin,BridgeNetDemo.ILightSource)){var L=Bridge.cast(origin,BridgeNetDemo.ILightSource);this.setlightPosition(L.getlightPosition());this.setmaxLightRadius(L.getmaxLightRadius())}},getHP:function(){return this._hp},setHP:function(value){this._hp=Math.max(this._hp,value)},getlightFlicker:function(){return!1},getlightPosition:function(){return this._lightPosition==null?this.getCenter():this._lightPosition},setlightPosition:function(value){this._lightPosition=value},getmaxLightRadius:function(){return this._maxLightRadius},setmaxLightRadius:function(value){this._maxLightRadius=value},getPointsForKilling:function(){return 0},getTargetPriority:function(){return this._targetPriority},setTargetPriority:function(value){this._targetPriority=value},getTeam:function(){return this._team},setTeam:function(value){this._team=value},onDamaged:function(){},onDeath:function(){},onKill:function(){}});Bridge.define("BridgeNetDemo.MadnessOrb",{inherits:[BridgeNetDemo.Entity,BridgeNetDemo.ICombatant,BridgeNetDemo.ILightSource],_HP:0,constructor:function(game){BridgeNetDemo.Entity.prototype.$constructor.call(this,game);this.ani=new BridgeNetDemo.Animation(BridgeNetDemo.AnimationLoader.get("Flame"));this.ani.imageSpeed=.5;this.ani.setShadow(20);this.ani.setShadowcolor("#3388EE");this.ani.alpha=0;this.setHP(200)},getHP:function(){return this._HP},setHP:function(value){this._HP=value},getlightFlicker:function(){return!0},getlightPosition:function(){return this.getCenter()},getmaxLightRadius:function(){return 4},getTeam:function(){return 0},setTeam:function(){throw new Bridge.NotImplementedException;},getPointsForKilling:function(){return 1e4},getTargetPriority:function(){return.6},update:function(){this.ani.alpha=Math.min(1,this.ani.alpha+.025);BridgeNetDemo.Entity.prototype.update.call(this)},onDamaged:function(source,amount){this.setHP(this.getHP()-amount);this.getHP()<=0&&(this.alive=!1)},onDeath:function(){},onKill:function(){}});Bridge.define("BridgeNetDemo.MiniHakkero",{inherits:[BridgeNetDemo.EntityBehavior,BridgeNetDemo.IWeaponBehavior],_ammo:0,_maxAmmo:1,_shotDelay:0,_maxShotDelay:0,_angle:0,bulletGraphic:"Marisabullet",constructor:function(entity){BridgeNetDemo.EntityBehavior.prototype.$constructor.call(this,entity)},getEnergyCost:function(){return 5},getMaxCooldown:function(){return(this._maxAmmo*this._maxShotDelay|0)+27|0},setFiringAngle:function(value){this._angle=value},getWeaponType:function(){return 1},update:function(){var D,inaccuracy,V,HalfBulletSize,P;this._ammo>0&&(this._shotDelay=this._shotDelay-1|0,this._shotDelay<=0&&(this._shotDelay=this._maxShotDelay,this._ammo=this._ammo-1|0,this.entity.getHandledLocally()&&(D={},D.A=this._angle,inaccuracy=0,V=BridgeNetDemo.Vector2.fromRadian(-inaccuracy+Math.random()*(inaccuracy+inaccuracy)+this._angle),V=V.normalize(30),D.SX=V.x,D.SY=V.y,HalfBulletSize=new BridgeNetDemo.Vector2(100,10),P=BridgeNetDemo.Vector2.op_Addition(BridgeNetDemo.Vector2.op_Subtraction(this.entity.getCenter(),HalfBulletSize),V.normalize(100)),D.X=P.x,D.Y=P.y,this.sendCustomEvent(D,!0))));BridgeNetDemo.EntityBehavior.prototype.update.call(this)},customEvent:function(evt){var PB=new BridgeNetDemo.PlayerBullet(this.entity.game,this.entity,this.bulletGraphic);PB.settouchDamage(13);PB.setPosition(new BridgeNetDemo.Vector2(evt.X,evt.Y));PB.speed=new BridgeNetDemo.Vector2(evt.SX,evt.SY);PB.ani.rotation=evt.A;PB.duration=60;PB.setmaxLightRadius(2.5);PB.piercing=!0;this.entity.game.addEntity(PB);PB.playSound("pew")},fire:function(angle){this._angle=angle;this._ammo=this._maxAmmo}});Bridge.define("BridgeNetDemo.NavigatorAI",{inherits:[BridgeNetDemo.EntityBehavior],_lastProgress:Bridge.Long([1874919423,2328306]),_timeSinceLastProgress:0,persistence:45,_movementPriority:0,_moveTo:null,constructor:function(entity){BridgeNetDemo.EntityBehavior.prototype.$constructor.call(this,entity)},getMoveTo:function(){return this._moveTo},setMoveTo:function(value){BridgeNetDemo.Vector2.op_Equality(this._moveTo,value)||(this._lastProgress=Bridge.Long([1874919423,2328306]),this._timeSinceLastProgress=0,this._moveTo=value)},requestMoveTo:function(position,priority){if(priority===void 0&&(priority=.5),priority>this._movementPriority&&BridgeNetDemo.Vector2.op_Inequality(position,this._moveTo)&&(this.setMoveTo(position),BridgeNetDemo.Vector2.op_Equality(this.getMoveTo(),position)&&(this._movementPriority=priority,this.entity.getHandledLocally()))){var D={};D.T="MT";D.X=this._moveTo.x;D.Y=this._moveTo.y;D.P=this._movementPriority;this.sendCustomEvent(D,!0);this.entity.getHandledLocally()&&this.entity.refreshBehaviorTick(BridgeNetDemo.NetworkSync)}return!1},customEvent:function(evt){Bridge.referenceEquals(evt.T,"MT")&&this.requestMoveTo(new BridgeNetDemo.Vector2(evt.X,evt.Y),evt.P);Bridge.referenceEquals(evt.T,"R")&&this.reset()},resetController:function(){var controller=Bridge.cast(this.entity,BridgeNetDemo.ControllableEntity).controller;controller[0]=!1;controller[1]=!1;controller[2]=!1;controller[3]=!1},reset:function(){this.resetController();this._moveTo=null;this._movementPriority=-1},update:function(){var currentProgress,D,Platformer,T,T2,max,D1;if(this._moveTo!=null){var controller=Bridge.cast(this.entity,BridgeNetDemo.ControllableEntity).controller,lcontroller=Bridge.cast(this.entity,BridgeNetDemo.ControllableEntity).lController,relative=BridgeNetDemo.Vector2.op_Subtraction(this._moveTo,this.entity.getPosition());if(this.resetController(),Math.abs(relative.y)>Math.abs(relative.x)&&(relative.y>0?controller[3]=!0:controller[2]=!0),controller[0]=relative.x<0,controller[1]=relative.x>0,currentProgress=relative.getRoughLength(),this._lastProgress>currentProgress)this._lastProgress=currentProgress,this._timeSinceLastProgress=0;else if(this._timeSinceLastProgress+=Math.max(1,this.framesPerTick),this._timeSinceLastProgress>this.persistence){this.entity.getHandledLocally()&&(D={},D.T="R",this.sendCustomEvent(D,!0));return}if(Bridge.is(this.entity,BridgeNetDemo.PlatformerEntity)){if(Platformer=Bridge.cast(this.entity,BridgeNetDemo.PlatformerEntity),Platformer.onGround||(controller[2]=!1),Platformer.rightWall!=null&&controller[1]&&(controller[3]=!1,controller[2]=!0),Platformer.leftWall!=null&&controller[0]&&(controller[3]=!1,controller[2]=!0),Platformer.getVspeed()>=0&&Platformer.floor!=null&&(T=Platformer.floor,T2=T.getTileData(controller[0]?-1:1,0),T2==null||!T2.topSolid)){for(max=5;max>0;)if(T2=T2.getTileData(0,1),T2!=null&&T2.topSolid)break;else max=max-1|0;max<=0&&(controller[3]=!1,controller[2]=!0)}!Platformer.onGround&&this.framesPerTick<1&&(controller[3]=!1,controller[2]=!0)}(controller[0]&&lcontroller[1]||controller[1]&&lcontroller[0])&&(currentProgress<150?this.entity.getHandledLocally()&&(D1={},D1.T="R",this.sendCustomEvent(D1,!0)):Math.abs(relative.x)<150&&(controller[0]=!1,controller[1]=!1))}BridgeNetDemo.EntityBehavior.prototype.update.call(this)}});Bridge.define("BridgeNetDemo.NetworkSync",{inherits:[BridgeNetDemo.EntityBehavior],timer:0,automaticSyncInterval:0,fields:null,lFields:null,needsSync:!1,forcesFlush:!1,updating:!1,updateOnSync:!1,constructor:function(entity){BridgeNetDemo.EntityBehavior.prototype.$constructor.call(this,entity);this.fields=new Bridge.List$1(String)();this.setBehaviorName("NS")},addField:function(fieldName){return this.fields.contains(fieldName)?!1:(this.fields.add(fieldName),!0)},addFields:function(fieldNames){for(var fieldName,$t=Bridge.getEnumerator(fieldNames);$t.moveNext();)fieldName=$t.getCurrent(),this.addField(fieldName)},_sync:function(){var $t,field,val,i;if(this.entity.getHandledLocally()){var O=this.entity,D={},L=new Bridge.List$1(Object)(),ok=!1;for($t=Bridge.getEnumerator(this.fields);$t.moveNext();)field=$t.getCurrent(),val=this.getField(field),D[field]=val,L.add(val),(this.lFields==null||this.lFields.getCount()<L.getCount()||!Bridge.referenceEquals(this.lFields.getItem(L.getCount()-1|0),L.getItem(L.getCount()-1|0)))&&(ok=!0);i=0;ok&&(this.sendCustomEvent(D),this.lFields=L,this.forcesFlush&&(this.entity.game.netPlayNeedsFlush=!0))}},getField:function(fieldName){var O=this.entity;return O[fieldName]?O[fieldName]:O["get"+fieldName]?O["get"+fieldName]():(console.log('NetworkSync: Field "'+fieldName+'" was not in '+Bridge.getTypeName(Bridge.getType(this.entity))+"."),null)},setField:function(fieldName,data){var O=this.entity;if(O[fieldName]){O[fieldName]=data;return}if(O["set"+fieldName]){O["set"+fieldName](data);return}console.log('NetworkSync: Field "'+fieldName+'" was not in '+Bridge.getTypeName(Bridge.getType(this.entity))+".")},sync:function(){this.needsSync=!0},customEvent:function(evt){var O,field;if(!this.entity.getHandledLocally()){O=this.entity;for(field in evt)this.setField(field,evt[field]);this.updateOnSync&&this.entity.update()}},update:function(){this.updating||(this.updating=!0,this.automaticSyncInterval>0&&(this.timer=this.timer+1|0,this.timer>this.automaticSyncInterval&&(this.needsSync=!0,this.timer=0)),this.needsSync&&(this._sync(),this.needsSync=!1),this.updating=!1)}});Bridge.define("BridgeNetDemo.PlatformerControls",{inherits:[BridgeNetDemo.EntityBehavior],_platformer:null,accel:1.4,jumpSpeed:22,maxSpeed:6,constructor:function(entity){BridgeNetDemo.EntityBehavior.prototype.$constructor.call(this,entity);this._platformer=entity},update:function(){var controller=this._platformer.controller;controller[0]&&this._platformer.getHspeed()>-this.maxSpeed&&this._platformer.setHspeed(Math.max(this._platformer.getHspeed()-(this.accel+this._platformer.friction),-this.maxSpeed));controller[1]&&this._platformer.getHspeed()<this.maxSpeed&&this._platformer.setHspeed(Math.min(this._platformer.getHspeed()+(this.accel+this._platformer.friction),this.maxSpeed));this._platformer.getVspeed()>=0&&this._platformer.onGround&&(controller[2]&&this._platformer.ceiling==null?(this._platformer.setVspeed(-this.jumpSpeed),this.entity.playSound("jump")):controller[3]&&this._platformer.floor!=null&&this._platformer.floor.getplatform()&&(this._platformer.onGround=!1,this._platformer.floor=null,this._platformer.sety(this._platformer.gety()+2)));BridgeNetDemo.EntityBehavior.prototype.update.call(this)}});Bridge.define("BridgeNetDemo.PlayerBullet",{inherits:[BridgeNetDemo.Entity,BridgeNetDemo.IHarmfulEntity,BridgeNetDemo.ILightSource],shooter:null,duration:0,hitEntities:null,piercing:!1,spinrate:0,gravity:null,bounces:!1,_maxLightRadius:1.5,_touchDamage:1,config:{init:function(){this.gravity=new BridgeNetDemo.Vector2}},constructor:function(game,shooter,graphic){graphic===void 0&&(graphic="Reisenbullet");BridgeNetDemo.Entity.prototype.$constructor.call(this,game);this.ani=new BridgeNetDemo.Animation(BridgeNetDemo.AnimationLoader.get_this().getAnimation(graphic));this.shooter=shooter;this.ani.setHueColor(shooter.getTeamColor());this.ani.setHueRecolorStrength(1);this.piercing=!1;this.hitEntities=new Bridge.List$1(BridgeNetDemo.Entity)()},getAttacker:function(){return this.shooter},getIsHarmful:function(){return!0},getlightFlicker:function(){return!1},getlightPosition:function(){return this.getCenter()},getmaxLightRadius:function(){return this.ani.alpha>=1?this._maxLightRadius:0},setmaxLightRadius:function(value){this._maxLightRadius=value},gettouchDamage:function(){return this._touchDamage},settouchDamage:function(value){this._touchDamage=value},getHitbox:function(){if(this.ani!=null&&this.ani.getCurrentImage()!=null){var s=this.ani.getCurrentImage().height*1.5,so2=s/2,V=BridgeNetDemo.Vector2.op_Subtraction(this.getCenter(),new BridgeNetDemo.Vector2(so2,so2));return new BridgeNetDemo.Rectangle(V.x,V.y,s,s)}return null},ontouchDamage:function(target){this.piercing||(this.alive=!1);var ok=!this.hitEntities.contains(Bridge.cast(target,BridgeNetDemo.Entity));return ok?(this.hitEntities.add(Bridge.cast(target,BridgeNetDemo.Entity)),!0):!1},update:function(){BridgeNetDemo.Entity.prototype.update.call(this);this.spinrate!==0&&(this.ani.rotation+=this.spinrate);this.gravity.getRoughLength()!==0&&(this.speed=BridgeNetDemo.Vector2.op_Addition(this.speed,this.gravity));this.game.stageBounds.isTouching(this.getHitbox())||(this.ani.getX()>0==this.getHspeed()>0||this.ani.getX()<0==this.getHspeed()<0||this.ani.getY()>0==this.getVspeed()>0||this.ani.getY()<0==this.getVspeed()<0)&&(this.alive=!1);var center=this.getCenter(),T=null;this.bounces||(T=this.game.tM.checkForTile(center));T!=null&&T.enabled&&T.getsolid()?this.alive=!1:this.bounces&&(T=this.game.tM.checkForTile(BridgeNetDemo.Vector2.op_Addition(center,new BridgeNetDemo.Vector2(this.speed.x))),T!=null&&T.enabled&&T.solidToSpeed(this.speed.toCardinal())&&(this.speed.x=-this.speed.x),T=this.game.tM.checkForTile(BridgeNetDemo.Vector2.op_Addition(center,new BridgeNetDemo.Vector2(0,this.speed.y))),T!=null&&T.enabled&&T.solidToSpeed(this.speed.toCardinal())&&(this.speed.y=-this.speed.y),T=this.game.tM.checkForTile(BridgeNetDemo.Vector2.op_Addition(center,this.speed)),T!=null&&T.enabled&&T.solidToSpeed(this.speed.toCardinal())&&(this.speed.x=-this.speed.x,this.speed.y=-this.speed.y));this.duration>0&&(this.duration=this.duration-1|0,this.duration<=0&&(this.duration=1,this.ani.alpha-=.2,this.ani.alpha<=0&&(this.alive=!1)))}});Bridge.define("BridgeNetDemo.PlayerLaser",{inherits:[BridgeNetDemo.Entity,BridgeNetDemo.IHarmfulEntity,BridgeNetDemo.ILightProducer],duration:1,angle:0,length:2e3,width:12,activated:!1,config:{properties:{Attacker:null,touchDamage:0}},constructor:function(combatant,angle){BridgeNetDemo.Entity.prototype.$constructor.call(this,combatant.game);this.setAttacker(combatant);this.angle=angle;this.ani=new BridgeNetDemo.Animation(null);this.ani.position=combatant.getPosition().clone();this.ani.alpha=.7},getIsHarmful:function(){return!1},ontouchDamage:function(){return this.alive},getHitbox:function(){return null},update:function(){if(this.duration>0&&(this.duration=this.duration-1|0,this.duration<1&&(this.duration=1,this.ani.alpha-=.25,this.ani.alpha<=0&&(this.alive=!1))),!this.activated&&(this.activated=!0,this.getAttacker().getHandledLocally())){var T=Bridge.cast(this.getAttacker(),BridgeNetDemo.ICombatant).getTeam(),LE=new Bridge.List$1(BridgeNetDemo.Entity)(Bridge.Linq.Enumerable.from(this.game.entities).where(function(E){return Bridge.is(E,BridgeNetDemo.ICombatant)&&Bridge.cast(E,BridgeNetDemo.ICombatant).getTeam()!==T}));BridgeNetDemo.HelperExtensions.forEach(BridgeNetDemo.Entity,LE,Bridge.fn.bind(this,$_.BridgeNetDemo.PlayerLaser.f1))}BridgeNetDemo.Entity.prototype.update.call(this)},intersects:function(R){if(R==null)return!1;var w=this.width*3,s=new BridgeNetDemo.Vector2(w,w),a=BridgeNetDemo.MathHelper.wrapRadians(BridgeNetDemo.MathHelper.getAngle(this.getPosition(),BridgeNetDemo.Vector2.op_Subtraction(R.getMin(),s))-this.angle),b=BridgeNetDemo.MathHelper.wrapRadians(BridgeNetDemo.MathHelper.getAngle(this.getPosition(),BridgeNetDemo.Vector2.op_Addition(R.getMax(),s))-this.angle);return a<=0!=b<=0&&BridgeNetDemo.Vector2.op_Subtraction(R.getCenter(),this.getPosition()).getLength()<=this.length?!0:!1},draw:function(g){g.save();g.fillStyle=BridgeNetDemo.Game.getTeamColor(Bridge.cast(this.getAttacker(),BridgeNetDemo.ICombatant).getTeam());var s=this.width,so2=Bridge.Int.div(this.width,2)|0,s2=s+s|0,oa=-1;this.ani.alpha<1&&(oa=g.globalAlpha,g.globalAlpha=this.ani.alpha);g.translate(this.getPosition().x,this.getPosition().y);g.rotate(this.angle);g.fillRect(-s|0,-s|0,this.length,s2);g.fillStyle="rgba(255,255,255,128)";g.fillRect(-so2|0,-so2|0,this.length,s);this.ani.alpha<1&&(g.globalAlpha=oa);g.restore()},drawLight:function(g){var s=Bridge.Int.clip32(this.width*1.35),s2=s+s|0;g.save();g.translate(this.getPosition().x,this.getPosition().y);g.rotate(this.angle);g.fillRect(-s|0,-s|0,this.length,s2);g.restore()}});Bridge.ns("BridgeNetDemo.PlayerLaser",$_);Bridge.apply($_.BridgeNetDemo.PlayerLaser,{f1:function(E){this.intersects(E.getHitbox())&&this.game.attack(Bridge.cast(E,BridgeNetDemo.ICombatant),this)}});Bridge.define("BridgeNetDemo.RapidFireGun",{inherits:[BridgeNetDemo.EntityBehavior,BridgeNetDemo.IWeaponBehavior],_ammo:0,_maxAmmo:4,_shotDelay:0,_maxShotDelay:5,_angle:0,bulletGraphic:"Reisenbullet",constructor:function(entity){BridgeNetDemo.EntityBehavior.prototype.$constructor.call(this,entity)},getEnergyCost:function(){return 3.5},getMaxCooldown:function(){return(this._maxAmmo*this._maxShotDelay|0)+20|0},setFiringAngle:function(value){this._angle=value},getWeaponType:function(){return 1},update:function(){var D,inaccuracy,V,P;this._ammo>0&&(this._shotDelay=this._shotDelay-1|0,this._shotDelay<=0&&(this._shotDelay=this._maxShotDelay,this._ammo=this._ammo-1|0,this.entity.getHandledLocally()&&(D={},D.A=this._angle,inaccuracy=.1,V=BridgeNetDemo.Vector2.fromRadian(-inaccuracy+Math.random()*(inaccuracy+inaccuracy)+this._angle),V=V.normalize(35),D.SX=V.x,D.SY=V.y,P=BridgeNetDemo.Vector2.op_Addition(this.entity.getCenter(),V.normalize(12)),D.X=P.x,D.Y=P.y,this.sendCustomEvent(D,!0))));BridgeNetDemo.EntityBehavior.prototype.update.call(this)},customEvent:function(evt){var PB=new BridgeNetDemo.PlayerBullet(this.entity.game,this.entity,this.bulletGraphic);PB.settouchDamage(7.5);PB.setPosition(new BridgeNetDemo.Vector2(evt.X,evt.Y));PB.speed=new BridgeNetDemo.Vector2(evt.SX,evt.SY);PB.ani.rotation=evt.A;PB.duration=35;this.entity.game.addEntity(PB);PB.playSound("pew")},fire:function(angle){this._angle=angle;this._ammo=this._maxAmmo}});Bridge.define("BridgeNetDemo.ReisenAI",{inherits:[BridgeNetDemo.EntityBehavior],_currentReactionTime:0,maxReactionTime:40,_newTarget:null,_currentTarget:null,sightRange:924,inacccuracy:.15,constructor:function(entity){BridgeNetDemo.EntityBehavior.prototype.$constructor.call(this,entity)},update:function(){var PC,combatants,target,D,D1,D2,T,N,P,V;BridgeNetDemo.EntityBehavior.prototype.update.call(this);PC=Bridge.cast(this.entity,BridgeNetDemo.PlayerCharacter);combatants=new Bridge.List$1(BridgeNetDemo.Entity)(Bridge.Linq.Enumerable.from(this.entity.game.entities).where(Bridge.fn.bind(this,function(E){return Bridge.is(E,BridgeNetDemo.ICombatant)&&!PC.sameTeam(E)&&Bridge.cast(E,BridgeNetDemo.ICombatant).getHP()>0&&(BridgeNetDemo.MathHelper.roughDistanceBetweenPoints(E.getPosition(),PC.getPosition())<=this.sightRange||Bridge.referenceEquals(E,this._currentTarget))})));combatants.sort(function(A,B){return Bridge.compare(BridgeNetDemo.MathHelper.roughDistanceBetweenPoints(A.getPosition(),PC.getPosition()),BridgeNetDemo.MathHelper.roughDistanceBetweenPoints(B.getPosition(),PC.getPosition()))});combatants.sort($_.BridgeNetDemo.ReisenAI.f1);combatants.getCount()>0&&(target=combatants.getItem(0),Bridge.referenceEquals(target,this._newTarget)?(this._currentReactionTime+=this.framesPerTick,this._currentReactionTime>=this.maxReactionTime&&this.entity.getHandledLocally()&&(D={},D.I=this._newTarget!=null?this._newTarget.iD:null,this.sendCustomEvent(D,!0))):(this._newTarget=target,this._currentReactionTime=Math.random()*this.maxReactionTime*.5),BridgeNetDemo.MathHelper.roughDistanceBetweenPoints(this._newTarget.getPosition(),this.entity.getPosition())>this.sightRange&&(this._newTarget=null,this._currentReactionTime=0));this._currentTarget!=null&&Bridge.cast(this._currentTarget,BridgeNetDemo.ICombatant).getHP()>0&&!this.entity.sameTeam(this._currentTarget)?(PC.controller[4]=!0,PC.setaimAngle(BridgeNetDemo.MathHelper.getAngle(PC.getPosition(),this._currentTarget.getPosition())-this.inacccuracy+Math.random()*(this.inacccuracy+this.inacccuracy)),D1=BridgeNetDemo.Vector2.op_Subtraction(PC.getPosition(),this._currentTarget.getPosition()).getRoughLength(),D2=BridgeNetDemo.Vector2.op_Subtraction(PC.getPosition(),BridgeNetDemo.Vector2.op_Addition(this._currentTarget.getPosition(),this._currentTarget.speed)).getRoughLength(),PC.controller[5]&&!PC.onGround&&PC.gety()>this._currentTarget.gety()?(PC.controller[2]=!0,PC.controller[3]=!1):(this.entity.getHandledLocally()&&PC.controller[5]&&PC.refreshBehaviorTick(BridgeNetDemo.NetworkSync),PC.controller[5]=!1),D2>D1&&D1>this.sightRange*.75&&(this.entity.getHandledLocally()&&!PC.controller[5]&&PC.refreshBehaviorTick(BridgeNetDemo.NetworkSync),PC.controller[5]=!0),!PC.controller[5]&&BridgeNetDemo.MathHelper.roughDistanceBetweenPoints(this._currentTarget.getPosition(),this.entity.getPosition())>this.sightRange*1.5?this.entity.getHandledLocally()&&(T={},T.I=null,this.sendCustomEvent(T,!0)):this.entity.getHandledLocally()&&(N=this.entity.getBehavior(BridgeNetDemo.NavigatorAI),N==null&&(N=new BridgeNetDemo.NavigatorAI(Bridge.cast(this.entity,BridgeNetDemo.ControllableEntity)),N.framesPerTick=Bridge.Int.div(this.framesPerTick,3)|0,this.entity.addBehavior(N)),P=BridgeNetDemo.Vector2.op_Subtraction(this.entity.getPosition(),this._currentTarget.getPosition()),P.getRoughLength()>150&&(V=BridgeNetDemo.Vector2.op_Addition(this._currentTarget.getPosition(),P.normalize(150)),N.requestMoveTo(V,.6)))):(PC.controller[4]=!1,PC.controller[5]=!1,PC.setaimAngle(BridgeNetDemo.MathHelper.getAngle(PC.getPosition(),BridgeNetDemo.Vector2.op_Addition(PC.getPosition(),PC.speed))))},customEvent:function(evt){if(evt.I==null){this._currentTarget=null;return}this._currentTarget=this.entity.game.entityFromID(evt.I)}});Bridge.ns("BridgeNetDemo.ReisenAI",$_);Bridge.apply($_.BridgeNetDemo.ReisenAI,{f1:function(A,B){return-Bridge.compare(Bridge.cast(A,BridgeNetDemo.ICombatant).getTargetPriority(),Bridge.cast(B,BridgeNetDemo.ICombatant).getTargetPriority())|0}});Bridge.define("BridgeNetDemo.TeamSwitcher",{inherits:[BridgeNetDemo.EntityBehavior],constructor:function(combatant){BridgeNetDemo.EntityBehavior.prototype.$constructor.call(this,combatant)},update:function(){if(this.entity.getHandledLocally()){var RedTeam=new Bridge.List$1(BridgeNetDemo.Entity)(Bridge.Linq.Enumerable.from(this.entity.game.entities).where($_.BridgeNetDemo.TeamSwitcher.f1)),BlueTeam=new Bridge.List$1(BridgeNetDemo.Entity)(Bridge.Linq.Enumerable.from(this.entity.game.entities).where($_.BridgeNetDemo.TeamSwitcher.f2)),offset=0;((RedTeam.getCount()+BlueTeam.getCount()|0)&1)>0&&(offset=1);RedTeam.getCount()>(BlueTeam.getCount()+offset|0)?Bridge.cast(this.entity,BridgeNetDemo.ICombatant).setTeam(2):BlueTeam.getCount()>(RedTeam.getCount()+offset|0)&&Bridge.cast(this.entity,BridgeNetDemo.ICombatant).setTeam(1)}BridgeNetDemo.EntityBehavior.prototype.update.call(this)}});Bridge.ns("BridgeNetDemo.TeamSwitcher",$_);Bridge.apply($_.BridgeNetDemo.TeamSwitcher,{f1:function(E){return Bridge.is(E,BridgeNetDemo.ICombatant)&&Bridge.cast(E,BridgeNetDemo.ICombatant).getTeam()===1},f2:function(E){return Bridge.is(E,BridgeNetDemo.ICombatant)&&Bridge.cast(E,BridgeNetDemo.ICombatant).getTeam()===2}});Bridge.define("BridgeNetDemo.TextSprite",{inherits:[BridgeNetDemo.Sprite],_Text:null,textInvallidated:!1,imageInvallidated:!1,textImage:null,textGraphic:null,_TextColor:null,_FontWeight:"normal",_FontFamily:"sans-serif",_FontSize:10,_shadowBlur:0,_shadowOffset:null,_shadowColor:"#000000",config:{init:function(){this._shadowOffset=new BridgeNetDemo.Vector2}},constructor:function(){BridgeNetDemo.Sprite.prototype.$constructor.call(this);this.textImage=document.createElement("canvas");this.textGraphic=this.textImage.getContext("2d");this.textGraphic.fillStyle="#FFFFFF"},getText:function(){return this._Text},setText:function(value){Bridge.referenceEquals(this._Text,value)||(this._Text=value,this.textInvallidated=!0)},getTextColor:function(){return this._TextColor},setTextColor:function(value){Bridge.referenceEquals(this._TextColor,value)||(this._TextColor=value,this.textInvallidated=!0)},getFontWeight:function(){return this._FontWeight},setFontWeight:function(value){Bridge.referenceEquals(this._FontWeight,value)||(this._FontWeight=value,this.updateFont())},getFontFamily:function(){return this._FontFamily},setFontFamily:function(value){Bridge.referenceEquals(this._FontFamily,value)||(this._FontFamily=value,this.updateFont())},getFontSize:function(){return this._FontSize},setFontSize:function(value){this._FontSize!==value&&(this._FontSize=value,this.updateFont())},getShadowBlur:function(){return this._shadowBlur},setShadowBlur:function(value){this._shadowBlur!==value&&(this._shadowBlur=value,this.imageInvallidated=!0)},getShadowOffset:function(){return this._shadowOffset.clone()},setShadowOffset:function(value){BridgeNetDemo.Vector2.op_Inequality(this._shadowOffset,value)&&value.x!==this._shadowOffset.x&&value.y!==this._shadowOffset.y&&(this._shadowOffset=value.clone(),this.imageInvallidated=!0)},getShadowColor:function(){return this._shadowColor},setShadowColor:function(value){Bridge.referenceEquals(this._shadowColor,value)||(this._shadowColor=value,this.imageInvallidated=!0)},updateFont:function(){this.textGraphic.font=this._FontWeight+" "+this._FontSize+"px "+this._FontFamily;this.textInvallidated=!0;this.imageInvallidated=!0;this.textGraphic.fillStyle=this._TextColor},redrawBaseTextImage:function(){var TM,Y;this.updateFont();for(var lines=this._Text.split(String.fromCharCode(10)),H=this.getFontSize()*1,W=0,i=0;i<lines.length;)TM=this.textGraphic.measureText(lines[i]),W=Math.max(W,Bridge.Int.clip32(Math.ceil(TM.width))),i=i+1|0;for(this.textImage.height=Bridge.Int.clip32(H*(lines.length+.25)),this.textImage.width=W,this.updateFont(),Y=0,i=0;i<lines.length;)this.textGraphic.fillText(lines[i],0,this.getFontSize()+Y),Y+=H,i=i+1|0;this.textInvallidated=!1;this.imageInvallidated=!0},renderTextImage:function(){if(this._shadowBlur<=0)this.spriteBuffer.width=this.textImage.width,this.spriteBuffer.height=this.textImage.height;else{var S=Bridge.Int.clip32(Math.ceil(this._shadowBlur+this._shadowBlur));this.spriteBuffer.width=this.textImage.width+S|0;this.spriteBuffer.height=this.textImage.height+S|0}this.spriteGraphics.shadowBlur=0;this.spriteGraphics.globalCompositeOperation="source-over";this._shadowBlur<=0?this.spriteGraphics.drawImage(this.textImage,0,0):this.spriteGraphics.drawImage(this.textImage,this._shadowBlur,this._shadowBlur);this._shadowBlur>0&&(this.spriteGraphics.shadowBlur=this._shadowBlur,this.spriteGraphics.shadowColor=this._shadowColor,this.spriteGraphics.shadowOffsetX=this._shadowOffset.x,this.spriteGraphics.shadowOffsetY=this._shadowOffset.y,this.spriteGraphics.drawImage(this.spriteBuffer,0,0));this.imageInvallidated=!1},draw:function(g){this.textInvallidated&&this.redrawBaseTextImage();this.imageInvallidated&&this.renderTextImage();BridgeNetDemo.Sprite.prototype.draw.call(this,g)}});Bridge.define("BridgeNetDemo.Tile",{inherits:[BridgeNetDemo.Entity],tile:0,constructor:function(game,tile){BridgeNetDemo.Entity.prototype.$constructor.call(this,game);this.tile=tile;this.ani=new BridgeNetDemo.Animation(BridgeNetDemo.AnimationLoader.get("Tile"));this.ani.currentFrame=tile;this.ani.imageSpeed=0},draw:function(g){BridgeNetDemo.Entity.prototype.draw.call(this,g)}});Bridge.define("BridgeNetDemo.WanderAI",{inherits:[BridgeNetDemo.EntityBehavior],randomDirection:!0,constructor:function(entity){BridgeNetDemo.EntityBehavior.prototype.$constructor.call(this,entity)},update:function(){var N=this.entity.getBehavior(BridgeNetDemo.NavigatorAI),wanderRange,X,V,R;N==null&&(N=new BridgeNetDemo.NavigatorAI(Bridge.cast(this.entity,BridgeNetDemo.ControllableEntity)),N.framesPerTick=Bridge.Int.div(this.framesPerTick,3)|0,this.entity.addBehavior(N));N.getMoveTo()==null&&(wanderRange=1200,X=wanderRange,this.randomDirection?Math.random()<.5&&(X=-X):(this.entity.ani.flipped&&(X=-wanderRange),Math.random()<.05&&(X=-X)),X*=Math.random(),V=BridgeNetDemo.Vector2.op_Addition(this.entity.getPosition(),new BridgeNetDemo.Vector2(X,0)),R=this.entity.game.stageBounds,R.containsPoint(V)||R.containsPoint(BridgeNetDemo.Vector2.op_Addition(this.entity.getPosition(),new BridgeNetDemo.Vector2(-X,0)))&&(V=BridgeNetDemo.Vector2.op_Addition(this.entity.getPosition(),new BridgeNetDemo.Vector2(-X,0))),N.requestMoveTo(V,.4));BridgeNetDemo.EntityBehavior.prototype.update.call(this)}});Bridge.define("BridgeNetDemo.WideShot",{inherits:[BridgeNetDemo.EntityBehavior,BridgeNetDemo.IWeaponBehavior],_ammo:0,_shotPerWave:3,_maxAmmo:1,_shotDelay:0,_maxShotDelay:0,_angle:0,bulletGraphic:"Sakuyabullet",constructor:function(entity){BridgeNetDemo.EntityBehavior.prototype.$constructor.call(this,entity)},getEnergyCost:function(){return 4.5},getMaxCooldown:function(){return(this._maxAmmo*this._maxShotDelay|0)+50|0},setFiringAngle:function(value){this._angle=value},getWeaponType:function(){return 1},update:function(){var D,inaccuracy,V,P;this._ammo>0&&(this._shotDelay=this._shotDelay-1|0,this._shotDelay<=0&&(this._shotDelay=this._maxShotDelay,this._ammo=this._ammo-1|0,this.entity.getHandledLocally()&&(D={},D.A=this._angle,inaccuracy=.1,V=BridgeNetDemo.Vector2.fromRadian(-inaccuracy+Math.random()*(inaccuracy+inaccuracy)+this._angle),V=V.normalize(15),D.SX=V.x,D.SY=V.y,P=BridgeNetDemo.Vector2.op_Addition(this.entity.getCenter(),V.normalize(12)),D.X=P.x,D.Y=P.y,this.sendCustomEvent(D,!0))));BridgeNetDemo.EntityBehavior.prototype.update.call(this)},customEvent:function(evt){var damage=10,duration=60,PB=new BridgeNetDemo.PlayerBullet(this.entity.game,this.entity,this.bulletGraphic);PB.settouchDamage(damage);PB.setPosition(new BridgeNetDemo.Vector2(evt.X,evt.Y));PB.speed=new BridgeNetDemo.Vector2(evt.SX,evt.SY);PB.ani.rotation=evt.A;PB.duration=duration;this.entity.game.addEntity(PB);for(var sep=PB.speed.normalize(35),up=sep.rotate(-2.35619),down=sep.rotate(2.35619),i=this._shotPerWave,U=PB.getPosition().clone(),D=PB.getPosition().clone();i>0;)U=BridgeNetDemo.Vector2.op_Addition(U,up),PB=new BridgeNetDemo.PlayerBullet(this.entity.game,this.entity,this.bulletGraphic),PB.settouchDamage(damage),PB.setPosition(U.clone()),PB.speed=new BridgeNetDemo.Vector2(evt.SX,evt.SY),PB.ani.rotation=evt.A,PB.duration=duration,this.entity.game.addEntity(PB),D=BridgeNetDemo.Vector2.op_Addition(D,down),PB=new BridgeNetDemo.PlayerBullet(this.entity.game,this.entity,this.bulletGraphic),PB.settouchDamage(damage),PB.setPosition(D.clone()),PB.speed=new BridgeNetDemo.Vector2(evt.SX,evt.SY),PB.ani.rotation=evt.A,PB.duration=duration,this.entity.game.addEntity(PB),i=i-2|0;PB.playSound("pew")},fire:function(angle){this._angle=angle;this._ammo=this._maxAmmo}});Bridge.define("BridgeNetDemo.YinyangShot",{inherits:[BridgeNetDemo.EntityBehavior,BridgeNetDemo.IWeaponBehavior],_ammo:0,_maxAmmo:1,_shotDelay:0,_maxShotDelay:5,_angle:0,bulletGraphic:"Yinyangorb",constructor:function(entity){BridgeNetDemo.EntityBehavior.prototype.$constructor.call(this,entity)},getEnergyCost:function(){return 7},getMaxCooldown:function(){return(this._maxAmmo*this._maxShotDelay|0)+75|0},setFiringAngle:function(value){this._angle=value},getWeaponType:function(){return 1},update:function(){var D,inaccuracy,V,halfsize,P;this._ammo>0&&(this._shotDelay=this._shotDelay-1|0,this._shotDelay<=0&&(this._shotDelay=this._maxShotDelay,this._ammo=this._ammo-1|0,this.entity.getHandledLocally()&&(D={},D.A=this._angle,inaccuracy=.1,V=BridgeNetDemo.Vector2.fromRadian(-inaccuracy+Math.random()*(inaccuracy+inaccuracy)+this._angle),V=V.normalize(16),D.SX=V.x,D.SY=V.y,halfsize=24,P=BridgeNetDemo.Vector2.op_Addition(BridgeNetDemo.Vector2.op_Subtraction(this.entity.getCenter(),new BridgeNetDemo.Vector2(halfsize,halfsize)),V.normalize(halfsize+halfsize)),D.X=P.x,D.Y=P.y,this.sendCustomEvent(D,!0))));BridgeNetDemo.EntityBehavior.prototype.update.call(this)},customEvent:function(evt){var PB=new BridgeNetDemo.PlayerBullet(this.entity.game,this.entity,this.bulletGraphic);PB.settouchDamage(17);PB.piercing=!0;PB.setPosition(new BridgeNetDemo.Vector2(evt.X,evt.Y));PB.speed=new BridgeNetDemo.Vector2(evt.SX,evt.SY);PB.ani.rotation=evt.A;PB.duration=80;PB.bounces=!0;PB.spinrate=.2;PB.speed.x<0&&(PB.spinrate=-PB.spinrate);PB.gravity=new BridgeNetDemo.Vector2(0,.35);PB.bounces=!0;this.entity.game.addEntity(PB);PB.playSound("pew")},fire:function(angle){this._angle=angle;this._ammo=this._maxAmmo}});Bridge.define("BridgeNetDemo.CharacterSelect",{inherits:[BridgeNetDemo.GameSprite],titletext:null,gamePlaySettings:null,bG:null,menu:null,buttons:null,iE:null,mainMenu:null,constructor:function(){var def,i,M;if(BridgeNetDemo.GameSprite.prototype.$constructor.call(this),this.gamePlaySettings=BridgeNetDemo.App.gamePlaySettings,this.titletext=new BridgeNetDemo.TextSprite,this.titletext.setTextColor("#FFFFFF"),this.titletext.setText("Choose a Character"),this.titletext.setFontSize(60),this.titletext.position=new BridgeNetDemo.Vector2(50,50),this.menu=new BridgeNetDemo.ButtonMenu(0,600,50),this.menu.position=new BridgeNetDemo.Vector2(150,200),this.menu.selectionMenu=!0,def=null,this.gamePlaySettings.gameMode.getAllowCharacterSelect())for(i=0,def=this.menu.addButton(BridgeNetDemo.PlayerCharacter.characters[Bridge.identity(i,i=i+1|0)]);i<BridgeNetDemo.PlayerCharacter.characters.length;)this.menu.addButton(BridgeNetDemo.PlayerCharacter.characters[Bridge.identity(i,i=i+1|0)]);else def=this.menu.addButton(this.gamePlaySettings.myCharacter);this.gamePlaySettings.online&&(this.iE=document.createElement("input"),this.iE.type="text",this.iE.defaultValue="Player Name",Bridge.global.localStorage.getItem("PlayerName")&&(this.iE.value=Bridge.cast(Bridge.global.localStorage.getItem("PlayerName"),String)),this.iE.style.transform="Scale(1.5)",BridgeNetDemo.App.addElementAtPosition(this.iE,new BridgeNetDemo.Vector2(600,20)));this.menu.finish(999999999);this.menu.select(def);this.bG=new BridgeNetDemo.Animation(BridgeNetDemo.AnimationLoader.get("BG"));M=new BridgeNetDemo.ButtonMenu(0,800,50);M.position=new BridgeNetDemo.Vector2(880,0);M.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite));M.addButton("OK");M.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite));M.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite));M.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite));M.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite));M.addButton("TitleScreen");M.finish(999999999);M.onChoose=Bridge.fn.bind(this,function(){var S=M.getSelectedData();Bridge.referenceEquals(S,"TitleScreen")?BridgeNetDemo.App.setView(new BridgeNetDemo.TitleScreen):Bridge.referenceEquals(S,"OK")&&(this.gamePlaySettings.myCharacter=this.menu.getSelectedData(),!this.gamePlaySettings.online||!Bridge.referenceEquals(this.iE.value,this.iE.defaultValue)&&this.iE.value.length>2?(this.gamePlaySettings.online&&Bridge.global.localStorage.setItem("PlayerName",this.iE.value),BridgeNetDemo.App.setView(new BridgeNetDemo.GameLobby)):this.titletext.setText("Please input a name."))});this.mainMenu=M},update:function(){this.menu.update();this.mainMenu.update();BridgeNetDemo.GameSprite.prototype.update.call(this)},render:function(){this.spriteBuffer.width=BridgeNetDemo.App.canvas.width;this.spriteBuffer.height=BridgeNetDemo.App.canvas.height;this.spriteGraphics.globalAlpha=1;this.bG.draw(this.spriteGraphics);this.spriteGraphics.globalAlpha=.6;this.spriteGraphics.fillStyle="#000000";this.spriteGraphics.fillRect(0,0,this.spriteBuffer.width,this.spriteBuffer.height);this.spriteGraphics.globalAlpha=1;this.menu.draw(this.spriteGraphics);this.titletext.draw(this.spriteGraphics);this.mainMenu.draw(this.spriteGraphics);BridgeNetDemo.GameSprite.prototype.render.call(this)}});Bridge.define("BridgeNetDemo.Game",{inherits:[BridgeNetDemo.GameSprite],statics:{playMusic:function(song){var M=BridgeNetDemo.AudioManager.get_this().get("BGM/"+song+".ogg");M.getIsPlaying()||(BridgeNetDemo.AudioManager.get_this().stopAllFromDirectory("BGM/"),M.setVolume(.35),M.setLoop(!0),M.play())},getTeamColor:function(team){return team===1?"#FF0000":team===2||team===0?"#0000FF":team===3?"#FFFF00":"#000000"}},gamePlaySettings:null,entities:null,players:null,localplayer:null,camera:null,stageBounds:null,bG:0,bGs:null,tM:null,lights:null,lighting:null,lG:null,darknessColor:0,darknessAlpha:0,maxDarknessAlpha:0,useTeamColors:!1,textDisplay:null,respawnText:null,helpDisplay:null,lagReduction:!1,gameStarted:!1,showHitbox:!1,updated:!1,dEBUG:!1,_IsUpdating:!1,connected:!1,visionModifier:0,_netPlayTicks:0,_maxNetPlayTicks:6,netPlayNeedsFlush:!1,nP:null,paused:!1,gameEnd:!1,gameEndTimer:0,maxGameEndTimer:600,latencyM:100,dlatency:0,constructor:function(){BridgeNetDemo.GameSprite.prototype.$constructor.call(this);this.gamePlaySettings=BridgeNetDemo.App.gamePlaySettings;this.entities=new Bridge.List$1(BridgeNetDemo.Entity)();this.players=new Bridge.List$1(BridgeNetDemo.Player)();this.lights=new Bridge.List$1(BridgeNetDemo.Light)();this.localplayer=new BridgeNetDemo.Player(!0,!1);var PC=new BridgeNetDemo.PlayerCharacter(this,this.localplayer,this.gamePlaySettings.myCharacter);this.players.add(this.localplayer);this.addEntity(PC);PC.setTeam(this.gamePlaySettings.myTeam);PC.setx(360);PC.sety(1e3);this.camera=new BridgeNetDemo.Camera;this.stageBounds=new BridgeNetDemo.Rectangle(0,0,8e3,3e3);this.bGs=BridgeNetDemo.AnimationLoader.get("BG");this.bG=0;this.tM=new BridgeNetDemo.TileMap(this);this.spriteBuffer.width=BridgeNetDemo.App.canvas.width;this.spriteBuffer.height=BridgeNetDemo.App.canvas.height;this.lighting=document.createElement("canvas");this.lighting.width=BridgeNetDemo.App.canvas.width;this.lighting.height=BridgeNetDemo.App.canvas.height;this.lG=this.lighting.getContext("2d");this.darknessColor=102;this.darknessAlpha=0;this.maxDarknessAlpha=.75;BridgeNetDemo.Light.img=new Image;BridgeNetDemo.Light.img.src=BridgeNetDemo.AnimationLoader.directory+"Light0.png";this.visionModifier=1;this.spriteGraphics.imageSmoothingEnabled=BridgeNetDemo.App.g.imageSmoothingEnabled;this.textDisplay=new BridgeNetDemo.TextSprite;this.textDisplay.setTextColor("#FFFFFF");this.textDisplay.setFontSize(24);this.textDisplay.setShadowBlur(6);this.textDisplay.setShadowOffset(new BridgeNetDemo.Vector2(20,20));this.textDisplay.setShadowColor("#000000");this.updateDisplayText();this.respawnText=new BridgeNetDemo.TextSprite;this.respawnText.setText("");this.respawnText.setTextColor("#FFFFFF");this.respawnText.setFontSize(60);this.respawnText.setShadowBlur(6);this.respawnText.setShadowOffset(new BridgeNetDemo.Vector2(20,20));this.respawnText.position.y=260;this.respawnText.position.x=260;this.helpDisplay=new BridgeNetDemo.TextSprite;this.helpDisplay.setTextColor("#FFFFFF");this.helpDisplay.setFontSize(18);this.helpDisplay.setShadowBlur(6);this.helpDisplay.setShadowOffset(new BridgeNetDemo.Vector2(20,20));this.helpDisplay.setShadowColor("#000000");this.helpDisplay.setText("F1:Help");PC.getTeam()===2&&(PC.getPosition().x=this.stageBounds.getright()-PC.getPosition().x)},getIsUpdating:function(){return this._IsUpdating},getHoster:function(){return this.nP==null||this.nP.getHoster()},getOnline:function(){return this.nP!=null},playSoundEffect:function(source,sound){var vol=1,maxLength=1200,dist;if(source!=null&&(dist=BridgeNetDemo.Vector2.op_Subtraction(this.camera.getCenter(),source).getLength(),dist-=450,dist>0)){if(dist>=maxLength)return;vol=1-dist/maxLength}BridgeNetDemo.AudioManager.get_this().blast("SFX/"+sound+".ogg",vol)},updateDisplayText:function(){var lives=this.localplayer.lives.toString(),T;Bridge.referenceEquals(lives,"-1")&&(lives="∞");T="";this.getOnline()&&(T="\nLatency:"+BridgeNetDemo.App.limitStringSize(Bridge.Single.format(this.dlatency/this.latencyM,"G"),8));this.textDisplay.setText("Level:1\nScore:"+this.localplayer.score+"\nLives:"+lives+T)},generateMadnessOrbs:function(){for(var i=0,M,T,D;i<3;)M=new BridgeNetDemo.MadnessOrb(this),M.setPosition(new BridgeNetDemo.Vector2(this.stageBounds.getleft()+(this.stageBounds.width-200)*Math.random(),this.stageBounds.gettop()+(this.stageBounds.height-200)*Math.random())),T=this.tM.checkForTile(BridgeNetDemo.Vector2.op_Addition(M.getPosition(),new BridgeNetDemo.Vector2(64,64))),T==null||T.enabled&&T.getsolid()||(T=this.tM.checkForTile(BridgeNetDemo.Vector2.op_Addition(M.getPosition(),new BridgeNetDemo.Vector2(64,544))),T!=null&&T.enabled&&T.getsolid()&&(D={},D.I=BridgeNetDemo.Helper.getRandomString(),D.T=Bridge.getTypeName(Bridge.getType(M)),D.X=M.getPosition().x,D.Y=M.getPosition().y,this.sendEvent("Spawn",D),i=i+1|0))},addEntity:function(E){this.entities.contains(E)||(this.entities.add(E),Bridge.is(E,BridgeNetDemo.ILightSource)&&(Bridge.Linq.Enumerable.from(this.lights).any(function(l){return Bridge.referenceEquals(l.source,E)})||this.lights.add(new BridgeNetDemo.Light(this,E))))},removeEntity:function(E){var $t,L,item;if(this.entities.contains(E)&&(this.entities.remove(E),Bridge.is(E,BridgeNetDemo.ILightSource)))for(L=new Bridge.List$1(BridgeNetDemo.Light)(Bridge.Linq.Enumerable.from(this.lights).where(function(l){return Bridge.referenceEquals(l.source,E)})),$t=Bridge.getEnumerator(L);$t.moveNext();)item=$t.getCurrent(),this.lights.remove(item)},updateControls:function(){var PC=this.localplayer.character,threshhold=.7,C=PC.controller,x,y,cid,aim,o;BridgeNetDemo.App.iC!=null&&(x=BridgeNetDemo.App.iC.getState(0),y=BridgeNetDemo.App.iC.getState(1),C[0]=x<=-threshhold,C[1]=x>=threshhold,C[2]=y<=-threshhold,C[3]=y>=threshhold,cid=BridgeNetDemo.App.iC.getMapControllerID$1(5),Bridge.referenceEquals(cid,"Keyboard")||Bridge.referenceEquals(cid,"Mouse")?(PC.aimAt(this.getMouse()),C[4]=BridgeNetDemo.App.iC.getPressed(2),C[5]=BridgeNetDemo.App.iC.getPressed(3),C[6]=BridgeNetDemo.App.iC.getPressed(4)):(aim=new BridgeNetDemo.Vector2(BridgeNetDemo.App.iC.getState(4),BridgeNetDemo.App.iC.getState(5)),aim.getRoughLength()>.5&&PC.setaimAngle(aim.toAngle())),C[4]=BridgeNetDemo.App.iC.getPressed(2),C[5]=BridgeNetDemo.App.iC.getPressed(3),C[6]=BridgeNetDemo.App.iC.getPressed(4),o={})},update:function(){var i,E;if(this._IsUpdating=!0,this.updateSystemControls(),this.updateControls(),this.preUpdate(),!this.gameStarted||this.paused){this.updated=!0;return}for(this.entities.sort($_.BridgeNetDemo.Game.f1),i=0;i<this.entities.getCount();)E=this.entities.getItem(i),E.alive&&E.update(),E.alive||(E.onRemove(),this.removeEntity(E),i=i-1|0),i=i+1|0;this.updateCollisions();this.gameplayUpdate();this.updateLighting();this.postUpdate();this._IsUpdating=!1;this.updated=!0},preUpdate:function(){var D,rid,i,RedTeam,BlueTeam;if(!this.gameStarted&&this.updated){if(this.gamePlaySettings.online&&(this.nP=this.gamePlaySettings.hostNPOut,this.nP==null?(rid=this.gamePlaySettings.roomID,this.nP=new BridgeNetDemo.NetPlay(rid,Bridge.cast(Bridge.global.localStorage.getItem("PlayerName"),String))):console.log("NetPlay host detected, Hoster:"+this.getHoster()),this.nP.onMessage=Bridge.fn.bind(this,this.processEvent),this.nP.onOpen=Bridge.fn.bind(this,this.onConnect),this.paused=!0),this.useTeamColors=!0,this.localplayer.character.setTeam(this.localplayer.character.getTeam()+0|0),i=0,this.getHoster()){while(i<this.gamePlaySettings.redNPCs)D={},D.I=BridgeNetDemo.Helper.getRandomString(),D.T=Bridge.getTypeName(Bridge.getType(this.localplayer.character)),D.X=i*80|0,D.X+=400,D.Y=1e3,D.D={},D.D.Team=1,this.sendEvent("Spawn",D),i=i+1|0;for(i=0;i<this.gamePlaySettings.blueNPCs;)D={},D.I=BridgeNetDemo.Helper.getRandomString(),D.T=Bridge.getTypeName(Bridge.getType(this.localplayer.character)),D.X=i*80|0,D.X=this.stageBounds.getright()-(400+D.X),D.Y=1e3,D.D={},D.D.Team=2,this.sendEvent("Spawn",D),i=i+1|0}BridgeNetDemo.Game.playMusic("Lunatic red eyes");this.gameStarted=!0}this.getOnline()&&this.paused&&this.getHoster()&&(RedTeam=new Bridge.List$1(BridgeNetDemo.Entity)(Bridge.Linq.Enumerable.from(this.entities).where($_.BridgeNetDemo.Game.f2)),BlueTeam=new Bridge.List$1(BridgeNetDemo.Entity)(Bridge.Linq.Enumerable.from(this.entities).where($_.BridgeNetDemo.Game.f3)),(RedTeam.getCount()+BlueTeam.getCount()|0)>=this.gamePlaySettings.gameMode.getNumberOfPlayers()&&this.sendEvent("Unpause",null,!0))},postUpdate:function(){this.gameEnd?(this.gameEndTimer=this.gameEndTimer+1|0,this.gameEndTimer===this.maxGameEndTimer&&BridgeNetDemo.Helper.reloadPage()):this.gameEndTimer=0},updateNetPlay:function(){this.getOnline()&&(this._netPlayTicks=this._netPlayTicks-1|0,(this._netPlayTicks<=0||this.localplayer.character.newInput||this.netPlayNeedsFlush)&&(this.nP.getusers().getCount()>1&&this.nP.flush(),this._netPlayTicks=this._maxNetPlayTicks,this.netPlayNeedsFlush=!1))},sendEvent:function(eventName,data,triggerflush){var D,NU;triggerflush===void 0&&(triggerflush=!1);D={};D.E=eventName;D.D=data;NU=null;this.getOnline()&&(this.nP.send(D),NU=this.nP.me);this.processEvent(D,NU,0);triggerflush&&(this.netPlayNeedsFlush=!0)},sendEntitySpawnCheck:function(E){var D={};D.I=E.iD;D.T=Bridge.getTypeName(Bridge.getType(E));D.X=E.getPosition().x;D.Y=E.getPosition().y;this.sendEvent("Spawn",D)},processEvent:function(msg,user,latency){var LP=new Bridge.List$1(BridgeNetDemo.Player)(Bridge.Linq.Enumerable.from(this.players).where(function(player){return user!=null&&Bridge.referenceEquals(player.networkID,user.userID)})),P=null,D=msg.D,hascharacter=!0,evt,PC,L,i,E,T,i1,entity,entity1,b,entity2,attacker,PC1;if(LP.getCount()<=0?P!=null||user!=null||this.getOnline()?user.getIsMe()?(this.localplayer.networkID=user.userID,P=this.localplayer):hascharacter=!1:P=this.localplayer:P=LP.getItem(0),evt=msg.E,user==null||user.getIsMe()||(this.dlatency+=latency,this.dlatency*=1-1/this.latencyM),Bridge.referenceEquals(evt,"Init")&&P==null&&!hascharacter){if(P=new BridgeNetDemo.Player(!1,!1),P.networkID=user.userID,PC=new BridgeNetDemo.PlayerCharacter(this,P,D.C),PC.setTeam(D.T),PC.setx(700),PC.sety(240),PC.iD=D.I,this.players.add(P),this.addEntity(PC),this.getHoster())for(this.sendEvent("MapSeed",this.tM.seed),L=new Bridge.List$1(BridgeNetDemo.Entity)(Bridge.Linq.Enumerable.from(this.entities).where($_.BridgeNetDemo.Game.f4)),i=0;i<L.getCount();)this.sendEntitySpawnCheck(L.getItem(i)),i=i+1|0;console.log("User:"+P.networkID+" has joined!")}if(Bridge.referenceEquals(evt,"Spawn")&&(E=this.entityFromID(D.I),E==null&&(T=BridgeNetDemo.Helper.getType(D.T),E=new T(this),E.iD=D.I,E.setx(D.X),E.sety(D.Y),D.D&&BridgeNetDemo.Helper.copyFields(D.D,E),this.addEntity(E),this.catchupEntity(E,latency))),Bridge.referenceEquals(evt,"Unpause")&&(this.paused=!1,console.log("Game unpaused"),this.sendInit()),Bridge.referenceEquals(evt,"MapSeed")&&!this.getHoster()&&!Bridge.referenceEquals(this.tM.seed,D)&&(this.tM.seed=D,this.tM.generate(),!this.connected)){for(i1=0;i1<this.entities.getCount();)(Bridge.is(this.entities.getItem(i1),BridgeNetDemo.MadnessOrb)||Bridge.is(this.entities.getItem(i1),BridgeNetDemo.PlayerCharacter)&&Bridge.cast(this.entities.getItem(i1),BridgeNetDemo.PlayerCharacter).player.cPU)&&(this.removeEntity(this.entities.getItem(i1)),i1=i1-1|0),i1=i1+1|0;this.connected=!0}if(Bridge.referenceEquals(evt,"CE")&&(entity=this.entityFromID(D.I),entity!=null&&entity.customEvent(D.D)),Bridge.referenceEquals(evt,"CBE")&&(entity1=this.entityFromID(D.I),entity1!=null&&(b=entity1.getBehaviorFromName(D.T),b.customEvent(D.D))),Bridge.referenceEquals(evt,"Kill")&&(entity2=this.entityFromID(D.I),entity2!=null)){attacker=this.entityFromID(D.A);Bridge.cast(entity2,BridgeNetDemo.ICombatant).onDeath(this.entityFromID(D.S));if(attacker!=null&&Bridge.is(attacker,BridgeNetDemo.PlayerCharacter)){PC1=Bridge.cast(attacker,BridgeNetDemo.PlayerCharacter);PC1.player.score=PC1.player.score+Bridge.cast(entity2,BridgeNetDemo.ICombatant).getPointsForKilling()|0;PC1.onKill(Bridge.cast(entity2,BridgeNetDemo.ICombatant))}}},entityFromID:function(ID){for(var i=0,E;i<this.entities.getCount();){if(E=this.entities.getItem(i),Bridge.referenceEquals(E.iD,ID))return E;i=i+1|0}return null},catchupEntity:function(entity,latency){if(latency>3e3){console.log("Entity catchup, latency:"+latency+" is too much.");return}while(latency>12)entity.update(),latency-=16.6666679},gameplayUpdate:function(){},updateLighting:function(){var mx=this.maxDarknessAlpha,spd=.005;this.darknessAlpha!==mx&&(Math.abs(this.darknessAlpha-mx)<=spd?this.darknessAlpha=mx:this.darknessAlpha<mx?this.darknessAlpha+=spd:this.darknessAlpha-=spd);BridgeNetDemo.HelperExtensions.forEach(BridgeNetDemo.Light,this.lights,$_.BridgeNetDemo.Game.f5)},updateSystemControls:function(){if(BridgeNetDemo.KeyboardManager.get_this().tappedButtons.contains(77)){var M=BridgeNetDemo.AudioManager.get_this().get("BGM/Lunatic red eyes.ogg");M.setVolume(.4);M.getIsPlaying()?M.stop():(M.setLoop(!0),M.play())}BridgeNetDemo.KeyboardManager.get_this().tappedButtons.contains(78)&&!this.getOnline();BridgeNetDemo.KeyboardManager.get_this().tappedButtons.contains(112)&&(Bridge.referenceEquals(this.helpDisplay.getText(),"F1:Help")?this.helpDisplay.setText("Mouse+Keyboard Controls:\nLMB:Fire\nRMB:Dash(tap) Fly(hold)\nA/D:Walk\nW:Jump\nS:Fall through platform\nDouble tap W/A/S/D to dash"):this.helpDisplay.setText("F1:Help"));this.dEBUG&&this.debugUpdate()},debugUpdate:function(){var D=null,RedTeam,BlueTeam;BridgeNetDemo.KeyboardManager.get_this().tappedButtons.contains(82)&&(this.tM.seed=Bridge.Int.clip32(Math.random()*Bridge.Long([1410065407,2])),this.tM.generate());BridgeNetDemo.KeyboardManager.get_this().tappedButtons.contains(187)&&(this.maxDarknessAlpha=Math.min(1,this.maxDarknessAlpha+.05));BridgeNetDemo.KeyboardManager.get_this().tappedButtons.contains(189)&&(this.maxDarknessAlpha=Math.max(0,this.maxDarknessAlpha-.05));(BridgeNetDemo.KeyboardManager.get_this().tappedButtons.contains(84)||BridgeNetDemo.KeyboardManager.get_this().tappedButtons.contains(80))&&(this.useTeamColors=!this.useTeamColors,BridgeNetDemo.KeyboardManager.get_this().tappedButtons.contains(80)&&(this.useTeamColors=!0),BridgeNetDemo.HelperExtensions.forEach(BridgeNetDemo.Entity,this.entities,$_.BridgeNetDemo.Game.f6),this.localplayer.character.setTeam(this.localplayer.character.getTeam()));BridgeNetDemo.KeyboardManager.get_this().tappedButtons.contains(49)&&this.localplayer.character.setTeam(1);BridgeNetDemo.KeyboardManager.get_this().tappedButtons.contains(50)&&this.localplayer.character.setTeam(2);BridgeNetDemo.KeyboardManager.get_this().tappedButtons.contains(51)&&this.localplayer.character.setTeam(3);BridgeNetDemo.KeyboardManager.get_this().tappedButtons.contains(72)&&(this.showHitbox=!this.showHitbox);BridgeNetDemo.KeyboardManager.get_this().tappedButtons.contains(80)&&(D={},D.I=BridgeNetDemo.Helper.getRandomString(),D.T=Bridge.getTypeName(Bridge.getType(this.localplayer.character)),D.X=700,D.Y=240,this.sendEvent("Spawn",D),RedTeam=new Bridge.List$1(BridgeNetDemo.Entity)(Bridge.Linq.Enumerable.from(this.entities).where($_.BridgeNetDemo.Game.f7)),BlueTeam=new Bridge.List$1(BridgeNetDemo.Entity)(Bridge.Linq.Enumerable.from(this.entities).where($_.BridgeNetDemo.Game.f8)),((RedTeam.getCount()+BlueTeam.getCount()|0)&1)>0&&(D={},D.I=BridgeNetDemo.Helper.getRandomString(),D.T=Bridge.getTypeName(Bridge.getType(this.localplayer.character)),D.X=900,D.Y=240,this.sendEvent("Spawn",D)))},sendInit:function(){var D={};D.C=this.localplayer.character.getspriteName();D.T=this.localplayer.character.getTeam();D.I=this.localplayer.character.iD;this.sendEvent("Init",D,!0)},onConnect:function(user){this.sendInit();Bridge.global.setTimeout(Bridge.fn.bind(this,$_.BridgeNetDemo.Game.f9),1e4);user!=null&&console.log("Connection:"+user.userID)},getMouse:function(){return BridgeNetDemo.Vector2.op_Addition(BridgeNetDemo.Vector2.op_Multiply(BridgeNetDemo.KeyboardManager.get_this().cMouse,this.camera.getInvScale()),this.camera.position)},render:function(){this.lagReduction=BridgeNetDemo.App.lagging?!this.lagReduction:!1;var g=this.spriteGraphics;this.updateCamera();this.drawBackground(g);g.save();this.camera.apply(g);this.tM.draw(g);g.strokeStyle="#BB0000";g.strokeRect(this.stageBounds.x,this.stageBounds.y,this.stageBounds.width,this.stageBounds.height);g.globalAlpha=1;BridgeNetDemo.HelperExtensions.forEach(BridgeNetDemo.Entity,this.entities,function(E){E.alive&&E.visible&&E.draw(g)});g.restore();this.darknessAlpha>0&&this.applyLighting(g);this.drawGUI(g);this.updateNetPlay()},draw$1:function(frontgraphics){this.render();BridgeNetDemo.GameSprite.prototype.draw.call(this,frontgraphics)},applyLighting:function(g){var tmp,CC,maxlightdistance;this.lagReduction||(tmp=this.lG,this.lG.globalCompositeOperation="source-over",this.lG.fillStyle="#"+this.darknessColor,this.lG.fillRect(0,0,this.lighting.width,this.lighting.height),this.lG.save(),tmp.globalCompositeOperation="destination-out",this.camera.apply(this.lG),CC=this.camera.getCenter(),maxlightdistance=1800,Bridge.Linq.Enumerable.from(this.lights).where(function(lt){return BridgeNetDemo.Vector2.op_Subtraction(lt.source.getPosition(),CC).getEstimatedLength()<maxlightdistance}).forEach(Bridge.fn.bind(this,$_.BridgeNetDemo.Game.f10)),Bridge.Linq.Enumerable.from(this.entities).where(function(E){return Bridge.is(E,BridgeNetDemo.ILightProducer)&&BridgeNetDemo.Vector2.op_Subtraction(E.getPosition(),CC).getEstimatedLength()<maxlightdistance}).forEach(Bridge.fn.bind(this,$_.BridgeNetDemo.Game.f11)),this.lG.restore(),this.lG.globalCompositeOperation="source-over");g.globalAlpha=this.darknessAlpha;g.drawImage(this.lighting,0,0);g.globalAlpha=1},updateCollisions:function(){for(var combatants=new Bridge.List$1(BridgeNetDemo.Entity)(Bridge.Linq.Enumerable.from(this.entities).where($_.BridgeNetDemo.Game.f12)),harmfulEntity=new Bridge.List$1(BridgeNetDemo.Entity)(Bridge.Linq.Enumerable.from(this.entities).where($_.BridgeNetDemo.Game.f13)),i=0;i<combatants.getCount();)(function(){var E=combatants.getItem(i);if(Bridge.is(E,BridgeNetDemo.ICombatant))for(var EI=Bridge.cast(E,BridgeNetDemo.ICombatant),R=E.getHitbox(),spd=BridgeNetDemo.Vector2.op_Multiply(E.speed,.5),R2=new BridgeNetDemo.Rectangle(R.x-spd.x,R.y-spd.y,R.width,R.height),L=new Bridge.List$1(BridgeNetDemo.Entity)(Bridge.Linq.Enumerable.from(harmfulEntity).where(function(entity){return!Bridge.referenceEquals(entity,E)&&!Bridge.cast(entity,BridgeNetDemo.IHarmfulEntity).getAttacker().sameTeam(Bridge.cast(EI,BridgeNetDemo.Entity))})),j=0;j<L.getCount();){var tmp=L.getItem(j),HE=Bridge.cast(tmp,BridgeNetDemo.IHarmfulEntity),OR=tmp.getHitbox(),spd2=BridgeNetDemo.Vector2.op_Multiply(tmp.speed,.5),OR2=new BridgeNetDemo.Rectangle(OR.x-spd2.x,OR.y-spd2.y,OR.width,OR.height);(R.isTouching(OR)||R2.isTouching(OR2))&&this.attack(EI,HE);j=j+1|0}i=i+1|0}).call(this)},attack:function(target,source){if(target.getHP()>0&&source.ontouchDamage(target)){target.onDamaged(source,source.gettouchDamage());if(Bridge.cast(target,BridgeNetDemo.Entity).playSound("hit"),target.getHP()<=0&&Bridge.cast(target,BridgeNetDemo.Entity).getHandledLocally()){var D={};D.I=Bridge.cast(target,BridgeNetDemo.Entity).iD;D.A=source.getAttacker().iD;D.S=Bridge.cast(source,BridgeNetDemo.Entity).iD;this.sendEvent("Kill",D)}}},getRespawnLocation:function(team){for(var X=400,ret,T;;)if(X=this.stageBounds.width*.1+Math.random()*this.stageBounds.width*.2,team===2&&(X=this.stageBounds.getright()-X),this.gamePlaySettings.gameMode.getTeams()||(X=this.stageBounds.getleft()+(this.stageBounds.width-200)*Math.random()),ret=new BridgeNetDemo.Vector2(X,this.stageBounds.gettop()+(this.stageBounds.height-200)*Math.random()),T=this.tM.checkForTile(BridgeNetDemo.Vector2.op_Addition(ret,new BridgeNetDemo.Vector2(64,64))),T!=null&&!(T.enabled&&T.topSolid)&&(T=this.tM.checkForTile(BridgeNetDemo.Vector2.op_Addition(ret,new BridgeNetDemo.Vector2(64,128))),T!=null&&!(T.enabled&&T.topSolid)&&(T=this.tM.checkForTile(BridgeNetDemo.Vector2.op_Addition(ret,new BridgeNetDemo.Vector2(64,544))),T!=null&&T.enabled&&T.topSolid)))return ret},updateCamera:function(){var D=this.localplayer.character.getHspeed()*5,V=this.localplayer.character.getVspeed()*10;this.camera.targetPosition.x=this.localplayer.character.getx()+D-(Bridge.Int.div(BridgeNetDemo.App.canvas.width,2)|0)*this.camera.getInvScale();this.camera.targetPosition.y=Math.max(0,this.localplayer.character.gety()+V-(Bridge.Int.div(BridgeNetDemo.App.canvas.height,2)|0)*this.camera.getInvScale());this.camera.update()},getCameraBounds:function(){return new BridgeNetDemo.Rectangle(Bridge.Int.clip32(this.camera.position.x),Bridge.Int.clip32(this.camera.position.y),BridgeNetDemo.App.canvas.width,BridgeNetDemo.App.canvas.height)},drawBackground:function(g){this.bG<0||this.bG>=this.bGs.getCount()?(g.fillStyle="#77AAFF",g.fillRect(0,0,BridgeNetDemo.App.canvas.width,BridgeNetDemo.App.canvas.height)):g.drawImage(this.bGs.getItem(this.bG),0,0)},drawGUI:function(g){var color,prct,PC,lives,P,state;g.lineWidth=2;this.drawGauge(g,new BridgeNetDemo.Vector2(2,2),new BridgeNetDemo.Vector2(160,26),2,Math.max(0,this.localplayer.character.getHP()/this.localplayer.character.maxHP),"#00DD00");color="#6666EE";prct=Math.max(0,this.localplayer.character.ammo/this.localplayer.character.maxAmmo);this.localplayer.character.manaburnout&&(color="#DD4444",prct=Math.min(1,(1-prct)*2));this.drawGauge(g,new BridgeNetDemo.Vector2(2,28),new BridgeNetDemo.Vector2(160,10),2,prct,color);this.updateDisplayText();this.textDisplay.position.x=800;this.textDisplay.draw(g);this.helpDisplay.position=BridgeNetDemo.Vector2.op_Subtraction(new BridgeNetDemo.Vector2(BridgeNetDemo.App.canvas.width,BridgeNetDemo.App.canvas.height),this.helpDisplay.getSize());this.helpDisplay.draw(g);this.respawnText.draw(g);for(var RL=0,BL=0,total=0,LE=new Bridge.List$1(BridgeNetDemo.Entity)(Bridge.Linq.Enumerable.from(this.entities).where($_.BridgeNetDemo.Game.f14)),i=0,blue=0,red=0,opposition=0,defeated=this.localplayer.lives<=0&&this.localplayer.character.killed;i<LE.getCount();)PC=LE.getItem(i),lives=PC.player.lives,PC.killed||lives++,this.gamePlaySettings.gameMode.getTeams()?PC.getTeam()===1?(RL+=lives,total+=lives,red=red+1|0):PC.getTeam()===2&&(BL+=lives,total+=lives,blue=blue+1|0):this.localplayer.character.sameTeam(PC)?(RL+=lives,total+=lives,red=red+1|0):(BL+=lives,total+=lives,blue=blue+1|0),!this.localplayer.character.sameTeam(PC)&&(!PC.killed||PC.player.lives>0)&&(opposition=opposition+1|0),i=i+1|0;P=.5;BL===0?(P=1,RL===0&&(P=.5)):RL===0?P=0:(P=RL/total,P=Math.min(1,Math.max(0,P)));this.gameEnd=!1;this.gameStarted&&red>0&&blue>0&&(P>=1||P<=0)&&(this.gamePlaySettings.gameMode.getTeams()?this.gameEnd=!0:opposition===0?this.gameEnd=!0:defeated&&opposition===1&&(this.gameEnd=!0),this.gameEnd&&(state=0,this.gamePlaySettings.gameMode.getTeams()?(this.localplayer.character.getTeam()===1&&P>=1||this.localplayer.character.getTeam()===2&&P<=0)&&(state=1):opposition!==0||defeated||(state=1),state===0&&total>0&&(state=-1),state===1?(this.respawnText.setTextColor("#FFFFFF"),this.respawnText.setText("Victory!")):state===0?(this.respawnText.setTextColor("#FFFFFF"),this.respawnText.setText("Draw")):(this.respawnText.setTextColor("#FF0000"),this.respawnText.setText("Defeat..."))));this.drawGauge(g,new BridgeNetDemo.Vector2(300,2),new BridgeNetDemo.Vector2(300,40),2,1,BridgeNetDemo.Game.getTeamColor(2));this.drawGauge(g,new BridgeNetDemo.Vector2(300,2),new BridgeNetDemo.Vector2(300,40),2,P,BridgeNetDemo.Game.getTeamColor(1),!1)},drawGauge:function(g,position,size,border,progress,color,drawborder){drawborder===void 0&&(drawborder=!0);drawborder&&(g.globalAlpha=.6,g.fillStyle="#000000",g.fillRect(position.x,position.y,size.x,size.y));g.fillStyle=color;g.globalAlpha=1;g.fillRect(Bridge.Int.clip32(position.x)+border|0,Bridge.Int.clip32(position.y)+border|0,(size.x-(border+border|0))*progress,Bridge.Int.clip32(size.y)-(border+border|0)|0);g.globalAlpha=.5;var grd=g.createLinearGradient(0,0,0,size.y);grd.addColorStop(0,color);grd.addColorStop(.4,"white");grd.addColorStop(1,color);g.fillStyle=grd;g.fillRect(Bridge.Int.clip32(position.x)+border|0,Bridge.Int.clip32(position.y)+border|0,(size.x-(border+border|0))*progress,Bridge.Int.clip32(size.y)-(border+border|0)|0);g.globalAlpha=1}});Bridge.ns("BridgeNetDemo.Game",$_);Bridge.apply($_.BridgeNetDemo.Game,{f1:function(A,B){return Bridge.compare(A.zOrder,B.zOrder)},f2:function(E){return Bridge.is(E,BridgeNetDemo.ICombatant)&&Bridge.is(E,BridgeNetDemo.PlayerCharacter)&&Bridge.cast(E,BridgeNetDemo.ICombatant).getTeam()===1},f3:function(E){return Bridge.is(E,BridgeNetDemo.ICombatant)&&Bridge.is(E,BridgeNetDemo.PlayerCharacter)&&Bridge.cast(E,BridgeNetDemo.ICombatant).getTeam()===2},f4:function(E){return Bridge.is(E,BridgeNetDemo.MadnessOrb)||Bridge.is(E,BridgeNetDemo.PlayerCharacter)&&Bridge.cast(E,BridgeNetDemo.PlayerCharacter).player.cPU},f5:function(L){L.update()},f6:function(E){Bridge.is(E,BridgeNetDemo.PlayerCharacter)&&Bridge.cast(E,BridgeNetDemo.PlayerCharacter).setTeam(Bridge.cast(E,BridgeNetDemo.PlayerCharacter).getTeam()+0|0)},f7:function(E){return Bridge.is(E,BridgeNetDemo.ICombatant)&&Bridge.cast(E,BridgeNetDemo.ICombatant).getTeam()===1},f8:function(E){return Bridge.is(E,BridgeNetDemo.ICombatant)&&Bridge.cast(E,BridgeNetDemo.ICombatant).getTeam()===2},f9:function(){this.sendInit()},f10:function(ltt){ltt.draw(this.lG)},f11:function(E){Bridge.cast(E,BridgeNetDemo.ILightProducer).drawLight(this.lG)},f12:function(entity){return Bridge.is(entity,BridgeNetDemo.ICombatant)&&entity.ani.getCurrentImage()!=null&&Bridge.cast(entity,BridgeNetDemo.ICombatant).getHP()>0},f13:function(entity){return Bridge.is(entity,BridgeNetDemo.IHarmfulEntity)&&entity.ani.getCurrentImage()!=null},f14:function(E){return Bridge.is(E,BridgeNetDemo.PlayerCharacter)}});Bridge.define("BridgeNetDemo.GameLobby",{inherits:[BridgeNetDemo.GameSprite],titletext:null,gamePlaySettings:null,bG:null,menu:null,buttons:null,mainMenu:null,redTeam:null,blueTeam:null,me:null,netPlayNeedsFlush:!1,nP:null,hostNPOut:null,redTeamMembers:null,blueTeamMembers:null,countDownText:null,countDown:0,maxCountDown:360,constructor:function(){var name,def,blue,B,B1,M,quit;BridgeNetDemo.GameSprite.prototype.$constructor.call(this);this.gamePlaySettings=BridgeNetDemo.App.gamePlaySettings;this.redTeam=new Bridge.List$1(BridgeNetDemo.NetPlayUser)();this.blueTeam=new Bridge.List$1(BridgeNetDemo.NetPlayUser)();this.gamePlaySettings.online&&(Bridge.global.localStorage.getItem("PlayerName")?(this.nP=new BridgeNetDemo.NetPlay(this.gamePlaySettings.gameMode.getName()+"-Lobby",Bridge.cast(Bridge.global.localStorage.getItem("PlayerName"),String)),this.nP.onMessage=Bridge.fn.bind(this,this.processEvent),this.nP.onOpen=Bridge.fn.bind(this,this.onConnect),this.nP.onClose=Bridge.fn.bind(this,this.onClose)):(Bridge.global.alert("Player Name is invallid."),BridgeNetDemo.KeyboardManager.update(),BridgeNetDemo.App.setView$1(BridgeNetDemo.TitleScreen)));this.nP==null?(name="User-You-123",Bridge.global.localStorage.getItem("PlayerName")&&(name="User-"+Bridge.global.localStorage.getItem("PlayerName")+"-123"),this.me=new BridgeNetDemo.NetPlayUser(name,!0),this.redTeam.add(this.me)):(this.me=this.nP.me,this.redTeam.add(this.me));this.titletext=new BridgeNetDemo.TextSprite;this.titletext.setTextColor("#FFFFFF");this.titletext.setText("Choose a team");this.titletext.setFontSize(60);this.titletext.position=new BridgeNetDemo.Vector2(100,50);this.menu=new BridgeNetDemo.ButtonMenu(600,600,40);this.menu.position=new BridgeNetDemo.Vector2(0,200);this.menu.selectionMenu=!0;def=null;blue=null;this.gamePlaySettings.gameMode.getTeams()?(def=this.menu.addButton("Red Team"),B=def,B.colorSchemes.setItem(0,new BridgeNetDemo.ButtonSprite.ColorScheme("#AA4411","#DD4422")),B.setColorScheme$1(0),this.menu.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite)),this.menu.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite)),B=this.menu.addButton("Blue Team"),B.colorSchemes.setItem(0,new BridgeNetDemo.ButtonSprite.ColorScheme("#1155CC","#2277EE")),B.colorSchemes.setItem(1,new BridgeNetDemo.ButtonSprite.ColorScheme("#FFFFFF","#66CCFF")),B.setColorScheme$1(0),blue=B):(def=this.menu.addButton("Red Team"),B1=def,B1.colorSchemes.setItem(0,new BridgeNetDemo.ButtonSprite.ColorScheme("#AA4411","#DD4422")),B1.setColorScheme$1(0),def.visible=!1,this.menu.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite)),this.menu.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite)),this.menu.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite)),this.titletext.setText("Confirm players"));this.menu.finish(1);this.menu.select(def);this.redTeamMembers=new BridgeNetDemo.TextSprite;this.redTeamMembers.position=BridgeNetDemo.Vector2.op_Addition(def.position.clone(),new BridgeNetDemo.Vector2(0,60));this.redTeamMembers.setTextColor("#FFFFFF");this.redTeamMembers.setFontSize(34);blue!=null&&(this.blueTeamMembers=new BridgeNetDemo.TextSprite,this.blueTeamMembers.position=BridgeNetDemo.Vector2.op_Addition(blue.position.clone(),new BridgeNetDemo.Vector2(0,60)),this.blueTeamMembers.setTextColor("#FFFFFF"),this.blueTeamMembers.setFontSize(34));this.menu.onChoose=Bridge.fn.bind(this,$_.BridgeNetDemo.GameLobby.f1);this.countDownText=new BridgeNetDemo.TextSprite;this.countDownText.position=new BridgeNetDemo.Vector2(860,180);this.countDownText.setTextColor("#FFFFFF");this.countDownText.setFontSize(50);this.countDownText.setText(" ");this.bG=new BridgeNetDemo.Animation(BridgeNetDemo.AnimationLoader.get("BG"));M=new BridgeNetDemo.ButtonMenu(0,800,50);M.position=new BridgeNetDemo.Vector2(880,0);this.getHoster()||!0?M.addButton("Play").lock():M.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite));M.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite));M.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite));M.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite));M.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite));quit=M.addButton("Quit");M.finish(999999999);M.onChoose=Bridge.fn.bind(this,function(){var S=M.getSelectedData(),TeamSize,D;Bridge.referenceEquals(S,"Quit")?(this.hostNPOut!=null&&this.hostNPOut.close(),this.nP==null||this.getOnlineHoster()||BridgeNetDemo.Helper.reloadPage(),BridgeNetDemo.App.setView(new BridgeNetDemo.TitleScreen)):Bridge.referenceEquals(S,"Play")&&this.getHoster()&&(this.gamePlaySettings.myTeam=Bridge.referenceEquals(this.menu.getSelectedData(),"Red Team")?1:2,TeamSize=this.gamePlaySettings.gameMode.getNumberOfPlayers(),this.gamePlaySettings.gameMode.getTeams()&&(TeamSize=Bridge.Int.clip32(Math.ceil(this.gamePlaySettings.gameMode.getNumberOfPlayers()/2))),this.gamePlaySettings.blueNPCs=TeamSize-this.blueTeam.getCount()|0,this.gamePlaySettings.redNPCs=TeamSize-this.redTeam.getCount()|0,this.gamePlaySettings.gameMode.getTeams()||(this.gamePlaySettings.blueNPCs=0),this.gamePlaySettings.blueNPCs<0||this.gamePlaySettings.redNPCs<0?(Bridge.global.alert("One or more teams are overfilled, the game cannot start."),BridgeNetDemo.KeyboardManager.update()):this.getOnlineHoster()?this.countDown<=0&&(quit.lock(),this.countDown=this.maxCountDown,D={},D.CountDown=this.countDown-30|0,this.sendEvent("CountDown",D,!0),this.hostNPOut=new BridgeNetDemo.NetPlay(this.gamePlaySettings.roomID,Bridge.cast(Bridge.global.localStorage.getItem("PlayerName"),String)),this.gamePlaySettings.hostNPOut=this.hostNPOut):this.getHoster()&&BridgeNetDemo.App.setView(new BridgeNetDemo.Game))});this.mainMenu=M},getHoster:function(){return this.nP==null||this.nP.getHoster()},getOnlineHoster:function(){return this.nP!=null&&this.nP.getHoster()},onClose:function(){console.log("gamelobby closed");return},onConnect:function(arg){if(this.redTeam.contains(arg)||this.blueTeam.contains(arg)||this.redTeam.add(arg),this.getHoster()){var D={};D.Name=this.gamePlaySettings.roomID;this.sendEvent("RoomName",D,!0)}this.changeMyTeam(this.redTeam.contains(this.me)?1:2)},changeMyTeam:function(Team){this.sendEvent("CT",Team,!0)},sendEvent:function(eventName,data,triggerflush){var D,NU;triggerflush===void 0&&(triggerflush=!1);D={};D.E=eventName;D.D=data;NU=null;this.nP!=null?(this.nP.send(D),NU=this.nP.me):NU=this.me;this.processEvent(D,NU,0);triggerflush&&(this.netPlayNeedsFlush=!0)},processEvent:function(msg,user){var evt=msg.E,D=msg.D;Bridge.referenceEquals(evt,"CT")&&(this.redTeam.contains(user)&&this.redTeam.remove(user),this.blueTeam.contains(user)&&this.blueTeam.remove(user),(Bridge.referenceEquals(msg.D,1)?this.redTeam:this.blueTeam).add(user));Bridge.referenceEquals(evt,"RoomName")&&(this.gamePlaySettings.roomID=D.Name);Bridge.referenceEquals(evt,"StartGame")&&(this.gamePlaySettings.myTeam=this.redTeam.contains(this.me)?1:2,console.log("start game on team:"+this.gamePlaySettings.myTeam.toString()),BridgeNetDemo.App.setView$1(BridgeNetDemo.Game));Bridge.referenceEquals(evt,"CountDown")&&!this.getOnlineHoster()&&(this.countDown=D.CountDown)},update:function(){var D,ok,D1;this.menu.update();this.mainMenu.update();this.countDown>0&&(this.countDown=this.countDown-1|0,this.countDown===90&&this.getOnlineHoster()&&(D={},D.Name=this.gamePlaySettings.roomID,this.sendEvent("RoomName",D,!0)),this.countDown<1&&(this.countDown=1,this.getOnlineHoster()&&this.hostNPOut!=null&&this.hostNPOut.getHoster()&&this.sendEvent("StartGame",null,!0)),this.countDownText.setText(Bridge.Double.format(Math.ceil(this.countDown/60),"G")));this.getHoster()&&(ok=!this.getOnlineHoster(),ok||(this.redTeam.getCount()+this.blueTeam.getCount()|0)>1&&(ok=!0),ok&&(this.getOnlineHoster()&&Bridge.referenceEquals(this.gamePlaySettings.roomID,"")&&(this.gamePlaySettings.roomID=this.gamePlaySettings.gameMode.getName()+Bridge.cast(Bridge.global.localStorage.getItem("PlayerName"),String)+"-"+new Bridge.Random("constructor").next$1(9999999).toString(),D1={},D1.Name=this.gamePlaySettings.roomID,this.sendEvent("RoomName",D1,!0)),this.mainMenu.getAllButtons().getItem(0).unlock()));this.netPlayNeedsFlush&&this.nP!=null&&(this.nP.flush(),this.netPlayNeedsFlush=!1);BridgeNetDemo.GameSprite.prototype.update.call(this)},getPlayers:function(L){var TeamSize=this.gamePlaySettings.gameMode.getNumberOfPlayers(),name,name1;this.gamePlaySettings.gameMode.getTeams()&&(TeamSize=Bridge.Int.clip32(Math.ceil(this.gamePlaySettings.gameMode.getNumberOfPlayers()/2)));for(var i=0,s="",total=0;i<L.getCount();)Bridge.referenceEquals(s,"")||(s=s+"\n"),name=L.getItem(i).getName(),Bridge.referenceEquals(name,"")&&(name="???"),s=s+name,i=i+1|0;if(total=i,i<=TeamSize){while(i<TeamSize)Bridge.referenceEquals(s,"")||(s=s+"\n"),name1="[Open/Computer]",this.gamePlaySettings.online||(name1="[Computer]"),s=s+name1,i=i+1|0;s=s+"\n"+total+"/"+TeamSize}else s=s+"\nToo many players.";return s},updatePlayerListings:function(){this.redTeamMembers.setText(this.getPlayers(this.redTeam));this.redTeamMembers.draw(this.spriteGraphics);this.blueTeamMembers!=null&&(this.blueTeamMembers.setText(this.getPlayers(this.blueTeam)),this.blueTeamMembers.draw(this.spriteGraphics))},render:function(){this.spriteBuffer.width=BridgeNetDemo.App.canvas.width;this.spriteBuffer.height=BridgeNetDemo.App.canvas.height;this.spriteGraphics.globalAlpha=1;this.bG.draw(this.spriteGraphics);this.spriteGraphics.globalAlpha=.6;this.spriteGraphics.fillStyle="#000000";this.spriteGraphics.fillRect(0,0,this.spriteBuffer.width,this.spriteBuffer.height);this.spriteGraphics.globalAlpha=1;this.menu.draw(this.spriteGraphics);this.titletext.draw(this.spriteGraphics);this.countDownText.draw(this.spriteGraphics);this.mainMenu.draw(this.spriteGraphics);this.updatePlayerListings();BridgeNetDemo.GameSprite.prototype.render.call(this)}});Bridge.ns("BridgeNetDemo.GameLobby",$_);Bridge.apply($_.BridgeNetDemo.GameLobby,{f1:function(){var L=Bridge.referenceEquals(this.menu.getSelectedData(),"Red Team")?this.redTeam:this.blueTeam;L.contains(this.me)||this.changeMyTeam(Bridge.referenceEquals(this.menu.getSelectedData(),"Red Team")?1:2)}});Bridge.define("BridgeNetDemo.OptionsScreen",{inherits:[BridgeNetDemo.GameSprite],titletext:null,gamePlaySettings:null,bG:null,menu:null,buttons:null,mainMenu:null,defaultText:"Click a button to rebind it.",constructor:function(){BridgeNetDemo.GameSprite.prototype.$constructor.call(this);this.gamePlaySettings=BridgeNetDemo.App.gamePlaySettings;this.titletext=new BridgeNetDemo.TextSprite;this.titletext.setTextColor("#FFFFFF");this.titletext.setText(this.defaultText);this.titletext.setFontSize(40);this.titletext.position=new BridgeNetDemo.Vector2(20,50);this.menu=new BridgeNetDemo.ButtonMenu(700,550,50);this.menu.position=new BridgeNetDemo.Vector2(50,240);this.menu.selectionMenu=!0;this.menu.addButton("Left",-1,-1);this.menu.addButton("Right",-1,1);this.menu.addButton("Up",-1,-2);this.menu.addButton("Down",-1,2);this.menu.addButton("Shoot",-1,3);this.menu.addButton("Dash/Fly",-1,4);this.menu.addButton("Aim X",-1,5);this.menu.addButton("Aim Y",-1,6);this.menu.finish(4);this.menu.onChoose=Bridge.fn.bind(this,$_.BridgeNetDemo.OptionsScreen.f1);this.bG=new BridgeNetDemo.Animation(BridgeNetDemo.AnimationLoader.get("BG"));var M=new BridgeNetDemo.ButtonMenu(0,800,50);M.position=new BridgeNetDemo.Vector2(880,0);M.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite));M.addButton("Reset");M.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite));M.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite));M.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite));M.addButton$1(Bridge.cast(null,BridgeNetDemo.ButtonSprite));M.addButton("TitleScreen");M.finish(999999999);M.onChoose=function(){var S=M.getSelectedData();Bridge.referenceEquals(S,"TitleScreen")?BridgeNetDemo.App.setView(new BridgeNetDemo.TitleScreen):Bridge.referenceEquals(S,"Reset")&&(Bridge.global.localStorage.setItem("RSG_TA_Keybindings","null"),BridgeNetDemo.Helper.reloadPage())};this.mainMenu=M},updateSelection:function(){var D=this.getData();if(D==null){this.titletext.setText(this.defaultText);return}Bridge.String.startsWith(this.menu.getSelectedText(),"Aim")?((Bridge.referenceEquals(D.controller,"Mouse")||Bridge.referenceEquals(D.controller,"Keyboard"))&&(D.text="[Mouse position]"),this.titletext.setText(this.menu.getSelectedText()+"(press mouse/keyboard for mouse controls).\nCurrently "+D.text)):this.titletext.setText("Press a button to rebind "+this.menu.getSelectedText()+".\nCurrently "+D.text)},getData:function(){var IM,map,name,controller,mapNames,ret;if(this.menu.selected==null)return null;var i=this.menu.getSelectedData(),IC=BridgeNetDemo.App.iC,anti=i<0;return i=Math.abs(i)-1|0,IM=IC.inputMapping.getItem(i),map=IM.map,anti&&(map=IM.antimap),name=map.toString(),controller=IM.controllerID,Bridge.referenceEquals(controller,"")&&(controller=IC.getid()),Bridge.referenceEquals(controller,"Keyboard")&&(name=BridgeNetDemo.Helper.keyCodeToString(map)),Bridge.referenceEquals(controller,"Mouse")&&(mapNames=["Left button","Middle button","Right button"],map>=0&&map<mapNames.length&&(name=mapNames[map])),IM.axis&&(name="Axis-"+map),ret={},ret.name=name,ret.controller=controller,ret.i=i,ret.IM=IM,ret.map=map,ret.anti=anti,ret.text="["+BridgeNetDemo.App.limitStringSize(controller,10)+":"+name+"]",ret},update:function(){this.menu.update();this.mainMenu.update();this.updateKeys();BridgeNetDemo.GameSprite.prototype.update.call(this)},updateKeys:function(){var I,D,IM,map;if(this.menu.selected!=null){var IC=BridgeNetDemo.App.iC,L=BridgeNetDemo.KeyboardManager.get_this().tappedButtons,controller="",button=-1,axis=!1;if(L.getCount()>0){if(controller="Keyboard",button=L.getItem(0),button===27){this.menu.select(null);this.titletext.setText(this.defaultText);return}}else L=BridgeNetDemo.KeyboardManager.get_this().tappedMouseButtons,L.getCount()>0?(controller="Mouse",button=L.getItem(0)):(I=IC.findAnyPressedGamePadInput(),I!=null&&(controller=I.controllerID,axis=I.axis,button=I.map));Bridge.referenceEquals(controller,"")||(D=this.getData(),IM=D.IM,IM.controllerID=controller,IM.axis=axis,D.anti?IM.antimap=button:IM.map=button,axis&&(IM.map=button),D=this.getData(),Bridge.String.startsWith(this.menu.getSelectedText(),"Aim")&&(Bridge.referenceEquals(D.controller,"Mouse")||Bridge.referenceEquals(D.controller,"Keyboard"))&&(D.text="[Mouse position]"),this.titletext.setText(this.menu.getSelectedText()+" has been rebound to\n"+D.text),this.menu.select(null),map=JSON.stringify(IC.copyMap()),Bridge.global.localStorage.setItem("RSG_TA_Keybindings",map))}},render:function(){this.spriteBuffer.width=BridgeNetDemo.App.canvas.width;this.spriteBuffer.height=BridgeNetDemo.App.canvas.height;this.spriteGraphics.globalAlpha=1;this.bG.draw(this.spriteGraphics);this.spriteGraphics.globalAlpha=.6;this.spriteGraphics.fillStyle="#000000";this.spriteGraphics.fillRect(0,0,this.spriteBuffer.width,this.spriteBuffer.height);this.spriteGraphics.globalAlpha=1;this.menu.draw(this.spriteGraphics);this.titletext.draw(this.spriteGraphics);this.mainMenu.draw(this.spriteGraphics);BridgeNetDemo.GameSprite.prototype.render.call(this)}});Bridge.ns("BridgeNetDemo.OptionsScreen",$_);Bridge.apply($_.BridgeNetDemo.OptionsScreen,{f1:function(){BridgeNetDemo.KeyboardManager.update();this.updateSelection()}});Bridge.define("BridgeNetDemo.PlatformerEntity",{inherits:[BridgeNetDemo.ControllableEntity],ceiling:null,floor:null,leftWall:null,rightWall:null,friction:1,onGround:!1,gravityEnabled:!0,gravity:1.8,maxFallSpeed:15,constructor:function(game){BridgeNetDemo.ControllableEntity.prototype.$constructor.call(this,game)},update:function(){this.applyFriction();this.updateTerrainCollision();BridgeNetDemo.ControllableEntity.prototype.update.call(this)},applyFriction:function(){var dir=this.getHspeed()>=0,X=Math.abs(this.getHspeed());X-=this.friction;X<0&&(X=0);dir||(X=-X);this.setHspeed(X)},getFloor:function(){var T=null,W=this.getWidth()/3,Y=this.getHeight();return T!=null&&T.enabled&&T.topSolid||(T=this.game.tM.checkForTile(BridgeNetDemo.Vector2.op_Addition(this.getPosition(),new BridgeNetDemo.Vector2(this.getWidth()/2,Y)))),T!=null&&T.enabled&&T.topSolid||(T=this.game.tM.checkForTile(BridgeNetDemo.Vector2.op_Addition(this.getPosition(),new BridgeNetDemo.Vector2(W,Y)))),T!=null&&T.enabled&&T.topSolid||(T=this.game.tM.checkForTile(BridgeNetDemo.Vector2.op_Addition(this.getPosition(),new BridgeNetDemo.Vector2(this.getWidth()-W,Y)))),T!=null&&T.enabled&&T.topSolid||(T=null),T},getCeiling:function(){var T=null,W=this.getWidth()/3,Y=16;return T!=null&&T.enabled&&T.bottomSolid||(T=this.game.tM.checkForTile(BridgeNetDemo.Vector2.op_Addition(this.getPosition(),new BridgeNetDemo.Vector2(W,Y)))),T!=null&&T.enabled&&T.bottomSolid||(T=this.game.tM.checkForTile(BridgeNetDemo.Vector2.op_Addition(this.getPosition(),new BridgeNetDemo.Vector2(this.getWidth()-W,Y)))),T!=null&&T.enabled&&T.bottomSolid||(T=null),T},checkWall:function(X){var T=null;return this.isTileObstacle(T,X)||(T=this.game.tM.checkForTile(BridgeNetDemo.Vector2.op_Addition(this.getPosition(),new BridgeNetDemo.Vector2(X,this.getHeight()/2-2)))),this.isTileObstacle(T,X)||(T=this.game.tM.checkForTile(BridgeNetDemo.Vector2.op_Addition(this.getPosition(),new BridgeNetDemo.Vector2(X,this.getHeight()-2)))),this.isTileObstacle(T,X)||(T=null),T},isTileObstacle:function(T,X){if(T!=null&&T.enabled&&(T.leftSolid&&X>0||T.rightSolid&&X<0)&&(this.floor==null||T.row<this.floor.row)){var Y=this.gety()+this.getHeight();if(T.getHitbox().y<+Y)return!T.getIsSlope()}return!1},updateTerrainCollision:function(){var unstuck,stuck,c,T,Y,wall,W,X,R,V;if(this.floor=this.getFloor(),this.ceiling=this.getCeiling(),this.getVspeed()<this.maxFallSpeed&&this.gravityEnabled&&this.setVspeed(Math.min(this.getVspeed()+this.gravity,this.maxFallSpeed)),unstuck=!1,stuck=!1,this.floor!=null)for(c=!0;c;)T=this.floor.getTileData(0,-1),T!=null&&T.enabled&&T.getsolid()?(this.floor=T,stuck=!0):c=!1;stuck=!1;this.onGround=!1;this.floor!=null&&this.getVspeed()>=0&&(Y=this.floor.getTop(this.getCenter())-this.getHeight(),(!this.floor.getplatform()||this.gety()<=Y+this.getVspeed())&&this.gety()+(this.getVspeed()+10)>=Y&&(this.getVspeed()>0&&(this.setVspeed(0),this.onGround=!0),this.sety(Y)));this.getHspeed()!==0&&(wall=this.getHspeed()>0?this.rightWall:this.leftWall,wall!=null&&this.setHspeed(0));W=this.getWidth()/3;X=Math.abs(this.getHspeed());this.getHspeed()<0?X-=2-W:X+=this.getWidth()-W+2;this.rightWall=this.checkWall(X);X=-Math.abs(this.getHspeed());this.getHspeed()<0?X-=2-W:X+=this.getWidth()-W+2;this.leftWall=this.checkWall(X);this.leftWall!=null&&Bridge.referenceEquals(this.leftWall,this.rightWall)&&(R=this.leftWall.getHitbox(),V=R.getCenter(),BridgeNetDemo.Vector2.op_Subtraction(V,this.getPosition()).x>0?(this.setx(this.getx()+1),this.getHspeed()<0&&this.setHspeed(0)):(this.setx(this.getx()-1),this.getHspeed()>0&&this.setHspeed(0)));stuck&&this.updateTerrainCollision()}});Bridge.define("BridgeNetDemo.TitleScreen",{inherits:[BridgeNetDemo.GameSprite],statics:{gameVersion:"0.11"},titletext:null,gamePlaySettings:null,bG:null,menus:null,activeMenu:null,menuQueue:null,autoPlay:!1,defaultTitleText:null,dimmer:!1,config:{init:function(){this.menus=new Bridge.List$1(BridgeNetDemo.ButtonMenu)()}},constructor:function(){var Menu,kb,st,GPS;BridgeNetDemo.GameSprite.prototype.$constructor.call(this);this.gamePlaySettings=BridgeNetDemo.App.gamePlaySettings;this.titletext=new BridgeNetDemo.TextSprite;this.titletext.setTextColor("#FFFFFF");this.defaultTitleText="TouhouArena(WIP) by RSGmaker\nVersion "+BridgeNetDemo.TitleScreen.gameVersion;this.titletext.setText(this.defaultTitleText);this.titletext.setFontSize(60);this.titletext.position=new BridgeNetDemo.Vector2(100,50);this.bG=new BridgeNetDemo.Animation(BridgeNetDemo.AnimationLoader.get("BG"));Menu=new BridgeNetDemo.ButtonMenu(1e3,500,50);Menu.position=new BridgeNetDemo.Vector2(0,250);this.menuQueue=new Bridge.List$1(BridgeNetDemo.ButtonMenu)();Menu.addButtons(["Story Mode","Skirmish","Challenges","Options"]);Menu.getSpriteByData("Story Mode").lock();Menu.getSpriteByData("Challenges").lock();Menu.finish(4);Menu.onChoose=Bridge.fn.bind(this,$_.BridgeNetDemo.TitleScreen.f1);kb=Bridge.global.localStorage.getItem("RSG_TA_Keybindings");kb==null||Bridge.referenceEquals(kb,"null")||(BridgeNetDemo.App.iC!=null?(BridgeNetDemo.App.iC.copyFromMap(JSON.parse(kb)),console.log("loaded keybindings")):console.log("keybindings were found, but the keybindings were not initiallized."));this.menus.add(Menu);this.activeMenu=this.menus.getItem(0);Menu=new BridgeNetDemo.ButtonMenu(1e3,500,50);Menu.position=new BridgeNetDemo.Vector2(0,250);Menu.addButtons(["Single Player","Multi Player","Back"]);Menu.onChoose=Bridge.fn.bind(this,$_.BridgeNetDemo.TitleScreen.f2);Menu.finish(4);this.menus.add(Menu);Menu=new BridgeNetDemo.ButtonMenu(1e3,500,50);Menu.position=new BridgeNetDemo.Vector2(0,250);BridgeNetDemo.HelperExtensions.forEach(BridgeNetDemo.GameMode,BridgeNetDemo.GameMode.getGameModesOfType(BridgeNetDemo.GameMode.ModeTypes.Skirmish),function(G){Menu.addButton(G.getName())});Menu.addButton("Back");Menu.onChoose=Bridge.fn.bind(this,$_.BridgeNetDemo.TitleScreen.f3);Menu.finish(4);this.menus.add(Menu);st=Bridge.global.sessionStorage.getItem("RSG_TA_GPS");st==null||Bridge.referenceEquals(st,"null")||(GPS=JSON.parse(st.toString()),console.log("GamePlay Settings loaded:"+GPS.toString()),this.gamePlaySettings=GPS,this.gamePlaySettings.hostNPOut=null,this.gamePlaySettings.online=!0,BridgeNetDemo.App.gamePlaySettings=this.gamePlaySettings,Bridge.global.sessionStorage.setItem("RSG_TA_GPS",null),console.log("Found session data, jumping into game room:"+this.gamePlaySettings.roomID),Bridge.global.setTimeout($_.BridgeNetDemo.TitleScreen.f4,1e3));BridgeNetDemo.Game.playMusic("Title screen");this.doPreLoad()},setActiveMenu:function(Menu){Bridge.referenceEquals(this.activeMenu,Menu)||(this.menuQueue.add(this.activeMenu),this.activeMenu=Menu)},backMenu:function(){if(this.menuQueue.getCount()>0){var B=Bridge.Linq.Enumerable.from(this.menuQueue).last();this.menuQueue.removeAt(this.menuQueue.getCount()-1|0);this.activeMenu=B;this.titletext.setText(this.defaultTitleText);this.dimmer=!1}},doPreLoad:function(){var L=new Bridge.List$1(String)();BridgeNetDemo.HelperExtensions.forEach(String,BridgeNetDemo.PlayerCharacter.characters,function(s){L.add(s+"_Idle")});L.add("Tile");BridgeNetDemo.AnimationLoader.preLoad(L);BridgeNetDemo.AudioManager.get_this().get("BGM/Lunatic red eyes.ogg")},update:function(){this.autoPlay;this.activeMenu.update();BridgeNetDemo.GameSprite.prototype.update.call(this)},render:function(){this.spriteBuffer.width=BridgeNetDemo.App.canvas.width;this.spriteBuffer.height=BridgeNetDemo.App.canvas.height;this.spriteGraphics.globalAlpha=1;this.bG.draw(this.spriteGraphics);this.spriteGraphics.globalAlpha=.6;this.dimmer&&(this.spriteGraphics.globalAlpha=.7);this.spriteGraphics.fillStyle="#000000";this.spriteGraphics.fillRect(0,0,this.spriteBuffer.width,this.spriteBuffer.height);this.spriteGraphics.globalAlpha=1;this.activeMenu.draw(this.spriteGraphics);this.titletext.draw(this.spriteGraphics);BridgeNetDemo.GameSprite.prototype.render.call(this)},createButton:function(text){var T;return text===void 0&&(text=""),T=new BridgeNetDemo.TextSprite,T.setTextColor("#000000"),T.setText(text),T.setFontSize(50),new BridgeNetDemo.ButtonSprite(T,6)}});Bridge.ns("BridgeNetDemo.TitleScreen",$_);Bridge.apply($_.BridgeNetDemo.TitleScreen,{f1:function(){var S=this.activeMenu.getSelectedData();Bridge.referenceEquals(S,"Options")?BridgeNetDemo.App.setView$1(BridgeNetDemo.OptionsScreen):Bridge.referenceEquals(S,"Skirmish")&&this.setActiveMenu(this.menus.getItem(2))},f2:function(){var S=this.activeMenu.getSelectedData();(Bridge.referenceEquals(S,"Single Player")||Bridge.referenceEquals(S,"Multi Player"))&&(this.gamePlaySettings.online=Bridge.referenceEquals(S,"Multi Player"),BridgeNetDemo.App.setView$1(BridgeNetDemo.CharacterSelect));Bridge.referenceEquals(S,"Back")&&this.backMenu()},f3:function(){var S=this.activeMenu.getSelectedData();Bridge.referenceEquals(S,"Back")?this.backMenu():(this.gamePlaySettings.gameMode=BridgeNetDemo.GameMode.getGameModeByName(S),this.titletext.setText(this.gamePlaySettings.gameMode.getDescription()),this.setActiveMenu(this.menus.getItem(1)),this.dimmer=!0)},f4:function(){BridgeNetDemo.App.setView$1(BridgeNetDemo.Game)}});Bridge.define("BridgeNetDemo.PlayerCharacter",{inherits:[BridgeNetDemo.PlatformerEntity,BridgeNetDemo.ILightSource,BridgeNetDemo.ICombatant],statics:{characters:null,config:{init:function(){this.characters=["Reisen","Marisa","Sakuya","Reimu"]}}},player:null,_spriteName:null,animation:null,_aimAngle:0,_lAimAngle:0,newInput:!1,aniTimer:0,invincibilityFrames:0,maxInvincibilityFrames:10,killed:!1,respawnTime:0,doubleTapEnabled:!0,hitboxSize:22,maxHP:0,_HP:0,_Team:0,tapTimer:null,dash:null,dashTime:0,maxDashTime:10,doubleTapDelay:15,dashSpeed:60,flyingSpeed:12,dashCost:9,flyingCost:.1,shootTime:0,maxShootTime:8,maxGravity:1.6,gravityResistRate:.5,ammo:0,maxAmmo:90,ammoRechargeRate:.7,ammoRechargeCooldown:0,ammoMaxRechargeCooldown:45,manaburnout:!1,bulletSpeed:50,arm:null,constructor:function(game,player,characterName){var PC,N,AI,W,NS;player===void 0&&(player=null);characterName===void 0&&(characterName=null);BridgeNetDemo.PlatformerEntity.prototype.$constructor.call(this,game);characterName==null&&(characterName="Reisen");player==null&&(player=new BridgeNetDemo.Player(!1,!0));this.player=player;player.character=this;this._spriteName=characterName;this.animation="Idle";this._aimAngle=0;this.tapTimer=Bridge.Array.init(this.controller.length,0);this.ani=new BridgeNetDemo.Animation(BridgeNetDemo.AnimationLoader.get(characterName+"_"+this.animation));this.arm=new BridgeNetDemo.Attachment("constructor$1",game,this);this.arm.ani=new BridgeNetDemo.Animation(BridgeNetDemo.AnimationLoader.get(characterName+"Arm"));this.arm.offset.x=40;this.arm.offset.y=42;this.arm.flipOffset=-4;this.shootTime=this.maxShootTime;this.ammo=this.maxAmmo;this.ani.setShadow(35);this.ani.setShadowcolor("#0066CC");this.resetAniTimer();this._Team=1;this.dash=new BridgeNetDemo.Vector2;this.maxHP=100;this.setHP(this.maxHP);PC=new BridgeNetDemo.PlatformerControls(this);PC.maxSpeed=9;PC.accel=1.7;this.addBehavior(PC);this.setPlayerColor();this.setupAnimations();player.cPU&&(N=new BridgeNetDemo.NavigatorAI(this),N.framesPerTick=Bridge.Int.clip32(Math.ceil(5*this.game.gamePlaySettings.computerAIModifier)),this.addBehavior(N),AI=new BridgeNetDemo.ReisenAI(this),AI.framesPerTick=Bridge.Int.clip32(Math.ceil(30*this.game.gamePlaySettings.computerAIModifier)),this.addBehavior(AI),this.getHandledLocally()&&(W=new BridgeNetDemo.WanderAI(this),W.framesPerTick=Bridge.Int.clip32(Math.ceil(60*this.game.gamePlaySettings.computerAIModifier)),W.randomDirection=!1,this.addBehavior(W),this.doubleTapEnabled=!1,this.setspriteName(BridgeNetDemo.HelperExtensions.pick(String,BridgeNetDemo.PlayerCharacter.characters))));NS=new BridgeNetDemo.NetworkSync(this);NS.addFields(["x","y","controller","aimAngle","Hspeed","Vspeed","Team","HP","ammo","spriteName"]);player.cPU&&(NS.framesPerTick=120);NS.forcesFlush=!0;NS.updateOnSync=!0;this.addBehavior(NS);this.setCharacter();this.zOrder=2;player.getlocal()&&(this.zOrder=this.zOrder+1|0)},getspriteName:function(){return this._spriteName},setspriteName:function(value){this._spriteName=value;this.setCharacter()},getaimAngle:function(){return this._aimAngle},setaimAngle:function(value){this._aimAngle=value;this.arm.ani.rotation=BridgeNetDemo.MathHelper.wrapRadians(this._aimAngle-BridgeNetDemo.MathHelper.PIOver2);this.ani.flipped=this.arm.ani.rotation>0;this.arm.ani.flipped=this.ani.flipped},getHP:function(){return this._HP},setHP:function(value){this._HP=value},getmaxLightRadius:function(){return this.killed?0:7},getlightFlicker:function(){return!1},getTeam:function(){return this._Team},setTeam:function(value){this._Team=value;this.setPlayerColor()},getlightPosition:function(){return this.getCenter()},getPointsForKilling:function(){return 1e3},getTargetPriority:function(){return.7},getHandledLocally:function(){return this.player.getlocal()||this.player.cPU&&this.game.getHoster()},getHitbox:function(){var V=this.getCenter(),s=this.hitboxSize/2;return V=BridgeNetDemo.Vector2.op_Subtraction(V,new BridgeNetDemo.Vector2(s,0)),new BridgeNetDemo.Rectangle(V.x,V.y,this.hitboxSize,this.hitboxSize)},setCharacter:function(){if(this._behaviors!=null&&BridgeNetDemo.HelperExtensions.removeAll(BridgeNetDemo.EntityBehavior,this._behaviors,$_.BridgeNetDemo.PlayerCharacter.f1),this.ani.changeAnimation(BridgeNetDemo.AnimationLoader.get(this.getspriteName()+"_"+this.animation),!1),this.arm.ani.changeAnimation(BridgeNetDemo.AnimationLoader.get(this.getspriteName()+"Arm"),!1),this.getBehavior(BridgeNetDemo.Animator$1(BridgeNetDemo.PlayerCharacter)).spriteName=this.getspriteName(),this.arm.offset.y=42,(Bridge.referenceEquals(this.getspriteName(),"Sakuya")||Bridge.referenceEquals(this.getspriteName(),"Reimu"))&&(this.arm.offset.y=32),Bridge.referenceEquals(this.getspriteName(),"Marisa"))this.addBehavior(new BridgeNetDemo.MiniHakkero(this));else if(Bridge.referenceEquals(this.getspriteName(),"Sakuya"))this.addBehavior(new BridgeNetDemo.WideShot(this));else if(Bridge.referenceEquals(this.getspriteName(),"Reimu"))this.addBehavior(new BridgeNetDemo.YinyangShot(this));else{var RG=new BridgeNetDemo.RapidFireGun(this);this.addBehavior(RG)}},setPlayerColor:function(){var color="";color=this.getTeamColor();this.ani.setShadow(15);this.ani.setShadowcolor(color)},setupAnimations:function(){var A=new BridgeNetDemo.Animator$1(BridgeNetDemo.PlayerCharacter)(this,this.getspriteName());A.addAnimation(new BridgeNetDemo.AnimationData("Walk",.3),$_.BridgeNetDemo.PlayerCharacter.f2);A.addAnimation$1("Idle",$_.BridgeNetDemo.PlayerCharacter.f3);A.addAnimation$1("Jump",$_.BridgeNetDemo.PlayerCharacter.f4);A.addAnimation(new BridgeNetDemo.AnimationData("Blink",1,5,new BridgeNetDemo.AnimationData("Idle"),!0),$_.BridgeNetDemo.PlayerCharacter.f5);this.addBehavior(A);A.setAnimation$1("Idle")},resetAniTimer:function(){this.aniTimer=20+600*Math.random()},animate:function(){this.doAniTimer()},doAniTimer:function(){this.ani.animationTimeElapsed>=this.aniTimer&&Bridge.referenceEquals(this.animation,"Idle")&&(this.getBehavior(BridgeNetDemo.Animator$1(BridgeNetDemo.PlayerCharacter)).runAnimation$2("Blink"),this.resetAniTimer())},fire:function(){var PB=new BridgeNetDemo.PlayerBullet(this.game,this),V;PB.settouchDamage(5);PB.ani.setX(this.arm.getx()+this.arm.getWidth()/2);PB.ani.setY(this.arm.gety()+this.arm.getHeight()/2);PB.setx(PB.getx()-12);PB.sety(PB.gety()-12);V=BridgeNetDemo.Vector2.fromRadian(this._aimAngle);V=V.normalize(this.bulletSpeed);PB.speed=V;PB.ani.rotation=this._aimAngle;PB.setPosition(BridgeNetDemo.Vector2.op_Addition(PB.getPosition(),V.normalize(12)));this.game.addEntity(PB)},updateController:function(){this.newInput=!1;for(var i=0;i<this.controller.length;)this.tapTimer[i]=this.tapTimer[i]+1|0,this.controller[i]&&!this.lController[i]&&(this.tapTimer[i]=0,this.newInput=!0),this.lController[i]=this.controller[i],i=i+1|0;this._lAimAngle!==this._aimAngle&&(this.newInput=!0);this._lAimAngle=this._aimAngle;this.newInput&&this.getBehavior(BridgeNetDemo.NetworkSync).sync()},updateShoot:function(){var weapon=this.getBehavior$1(BridgeNetDemo.IWeaponBehavior,$_.BridgeNetDemo.PlayerCharacter.f6),rate;weapon.setFiringAngle(this._aimAngle);this.shootTime-=1;this.shootTime<=0?this.controller[4]&&!this.manaburnout?(weapon!=null&&(this.shootTime+=weapon.getMaxCooldown(),weapon.fire(this._aimAngle),this.ammo-=weapon.getEnergyCost()),this.ammoRechargeCooldown=Math.max(this.ammoRechargeCooldown,this.ammoMaxRechargeCooldown)):this.shootTime=0:this.ammoRechargeCooldown=Math.max(this.ammoRechargeCooldown,this.ammoMaxRechargeCooldown);this.ammoRechargeCooldown-=1;this.ammoRechargeCooldown<=0&&(rate=this.ammoRechargeRate,this.manaburnout,this.ammo=Math.min(this.ammo+rate,this.maxAmmo))},getMovementDirection:function(){var D=new BridgeNetDemo.Vector2;return this.controller[0]&&(D.x=-1),this.controller[1]&&(D.x=1),this.controller[2]&&(D.y=-1),this.controller[3]&&(D.y=1),D},customEvent:function(evt){Bridge.referenceEquals(evt.T,"Respawn")&&(this.player.lives>0||this.player.lives===-1)&&(this.player.lives!==-1&&(this.player.lives=this.player.lives-1|0),this.killed=!1,this.setHP(this.maxHP),this.setPosition(new BridgeNetDemo.Vector2(evt.X,evt.Y)),this.player.getlocal()&&(this.game.updateCamera(),this.game.camera.position=this.game.camera.targetPosition.clone()),this.invincibilityFrames=90,this.ammo=this.maxAmmo,this.ammoRechargeCooldown=0,this.player.getlocal()&&Bridge.String.startsWith(this.game.respawnText.getText(),"Respawning in ")&&this.game.respawnText.setText(""))},deadUpdate:function(){var maxRespawnTime,D,V;this.visible=!1;maxRespawnTime=this.game.gamePlaySettings.gameMode.getRespawnTime();this.player.getlocal()&&this.player.lives>0&&(this.game.respawnText.setTextColor("#FFFFFF"),this.game.respawnText.setText("Respawning in "+BridgeNetDemo.App.limitStringSize(Bridge.Single.format((maxRespawnTime-(this.respawnTime-.0001))/60,"G"),3)));this.respawnTime=this.respawnTime+1|0;this.respawnTime>maxRespawnTime&&this.getHandledLocally()&&(D={},D.T="Respawn",V=this.game.getRespawnLocation(this.getTeam()),D.X=V.x,D.Y=V.y,this.sendCustomEvent(D,!0))},update:function(){if(this.getHP()<=0&&this.getHandledLocally()||this.killed){this.setHP(0);!this.killed&&this.getHandledLocally();this.killed=!0;this.deadUpdate();return}if(this.player.getlocal(),BridgeNetDemo.PlatformerEntity.prototype.update.call(this),this.doDash(),this.getVspeed()<0&&this.ceiling!=null){var R=this.ceiling.getHitbox(),Y=R.getbottom()-32;this.ani.position.y=this.ani.position.y+this.getVspeed()<=Y?Y:Y;this.setVspeed(0)}this.gravity=this.maxGravity;this.getVspeed()<4&&this.controller[2]&&(this.gravity*=1-this.gravityResistRate);this.updateShoot();this.animate();this.setx(Math.max(this.game.stageBounds.x,Math.min(this.game.stageBounds.getright()-this.getWidth(),this.getx())));this.arm.update();this.visible=this.invincibilityFrames>0?!this.visible:!0;this.ammo<0?(this.ammo=0,this.manaburnout=!0,this.ammoRechargeCooldown=Math.max(this.ammoRechargeCooldown,this.ammoMaxRechargeCooldown)):this.ammo>=this.maxAmmo&&(this.manaburnout=!1);this.updateController();this.invincibilityFrames=Math.max(0,this.invincibilityFrames-1|0)},doDash:function(){var M,rot,D;this.gravityEnabled=this.dashTime<1;this.dashTime<=0&&(this.ani.rotation=0);this.dashTime>0?(M=this.getMovementDirection(),!this.manaburnout&&this.controller[5]&&this.dashTime===1?(this.dash=BridgeNetDemo.Vector2.op_Multiply(M,this.flyingSpeed),this.ammo-=M.x===0&&M.y===0?this.flyingCost*.5:this.flyingCost,this.ammoRechargeCooldown=Math.max(this.ammoRechargeCooldown,this.ammoMaxRechargeCooldown)):this.dashTime=this.dashTime-1|0,this.speed.x=this.dash.x,this.speed.y=this.dash.y,this.dashTime<=0&&(this.speed=new BridgeNetDemo.Vector2),rot=.4,this.speed.x>0?this.ani.rotation=rot:this.speed.x<0?this.ani.rotation=-rot:this.speed.y>0?this.ani.rotation=rot:this.speed.y<0&&(this.ani.rotation=-rot)):this.manaburnout||(D=new BridgeNetDemo.Vector2,this.doubleTapEnabled&&(this.controller[0]&&!this.lController[0]&&this.tapTimer[0]<this.doubleTapDelay&&(D.x=-this.dashSpeed),this.controller[1]&&!this.lController[1]&&this.tapTimer[1]<this.doubleTapDelay&&(D.x=this.dashSpeed),this.controller[2]&&!this.lController[2]&&this.tapTimer[2]<this.doubleTapDelay&&(D.y=-this.dashSpeed),this.controller[3]&&!this.lController[3]&&this.tapTimer[3]<this.doubleTapDelay&&(D.y=this.dashSpeed)),D.x===0&&D.y===0&&this.controller[5]&&(D=BridgeNetDemo.Vector2.op_Multiply(this.getMovementDirection(),this.dashSpeed),D.x===0&&D.y===0&&(this.ammo-=this.dashCost/2,this.dash=D,this.dashTime=1)),(D.x!==0||D.y!==0)&&(this.dash=D,this.speed.x=this.dash.x,this.speed.y=this.dash.y,this.dashTime>0&&(this.ammo+=this.dashCost/this.maxDashTime*.5*this.dashTime),this.playSound("zoom"),this.ammo-=this.dashCost,this.invincibilityFrames=40,this.dashTime=this.maxDashTime,this.ammoRechargeCooldown=Math.max(this.ammoRechargeCooldown,this.ammoMaxRechargeCooldown)))},draw:function(g){this.arm.hideHitbox=!0;BridgeNetDemo.PlatformerEntity.prototype.draw.call(this,g);this.arm.draw(g)},aimAt:function(V){var A=this.arm.getPosition$1();this.setaimAngle(BridgeNetDemo.MathHelper.wrapRadians(BridgeNetDemo.MathHelper.getAngle(new BridgeNetDemo.Vector2(A.x+this.arm.getWidth()/2,A.y+this.arm.getHeight()/2),V)))},onDamaged:function(source,amount){this.invincibilityFrames>0||(this.setHP(this.getHP()-amount),this.invincibilityFrames=this.maxInvincibilityFrames)},onDeath:function(){this.killed=!0;this.respawnTime=0;var T=new BridgeNetDemo.Tombstone(this.game);T.setx(this.getx());T.sety(this.gety());this.game.addEntity(T);this.speed=new BridgeNetDemo.Vector2;this.player.lives===0&&this.player.getlocal()&&(this.game.respawnText.setText("Game Over"),this.game.respawnText.setTextColor("#FF0000"))},onKill:function(){}});Bridge.ns("BridgeNetDemo.PlayerCharacter",$_);Bridge.apply($_.BridgeNetDemo.PlayerCharacter,{f1:function(B){return Bridge.is(B,BridgeNetDemo.IWeaponBehavior)},f2:function(an){return an.animationTarget.getHspeed()!==0&&an.animationTarget.onGround&&Bridge.referenceEquals(an.getCurrentAnimation(),"Idle")},f3:function(an){return an.animationTarget.onGround&&(Bridge.referenceEquals(an.getCurrentAnimation(),"Walk")&&an.animationTarget.getHspeed()===0||Bridge.referenceEquals(an.getCurrentAnimation(),"Jump"))},f4:function(an){return!an.animationTarget.onGround},f5:function(an){return Bridge.referenceEquals(an.getCurrentAnimation(),"Idle")},f6:function(WB){return WB.getWeaponType()===1}});Bridge.define("BridgeNetDemo.Tombstone",{inherits:[BridgeNetDemo.PlatformerEntity],despawnTimer:600,constructor:function(game){BridgeNetDemo.PlatformerEntity.prototype.$constructor.call(this,game);this.ani=new BridgeNetDemo.Animation(BridgeNetDemo.AnimationLoader.get("Tombstone"))},update:function(){BridgeNetDemo.PlatformerEntity.prototype.update.call(this);this.onGround?this.ani.rotation=0:this.ani.rotation+=.2;this.despawnTimer=this.despawnTimer-1|0;var Alpha=this.despawnTimer*.02;Alpha<1&&(this.ani.alpha=Alpha);this.despawnTimer<=0&&(this.alive=!1)}});Bridge.init()})(this);